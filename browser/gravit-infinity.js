!function(a){function b(){}b.getTypeId=function(a){return"number"==typeof a?a:"function"==typeof a&&a.prototype.hasOwnProperty("__gtype_id__")?a.prototype.__gtype_id__:a&&"number"==typeof a.__gtype_id__?a.__gtype_id__:null},b.getName=function(a){if(a){if("object"==typeof a&&(a=a.constructor),a&&"function"==typeof a){var b=/function (.{1,})\(/,c=b.exec(a.toString());return c&&c.length>1?c[1]:"anonymous"}return a.toString()}return"<null>"},b.inherit=function(a,c){if(a.prototype=Object.create(c.prototype),a.prototype.__gtype_id__=b._internalTypeIdCounter++,a.prototype.constructor=a,delete a.prototype.__gmixins__,c.prototype.__gmixins__){a.prototype.__gmixins__={};for(var d in c.prototype.__gmixins__)a.prototype.__gmixins__[d]=!0}if(c!=b)for(var e in c)e&&e.length>0&&"constructor"!==e&&"__gmixins__"!=e&&"toString"!=e&&"_"!=e.charAt(0)&&!a[e]&&(a[e]=c[e])},b.mix=function(a,c){b.inheritAndMix(a,null,c)},b.inheritAndMix=function(a,c,d){if(c&&this.inherit(a,c),d){a.prototype.__gmixins__||(a.prototype.__gmixins__={});for(var e=0;e<d.length;++e){var f=d[e].prototype;for(var g in f)if(g&&"constructor"!==g&&"toString"!=g&&"__gmixins__"!=g&&"__gtype_id__"!=g&&"hasMixin"!=g){if(g in a.prototype)throw new Error("Mixin "+f+" may not override "+g+" in "+a.prototype);a.prototype[g]=f[g]}if(f.__gtype_id__||(f.__gtype_id__=b._internalTypeIdCounter++),a.prototype.__gmixins__[f.__gtype_id__]=!0,f.__gmixins__)for(var h in f.__gmixins__)a.prototype.__gmixins__[h]=!0}}},b._internalTypeIdCounter=0,b.prototype.__gtype_id__=-1,b.prototype.__gmixins__=null,b.prototype.hasMixin=function(a){return this.__gmixins__&&this.__gmixins__[a.prototype.__gtype_id__]?!0:!1},b.prototype.toString=function(){var a=this.constructor.toString().match(/^function ([^\(]*)/);return"[Object "+(a?a[1]:"object")+"]"},a.IFObject=b}(this),function(a){function b(){this.littleEndian=function(){var a=new ArrayBuffer(8),b=new Uint32Array(a);return b[1]=168496141,!(10===a[4]&&11===a[5]&&12===a[6]&&13===a[7])}(),this.hardware=function(){var a=!!navigator.userAgent.match(/(iPad|SCH-I800|xoom|kindle)/i),c=!!navigator.userAgent.match(/(iPhone|iPod|blackberry|android 0.5|htc|lg|midp|mmp|mobile|nokia|opera mini|palm|pocket|psp|sgh|smartphone|symbian|treo mini|Playstation Portable|SonyEricsson|Samsung|MobileExplorer|PalmSource|Benq|Windows Phone|Windows Mobile|IEMobile|Windows CE|Nintendo Wii)/i);return a?b.Hardware.Tablet:c?b.Hardware.Phone:b.Hardware.Desktop}(),this.operatingSystem=function(){for(var a=[{string:navigator.platform,subString:"Win",identity:b.OperatingSystem.Windows},{string:navigator.platform,subString:"Mac",identity:b.OperatingSystem.OSX_IOS},{string:navigator.userAgent,subString:"iPhone",identity:b.OperatingSystem.OSX_IOS},{string:navigator.userAgent,subString:"iPad",identity:b.OperatingSystem.OSX_IOS},{string:navigator.userAgent,subString:"Android",identity:b.OperatingSystem.Unix},{string:navigator.platform,subString:"Linux",identity:b.OperatingSystem.Unix}],c=0;c<a.length;c++){var d=a[c].string;if(-1!=d.indexOf(a[c].subString))return a[c].identity}return b.OperatingSystem.Windows}(),this.language=function(){var a=(navigator.language||navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage||"").split("-");return 2==a.length?a[0].toLowerCase():a?a[0].toLowerCase():null}(),console.log("HW="+this.hardware+"; OS="+this.operatingSystem+"; LANG="+this.language)}b.OperatingSystem={Unix:0,Windows:1,OSX_IOS:2},b.Hardware={Desktop:0,Tablet:1,Phone:2},b.prototype.littleEndian=!0,b.prototype.operatingSystem=null,b.prototype.hardware=null,b.prototype.language=null,a.IFSystem=b,a.ifSystem=new b}(this),function(a){var b={Default:null,Select:"select",SelectInverse:"select-inverse",SelectDot:"select-dot",SelectDotInverse:"select-dot-inverse",SelectArrowOnly:"select-arrow-only",SelectCross:"select-cross",SelectResizeVert:"select-resize-vert",SelectResizeHoriz:"select-resize-horiz",SelectResizeUpLeftDownRight:"select-upleft-downright",SelectResizeUpRightDownLeft:"select-upright-downleft",SelectSkewVert:"select-skew-vert",SelectSkewHoriz:"select-skew-horiz",SelectRotate:["select-rot-tl","select-rot-tc","select-rot-tr","select-rot-rc","select-rot-br","select-rot-bc","select-rot-bl","select-rot-lc"],ZoomPlus:"zoom-plus",ZoomMinus:"zoom-minus",ZoomNone:"zoom-none",HandOpen:"hand-open",HandClosed:"hand-closed",Cross:"cross",Pen:"pen",PenStart:"pen-start",PenEnd:"pen-end",PenPlus:"pen-plus",PenMinus:"pen-minus",PenModify:"pen-modify",PenDrag:"pen-drag",Lasso:"lasso",Pipette:"pipette",Text:"text"};a.IFCursor=b}(this),function(a){function b(){}b.Constant={CHARACTER:0,SPACE:1,ENTER:2,TAB:3,BACKSPACE:4,CONTROL:5,SHIFT:6,ALT:7,LEFT:8,UP:9,RIGHT:10,DOWN:11,PAGE_UP:12,PAGE_DOWN:13,HOME:14,END:15,INSERT:16,DELETE:17,COMMAND:19,F1:30,F2:31,F3:32,F4:33,F5:34,F6:35,F7:36,F8:37,F9:38,F10:39,F11:40,F12:41,META:100,OPTION:101,REMOVE:102},b.prototype.translateKey=function(a){var c=null;switch(a){case 32:c=b.Constant.SPACE;break;case 13:c=b.Constant.ENTER;break;case 9:c=b.Constant.TAB;break;case 8:c=b.Constant.BACKSPACE;break;case 16:c=b.Constant.SHIFT;break;case 17:c=b.Constant.CONTROL;break;case 18:c=b.Constant.ALT;break;case 37:c=b.Constant.LEFT;break;case 38:c=b.Constant.UP;break;case 39:c=b.Constant.RIGHT;break;case 40:c=b.Constant.DOWN;break;case 33:c=b.Constant.PAGE_UP;break;case 34:c=b.Constant.PAGE_DOWN;break;case 36:c=b.Constant.HOME;break;case 35:c=b.Constant.END;break;case 45:c=b.Constant.INSERT;break;case 46:c=b.Constant.DELETE;break;case 112:c=b.Constant.F1;break;case 113:c=b.Constant.F2;break;case 114:c=b.Constant.F3;break;case 115:c=b.Constant.F4;break;case 116:c=b.Constant.F5;break;case 117:c=b.Constant.F6;break;case 118:c=b.Constant.F7;break;case 119:c=b.Constant.F8;break;case 120:c=b.Constant.F9;break;case 121:c=b.Constant.F10;break;case 122:c=b.Constant.F11;break;case 123:c=b.Constant.F12}return null==c&&(c=String.fromCharCode(a)),c},b.prototype.transformKey=function(a){return a===b.Constant.META||a===b.Constant.COMMAND?ifSystem.operatingSystem===IFSystem.OperatingSystem.OSX_IOS&&ifSystem.hardware===IFSystem.Hardware.Desktop?b.Constant.COMMAND:b.Constant.CONTROL:a===b.Constant.OPTION?b.Constant.ALT:a===b.Constant.REMOVE?ifSystem.operatingSystem===IFSystem.OperatingSystem.OSX_IOS?b.Constant.BACKSPACE:b.Constant.DELETE:a},b.prototype.toLocalizedName=function(a){return a=this.transformKey(a),ifLocale.getValue(b,"key."+a.toString())},b.prototype.toLocalizedShort=function(a){if(ifSystem.operatingSystem===IFSystem.OperatingSystem.OSX_IOS&&ifSystem.hardware===IFSystem.Hardware.Desktop){if(a==b.Constant.TAB)return"⇥";if(a==b.Constant.OPTION||a==b.Constant.ALT)return"⌥";if(a==b.Constant.META||a==b.Constant.COMMAND)return"⌘";if(a==b.Constant.SHIFT)return"⇧";if(a==b.Constant.CONTROL)return"⌃";if(a==b.Constant.SPACE)return"␣";if(a==b.Constant.ENTER)return"⏎";if(a==b.Constant.REMOVE)return"⌫";if(a==b.Constant.UP)return"↑";if(a==b.Constant.DOWN)return"↓";if(a==b.Constant.LEFT)return"←";if(a==b.Constant.RIGHT)return"→"}a=this.transformKey(a);var c=ifLocale.getValue(b,"key."+a.toString()+".short",null);return c?c:ifLocale.getValue(b,"key."+a.toString())},b.prototype.toSystemShortcut=function(a){if(ifSystem.operatingSystem===IFSystem.OperatingSystem.OSX_IOS&&ifSystem.hardware===IFSystem.Hardware.Desktop){if("-"===a)return"−";if("+"===a)return"+"}return a.toUpperCase()},b.prototype.shortcutToString=function(a){for(var b="",c=0;c<a.length;++c)c>0&&ifSystem.operatingSystem!=IFSystem.OperatingSystem.OSX_IOS&&(b+="+"),b+="number"==typeof a[c]?this.toLocalizedShort(a[c]):this.toSystemShortcut(a[c]);return b},a.IFKey=b,a.ifKey=new b}(this),function(a){function b(){this._values={},this._functions={},"en"===ifSystem.language?this.setLanguage(b.Language.English):"de"===ifSystem.language&&this.setLanguage(b.Language.German)}IFObject.inheritAndMix(b,IFObject),b.Language={English:0,German:1,Default:0},b.Key=function(a,b){this._type_id=IFObject.getTypeId(a),this._key=b},b.Constant={Create:new b.Key(b,"create"),Add:new b.Key(b,"add"),Edit:new b.Key(b,"edit"),Remove:new b.Key(b,"remove"),Delete:new b.Key(b,"delete"),Open:new b.Key(b,"open"),Save:new b.Key(b,"save"),Cancel:new b.Key(b,"cancel"),Ok:new b.Key(b,"ok"),Close:new b.Key(b,"close"),Loading:new b.Key(b,"loading"),LoadingOf:new b.Key(b,"loading_of"),Saving:new b.Key(b,"saving"),SavingOf:new b.Key(b,"saving_of"),Success:new b.Key(b,"success"),Failure:new b.Key(b,"failure"),Waiting:new b.Key(b,"waiting")},b.prototype._language=0,b.prototype._values=null,b.prototype._functions=null,b.prototype.getLanguage=function(){return this._language},b.prototype.setLanguage=function(a){a!=this._language&&(this._language=a)},b.prototype.get=function(a){return null!=a&&a instanceof b.Key?this.getValueByKey(a):a},b.prototype.getValue=function(a,c,d){var e=IFObject.getTypeId(a),f=this._getValue(this._language,e,c);if(f||this._language==b.Language.Default||(f=this._getValue(b.Language.Default,e,c)),!f&&"undefined"==typeof d)throw new Error("No value found for "+IFObject.getName(a)+" and key "+c);return f?f:d},b.prototype.getValueByKey=function(a){return this.getValue(a._type_id,a._key)},b.prototype.setValues=function(a,b,c,d){var e=IFObject.getTypeId(a),f=this._values[b];f||(f=this._values[b]={});var g=f[e];g||(g=f[e]={});for(var h=0;h<c.length;++h)g[c[h]]=d[h]},b.prototype._getValue=function(a,b,c){var d=this._values[a];if(d){var e=d[b];if(e)return e[c]}},b.prototype.setFunction=function(a,b,c){var d=this._functions[a];d||(d=this._functions[a]={}),d[b]=c},b.prototype.getFunction=function(a){var c=this._functions[this._language];if(c&&c.hasOwnProperty(a))return c[a];if(this._language!=b.Language.Default){var c=this._functions[b.Language.Default];if(c&&c.hasOwnProperty(a))return c[a]}return null},b.prototype.toString=function(){return"[Object IFLocale]"},a.IFLocale=b,a.ifLocale=new b}(this),function(a){function b(){}b.prototype.PI2=2*Math.PI,b.prototype.PIHALF=.5*Math.PI,b.prototype.defaultEps=1e-14,b.prototype.toRadians=function(a){return a*Math.PI/180},b.prototype.toDegrees=function(a){return 180*a/Math.PI},b.prototype.normalizeAngleRadians=function(a){return a>=0?this.mod(a,this.PI2):a+this.PI2*Math.floor(-a/this.PI2+1)},b.prototype.normalizeAngleDegrees=function(a){return a>=0?this.mod(a,360):a+360*Math.floor(-a/360+1)},b.prototype.normalizeValue=function(a,b,c){return b>a?b:a>c?c:a},b.prototype.isEqualEps=function(a,b,c){return c||(c=this.defaultEps),Math.abs(a-b)<=c},b.prototype.round=function(a,b,c){c=Math.abs(c)||0;var d=c?Math.pow(10,c):1;return b?Math.ceil(a*d-.5)/d:Math.round(a*d)/d},b.prototype.mod=function(a,b){return 0>a?-this.mod(-a,b):a-Math.floor(a/b)*b},b.prototype.div=function(a,b){return 0>a?-Math.floor(-a/b):Math.floor(a/b)},b.prototype.getIntersectionPoint=function(a,b,c,d,e,f,g,h,i){var j=(a-c)*(h-f)-(b-d)*(g-e),k=(a-e)*(h-f)-(b-f)*(g-e),l=(a-c)*(b-f)-(b-d)*(a-e);if(Math.abs(j)<this.defaultEps)return null;var m=k/j,n=l/j;return!i&&m>=0&&1>=m&&n>=0&&1>=n||i?(i&&(i[0]=m,i[1]=n),new IFPoint(a+m*(c-a),b+m*(d-b))):null},b.prototype.circleLineIntersection=function(a,b,c,d,e,f,g,h){var i=g*g,j=c*c,k=d*d,l=j+k;if(!this.isEqualEps(l,0)){var m=c*(f-b)-d*(e-a),n=i*l-m*m;this.isEqualEps(n,0)?h[0]=(c*(e-a)+d*(f-b))/l:n>0&&(m=c*(e-a)+d*(f-b),h[0]=(m-Math.sqrt(n))/l,h[1]=(m+Math.sqrt(n))/l)}},b.prototype.circleCircleIntersection=function(a,b,c,d,e,f,g){var h=this.ptSqrDist(a,b,d,e),i=Math.abs(c-f),j=i*i,k=c+f,l=k*k;if(!this.isEqualEps(h,0)){var m=(c*c-f*f)/(2*h),n=(a+d)/2+(d-a)*m,o=(b+e)/2+(e-b)*m;if(this.isEqualEps(h,l)||!this.isEqualEps(h,0)&&this.isEqualEps(h,j))g[0]=new IFPoint(n,o);else if(h>j&&l>h){m=Math.sqrt((l-h)*(h-j))/(2*h);var p=(e-b)*m,q=(a-d)*m;g[0]=new IFPoint(n+p,o+q),g[1]=new IFPoint(n-p,o-q)}}},b.prototype.getLinesIntersection=function(a,b,c,d,e,f){var g=a*e-d*b;return this.isEqualEps(g,0)?null:new IFPoint((b*f-e*c)/g,(c*d-f*a)/g)},b.prototype.getCircumcircleCenter=function(a,b,c,d,e,f){var g=a-c,h=b-d,i=c-e,j=d-f;return this.getLinesIntersection(g,h,-g*(a+c)/2-h*(b+d)/2,i,j,-i*(c+e)/2-j*(d+f)/2)},b.prototype.getPointAtLength=function(a,b,c,d,e){var f,g;return 0>=e?new IFPoint(a,b):(f=Math.sqrt((c-a)*(c-a)+(d-b)*(d-b)),e>=f?new IFPoint(c,d):(g=e/f,new IFPoint(a+g*(c-a),b+g*(d-b))))},b.prototype.getCurveAtT=function(a,b,c,d){var e=a+d*(c-a),f=c+d*(b-c);return e+d*(f-e)},b.prototype.getCubicCurveAtT=function(a,b,c,d,e){var f=a+e*(c-a),g=c+e*(d-c),h=d+e*(b-d),i=f+e*(g-f),j=g+e*(h-g);return i+e*(j-i)},b.prototype.vDotProduct=function(a,b,c,d){return null==a||null==b||null==c||null==d?0:a*c+b*d},b.prototype.ptSqrDist=function(a,b,c,d){var e,f;return null==a||null==b||null==c||null==d?0:(e=a-c,f=b-d,e*e+f*f)},b.prototype.ptDist=function(a,b,c,d){return Math.sqrt(this.ptSqrDist(a,b,c,d))},b.prototype.segmentSide=function(a,b,c,d,e,f){var g=(f-b)*(c-a)+(e-a)*(b-d);return this.isEqualEps(g,0)?0:g>0?1:-1},b.prototype.sqrSegmentDist=function(a,b,c,d,e,f,g,h){if(this.isEqualEps(a,c)&&this.isEqualEps(b,d))return this.ptSqrDist(a,b,e,f);var i,j,k,l,m,n,o,p,q=0,r=0;return i=e-a,j=f-b,a==c&&b==d?(r=this.vDotProduct(i,j,i,j),g&&(g[0]=0)):g&&h&&this.vDotProduct(i,j,i,j)<=h?(g[0]=0,r=0):g&&h&&this.ptSqrDist(e,f,c,d)<=h?(g[0]=1,r=0):(k=c-a,l=d-b,q=this.vDotProduct(i,j,k,l)/this.vDotProduct(k,l,k,l),0>=q?(r=this.vDotProduct(i,j,i,j),g&&(g[0]=0)):q>=1?(r=this.vDotProduct(e-c,f-d,e-c,f-d),g&&(g[0]=1)):(m=k*q,n=l*q,o=i-m,p=j-n,r=this.vDotProduct(o,p,o,p),g&&(g[0]=q))),r},b.prototype.getSegmToSegmSqrDist=function(a,b,c,d){var e=this.sqrSegmentDist(a.getX(),a.getY(),b.getX(),b.getY(),c.getX(),c.getY()),f=e;return f>0&&(e=this.sqrSegmentDist(a.getX(),a.getY(),b.getX(),b.getY(),d.getX(),d.getY()),f>e&&(f=e),f>0&&(e=this.sqrSegmentDist(c.getX(),c.getY(),d.getX(),d.getY(),a.getX(),a.getY()),f>e&&(f=e),f>0&&(e=this.sqrSegmentDist(c.getX(),c.getY(),d.getX(),d.getY(),b.getX(),b.getY()),f>e&&(f=e)))),f},b.prototype.getVectorProjection=function(a,b,c,d,e,f,g){var h,i=e-a,j=f-b,k=c-a,l=d-b,m=this.vDotProduct(k,l,k,l);if(this.isEqualEps(m,0))h=new IFPoint(e,f);else{var n=this.vDotProduct(i,j,k,l)/m;h=0>=n&&g?new IFPoint(a,b):new IFPoint(k*n+a,l*n+b)}return h},b.prototype.solveLinear2Pseudo=function(a,b,c,d,e,f){var g=this.getLinesIntersection(a,b,-c,d,e,-f);if(null==g){var h,i;this.isEqualEps(a+b,0)||this.isEqualEps(c,0)&&!this.isEqualEps(f,0)?this.isEqualEps(d+e,0)||this.isEqualEps(f,0)&&!this.isEqualEps(c,0)?this.isEqualEps(b,0)&&this.isEqualEps(e,0)?this.isEqualEps(a,0)&&this.isEqualEps(d,0)?(h=0,i=0):(i=0,h=this.isEqualEps(a,0)?f/d:c/a):(h=0,i=ifMath.isEqualEps(b,0)?f/e:c/b):(h=f/(d+e),i=h):(h=c/(a+b),i=h),this.isEqualEps(a*h+b*i,c)&&this.isEqualEps(d*h+e*i,f)&&(g=new IFPoint(h,i))}return g},b.prototype.divideQuadraticCurve=function(a,b,c,d,e,f){var g=a+d*(b-a),h=b+d*(c-b),i=g+d*(h-g);e[0]=a,e[1]=g,e[2]=i,f[0]=i,f[1]=h,f[2]=c},b.prototype.evalCubic=function(a,b,c,d,e){return 0==e?d:1==e?a+b+c+d:((e*a+b)*e+c)*e+d},b.prototype.getCubicCurveSplits=function(a,b,c,d,e,f,g){var h=[0,1];ifMath.getQuadraticRoots(a,b,c,h),ifMath.getQuadraticRoots(d,e,f,h);var i=b*d-e*a,j=2*(c*d-f*a),k=c*e-f*b;return ifMath.getQuadraticRoots(i,j,k,h),ifUtil.uSortSegment(0,1,h,g)},b.prototype.getCtrlPtsCasteljau=function(a,b,c,d,e,f,g,h){var i=a+e*(b-a),j=b+e*(c-b),k=c+e*(d-c),l=i+e*(j-i),m=j+e*(k-j),n=l+e*(m-l);if((null==f||1==f)&&(g[0]=a,g[1]=i,g[2]=l,g[3]=n),null==f||2==f){if(2==f)var h=g;h[0]=n,h[1]=m,h[2]=k,h[3]=d}},b.prototype.getCtrlPts=function(a,b,c,d,e,f,g){var h;return 0==e?void this.getCtrlPtsCasteljau(a,c,d,b,f,1,g):1==f?void this.getCtrlPtsCasteljau(a,c,d,b,e,2,g):(this.getCtrlPtsCasteljau(a,c,d,b,e,2,g),h=(f-e)/(1-e),void this.getCtrlPtsCasteljau(g[0],g[1],g[2],g[3],h,1,g))},b.prototype.evalPoly=function(a,b,c){var d=0,e=null;if(0>b)return null;if(b>0)if(0!=c)if(e=a[0],1==c)for(d=1;b>=d;++d)e+=a[d];else for(d=1;b>=d;++d)e=e*c+a[d];else e=a[b];else e=a[b];return e},b.prototype.getCoeffPolyDeriv=function(a,b,c){var d=0,e=!1;if(b>=1){for(d=0;b>d;++d)c[d]=a[d]*(b-d);e=!0}return e},b.prototype.getCubicRoots=function(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v=0,w=new Float64Array(4),x=new Float64Array(4),y=new Float64Array(3),z=new Float64Array(2),A=-f;if(b>=c)return 0;if(a[0]<0)for(u=0;4>u;++u)w[u]=-a[u];else for(u=0;4>u;++u)w[u]=a[u];return l=w[0],m=w[1],n=w[2],o=w[3],0==b&&1==c?this.inversePolyUnaryInterval(w,3,x):this.inversePolyInterval(w,3,b,c,x),0==this.estimPositiveRootsDescartes(x,3)?0:(this.getCoeffPolyDeriv(w,3,y),z[0]=6*l,z[1]=2*m,i=m*m-y[0]*n,k=0,0==i?(k=1,g=-m/y[0],h=g):i>0&&(k=2,j=Math.sqrt(i),g=(-m-j)/y[0],h=(-m+j)/y[0]),p=this.evalCubic(l,m,n,o,b),q=this.evalCubic(l,m,n,o,c),0==k||g>=c||b>=h?p>=A&&f>=p?e&&(d[v]=b,v+=1):q>=A&&f>=q?e&&(d[v]=c,v+=1):0>p&&q>0&&(t=this.locateByNewton(b,c,p,q,w,3,y,z,f),d[v]=null!=t?t:(c+b)/2,v+=1):b>=g&&h>=c?p>=A&&f>=p?e&&(d[v]=b,v+=1):q>=A&&f>=q?e&&(d[v]=c,v+=1):p>0&&0>q&&(t=this.locateByNewton(b,c,p,q,w,3,y,z,f),d[v]=null!=t?t:(c+b)/2,v+=1):g>b&&h>=c?(r=this.evalCubic(l,m,n,o,g),r>=A&&f>=r?(d[v]=g,v+=1):r>0&&(p>=A&&f>=p?e&&(d[v]=b,v+=1):0>p&&(t=this.locateByNewton(b,g,p,r,w,3,y,z,f),d[v]=null!=t?t:(b+g)/2,v+=1),q>=A&&f>=q?e&&(d[v]=c,v+=1):0>q&&(t=this.locateByNewton(g,c,r,q,w,3,y,z,f),d[v]=null!=t?t:(g+c)/2,v+=1))):b>=g&&c>h?(s=this.evalCubic(l,m,n,o,h),s>=A&&f>=s?(d[v]=h,v+=1):0>s&&(p>=A&&f>=p?e&&(d[v]=b,v+=1):p>0&&(t=this.locateByNewton(b,h,p,s,w,3,y,z,f),d[v]=null!=t?t:(b+h)/2,v+=1),q>=A&&f>=q?e&&(d[v]=c,v+=1):q>0&&(t=this.locateByNewton(h,c,s,q,w,3,y,z,f),d[v]=null!=t?t:(h+c)/2,v+=1))):g==h?(r=this.evalCubic(l,m,n,o,g),r>=A&&f>=r?(d[v]=g,v+=1):p>=A&&f>=p?e&&(d[v]=b,v+=1):q>=A&&f>=q?e&&(d[v]=c,v+=1):0>r&&q>0?(t=this.locateByNewton(g,c,r,q,w,3,y,z,f),d[v]=null!=t?t:(g+c)/2,v+=1):0>p&&r>0&&(t=this.locateByNewton(b,g,p,r,w,3,y,z,f),d[v]=null!=t?t:(b+g)/2,v+=1)):(r=this.evalCubic(l,m,n,o,g),s=this.evalCubic(m,m,n,o,h),0>=r||s>=0?(r>=A&&f>=r&&(d[v]=g,v+=1),0>=r&&(q>=A&&f>=q?e&&(d[v]=c,v+=1):0>s&&q>0&&(t=this.locateByNewton(h,c,s,q,w,3,y,z,f),d[v]=null!=t?t:(h+c)/2,v+=1)),s>=A&&f>=s&&(d[v]=h,v+=1),s>=0&&(p>=A&&f>=p?e&&(d[v]=b,v+=1):0>p&&r>0&&(t=this.locateByNewton(b,g,p,r,w,3,y,z,f),d[v]=null!=t?t:(b+g)/2,v+=1))):(t=this.locateByNewton(g,h,r,s,w,3,y,z,f),d[v]=null!=t?t:(g+h)/2,v+=1,p>=A&&f>=p?e&&(d[v]=b,v+=1):0>p&&r>0&&(t=this.locateByNewton(b,g,p,r,w,3,y,z,f),d[v]=null!=t?t:(b+g)/2,v+=1),q>=A&&f>=q?(d[v]=c,v+=1):0>s&&q>0&&(t=this.locateByNewton(h,c,s,q,w,3,y,z,f),d[v]=null!=t?t:(h+c)/2,v+=1))),v)},b.prototype._maxIter=100,b.prototype.locateByNewton=function(a,b,c,d,e,f,g,h,i,j,k){var l,m,n,o,p,q,r,s,t,u,v,w,x,y=null,z=f-1,A=-i,B=-this.defaultEps,C=0,D=i+1,E=[],F=[],G=[],H=[],I=[];if(c>=A&&i>=c)return a;if(d>=A&&i>=d)return b;if(o=a,p=b,3==f)n=-h[1]/h[0],a>n||n>b?(m=h[0]*a+h[1],m>0&&c>0||0>m&&0>c?(y=a,D=c):(m=h[0]*b+h[1],m>0&&d>0||0>m&&0>d?(y=b,D=d):y=null)):(D=this.evalPoly(e,f,n),D>=A&&i>=D?y=n:D>0&&c>0||0>D&&0>c?(o=n+i,D=this.evalPoly(e,f,o),m=h[0]*o+h[1],m>0&&D>0||0>m&&0>D?y=o:(m=h[0]*b+h[1],m>0&&d>0||0>m&&0>d?(y=b,D=d):y=null)):D>0&&d>0||0>D&&0>d?(p=n-i,D=this.evalPoly(e,f,p),m=h[0]*p+h[1],m>0&&D>0||0>m&&0>D?y=p:(m=h[0]*a+h[1],m>0&&c>0||0>m&&0>c?(y=a,D=c):y=null)):y=null);else{if(5!=f)throw new Error("Unsupported polynomial degree.");if(w=!1,x=!1,0>c&&d>0||c>0&&0>d?x=!0:j&&k&&(w=!0),s=!0,v=!1,this.getCubicRoots(h,a,b,I,v,i),C=0,0==I.length)o=a,G[0]=c,p=b,G[1]=d,w&&(F[0]=k[0],F[1]=k[1]);else for(ifUtil.uSortSegment(a,b,I,H),o=a,G[0]=c,w&&(F[0]=k[0]);C<=H.length&&(C>0&&(o=p,G[0]=G[1],w&&(F[0]=F[1])),C<H.length?(p=H[C],G[1]=null,w&&(F[1]=null)):(p=b,G[1]=d,w&&(F[1]=k[1])),!(x&&(null==G[1]&&(G[1]=this.evalPoly(e,f,p)),this.isEqualEps(G[1],0,i)&&(y=p,D=G[1],s=!1),G[0]>0&&G[1]<0||G[0]<0&&G[1]>0)))&&(!w||(t=this.countRootsNSturm(e,f,g,o,p,j,F,G),0==t));)++C;if(s&&0==C&&(m=this.evalPoly(h,h.length-1,a),(m>0&&c>0||0>m&&0>c)&&(y=a,D=c,s=!1)),s&&C==H.length&&(m=this.evalPoly(h,h.length-1,b),(m>0&&d>0||0>m&&0>d)&&(y=b,D=d,s=!1)),s){for(q=G[0],r=G[1],w&&(E=F),y=(o+p)/2,m=this.evalPoly(h,h.length-1,y);p-o>i&&s;)y=(o+p)/2,D=this.evalPoly(e,f,y),D>=A&&i>=D?s=!1:m>0&&D>0||0>m&&0>D?s=!1:D>0&&0>q||0>D&&q>0?(p=y,r=D,w&&(E[1]=null)):D>0&&0>r||0>D&&r>0?(o=y,q=D,w&&(E[0]=null)):x||!w?(s=!1,y=null):(G=[q,D],F=[E[0],null],t=this.countRootsNSturm(e,f,g,o,y,j,F,G),t>0?(p=y,r=D,E[0]=F[0],E[1]=F[1]):null!=E[1]&&F[1]==E[1]?s=!1:(o=y,q=D,E[0]=F[0]));s&&(y=(o+p)/2,D=this.evalPoly(e,f,y))}}for(C=1;null!=y&&(A>D||D>i)&&C<this._maxIter;)l=this.evalPoly(g,z,y),l>B&&l<this.defaultEps?(D=this.evalPoly(e,f,y),(A>D||D>i)&&(y=null)):(D=this.evalPoly(e,f,y),l=D/l,u=y,y-=l,(o>=y||y>=p)&&(y=null),l>0?p=u:0>l&&(o=u)),++C;return C==this._maxIter&&(y=null),y},b.prototype.getQuadraticRoots=function(a,b,c,d){var e,f;0==a?0!=b&&d.push(-c/b):(e=b*b-4*a*c,0==e?d.push(-b/(2*a)):e>0&&(f=Math.sqrt(e),d.push((-b+f)/(2*a)),d.push((-b-f)/(2*a))))},b.prototype._pseudoRem=function(a,b,c){var d,e,f,g,h,i=[],j=[],k=!0,l=b[0];if(b.length>a.length)return c=a,1;for(g=2;g<=a.length-b.length+1;++g)l*=b[0];for(g=0;g<a.length;++g)i[g]=a[g]*l;for(;k;){for(e=i[0]/b[0],f=!1,d=1;d<b.length;++d)h=i[d]-e*b[d],(0!=h||f)&&(j.push(h),0!=h&&(f=!0));for(d=b.length;d<i.length;++d)j.push(i[d]);j.length>=b.length?(i=j,j=[]):k=!1}if(j.length>0)for(g=0;g<j.length;++g)c[g]=j[g];return l},b.prototype.getSturmPRS=function(a,b,c,d){var e,f,g,h,i,j,k,l=[],m=[],n=[],o=[],p=[],q=[];for(m[0]=null,d[0]=a,d[1]=c,l[0]=a[0],l[1]=c[0],n[0]=1,m[1]=1,o[0]=1,o[1]=l[1],q[0]=1,q[1]=1,e=1;b>e&&(p=[],k=this._pseudoRem(d[e-1],d[e],p),0!=p.length);++e){for(d[e+1]=[],f=0;f<p.length;++f)d[e+1][f]=p[f]/m[e];for(n[e]=d[e+1].length-d[e].length,l[e+1]=d[e+1][0],h=1,i=1,j=l[e+1],g=2;g<=n[e];++g)h*=o[e],i=-i,j*=l[e+1];m[e+1]=i*h*o[e]*l[e],o[e+1]=j/h,q[e+1]=m[e]>0&&k>0||m[e]<0&&0>k?-q[e-1]:q[e-1]}for(e=2;e<d.length;++e)if(q[e]<0)for(f=0;f<d[e].length;++f)d[e][f]=-d[e][f]},b.prototype.countRootsNSturm=function(a,b,c,d,e,f,g,h){var i,j,k,l=0,m=0;if(null==g[0]){for(null==h[0]&&(h[0]=this.evalPoly(f[0],f[0].length-1,d)),i=h[0],k=1;k<f.length;++k)j=this.evalPoly(f[k],f[k].length-1,d),0!=j&&(0>i&&j>0||i>0&&0>j)&&(++l,i=j);g[0]=l}else l=g[0];if(null==g[1]){for(null==h[1]&&(h[1]=this.evalPoly(f[0],f[0].length-1,e)),i=h[1],k=1;k<f.length;++k)j=this.evalPoly(f[k],f[k].length-1,e),0!=j&&(0>i&&j>0||i>0&&0>j)&&(++m,i=j);g[1]=m}else m=g[1];return l>m?l-m:m-l},b.prototype.locRootsSturm=function(a,b,c,d,e,f,g,h,i,j){var k,l,m,n,o;if(!(1>=g)&&(k=(d+e)/2,l=[h[0],null],m=[i[0],null],n=this.countRootsNSturm(a,b,c,d,k,f,l,m),o=g-n,1==n&&j.push([d,k,m[0],m[1]]),n>1&&this.locRootsSturm(a,b,c,d,k,f,n,l,m,j),1==o&&j.push([k,e,m[1],i[1]]),o>1)){var p=[l[1],h[1]],q=[m[1],i[1]];this.locRootsSturm(a,b,c,k,e,f,o,p,q,j)}},b.prototype.shiftPoly=function(a,b,c,d){var e,f,g=[];for(g[0]=1,e=1;b>=e;++e)g.push(c*g[e-1]);for(d[0]=a[0],e=1;b>=e;++e)for(d[e]=a[e],f=0;e>f;++f)d[e]+=this.combNK(b-f,e-f)*a[f]*g[e-f]},b.prototype._numComb5=[1,5,10,10,5,1],b.prototype._numComb4=[1,4,6,4,1],b.prototype._numComb3=[1,3,3,1],b.prototype._numComb2=[1,2,1],b.prototype._numComb1=[1,1],b.prototype.combNK=function(a,b){if(!(5>=a&&a>=b))throw new Error("Combinations calculation not implemented");return 5==a?this._numComb5[b]:4==a?this._numComb4[b]:3==a?this._numComb3[b]:2==a?this._numComb2[b]:1==a?this._numComb1[b]:0},b.prototype.shiftPolyOne=function(a,b,c){var d,e;for(c[0]=a[0],d=1;b>=d;++d)for(c[d]=a[d],e=0;d>e;++e)c[d]+=this.combNK(b-e,d-e)*a[e]},b.prototype.inversePolyInterval=function(a,b,c,d,e){var f,g,h,i=new Float32Array(b+1);for(f=0;b>=f;++f)i[f]=a[f];if(this.shiftPoly(a,b,c,i),g=d-c,0!=g)for(h=1,f=1;b>=f;++f)h/=g,i[b-f]*=h;this.inversePolyUnaryInterval(i,b,e)},b.prototype.inversePolyUnaryInterval=function(a,b,c){var d,e=new Float32Array(b+1);for(d=0;b>=d;++d)e[d]=a[b-d];this.shiftPolyOne(e,b,c)},b.prototype.estimPositiveRootsDescartes=function(a,b){var c,d=[],e=0,f=0;for(c=0;b>=c;++c)0!=a[c]&&(d.push(a[c]),++e);for(c=0;e-1>c;++c)(d[c]>0&&d[c+1]<0||d[c]<0&&d[c+1]>0)&&(f+=1);return f},b.prototype.convertToConstrain=function(a,b,c,d,e){var f,g,h,i,j,k=.4142,l=new IFTransform(1,0,0,1,0,0);e&&(l=l.rotated(e)),l=l.translated(a,b);var m=l.inverted(),n=m.mapPoint(new IFPoint(c,d)),o=n.getX(),p=n.getY();return f=Math.abs(o),g=Math.abs(p),this.isEqualEps(f,0)||this.isEqualEps(g,0)||this.isEqualEps(f-g,0)?(j=o,i=p):f>g?(j=o,h=g/f,i=k>h?0:0>p?-f:f):(i=p,h=f/g,j=k>h?0:0>o?-g:g),l.mapPoint(new IFPoint(j,i))},a.ifMath=new b}(this),function(a){function b(){}b.prototype.indexOfEquals=function(a,b,c){for(var d=0;d<a.length;++d)if(this.equals(a[d],b,c))return d;return-1},b.prototype.equals=function(a,b,c){if(a||a!==b){if(a&&b){if(a.constructor.equals||b.constructor.equals)return a.constructor===b.constructor?a.constructor.equals(a,b):!1;if(a instanceof Date||b instanceof Date)return a instanceof Date&&b instanceof Date?+a==+b:!1;if(a instanceof Array||b instanceof Array){if(a instanceof Array&&b instanceof Array){if(a.length!==b.length)return!1;for(var d=0;d<a.length;++d)if(!this.equals(a[d],b[d],c))return!1;return!0}return!1}var e=typeof a,f=typeof b;if(e!==f)return!1;if("number"===e)return isNaN(a)||isNaN(b)?isNaN(a)&&isNaN(b):ifMath.isEqualEps(a,b);if("string"===e)return 0===a.localeCompare(b);if("boolean"===e)return+a==+b;if("object"===e){if(c){var g=Object.keys(a),h=Object.keys(b);if(!this.equals(g,h,c))return!1;for(var d=0;d<g.length;++d)if(!this.equals(a[g[d]],b[g[d]]),c)return!1;return!0}return a===b}return!1}return!1}return!0},b.prototype.containsObjectKey=function(a,b){for(var c in b)if(a.indexOf(c)>=0)return!0;return!1};var c="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");b.prototype.uuid=function(a){var b,d=c,e=[],f=d.length,a=a?a:32;for(b=0;a>b;b++)e[b]=d[0|Math.random()*f];return e.join("")},b.prototype.replaceAll=function(a,b,c){for(var d=a;d.indexOf(b)>=0;)d=d.replace(b,c);return d},b.prototype.uSortSegment=function(a,b,c,d){var e=0;if(c.sort(function(a,b){return a-b}),c[0]>=a&&c[0]<=b&&(d[0]=c[0],e=1,1==c.length))return e;for(var f=1;f<c.length;f++)c[f]!=c[f-1]&&c[f]>=a&&c[f]<=b&&(d.push(c[f]),++e);return e},b.prototype.escape=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},b.prototype.unescape=function(a){var b=ifUtil.replaceAll(a,"&lt;","<");return b=ifUtil.replaceAll(b,"&gt;",">"),b=ifUtil.replaceAll(b,"&quot;",'"'),b=ifUtil.replaceAll(b,"&#039;","'"),b=ifUtil.replaceAll(b,"&amp;","&")},b.prototype.isNumeric=function(a){return a-parseFloat(a)>=0},b.prototype.formatNumber=function(a,b,c){return c=c||",",b="number"==typeof b?b:3,ifMath.round(a,!1,b).toString().replace(".",c)},b.prototype.parseNumber=function(a){for(var b="",c=!1,d=a.length;d>=0;--d){var e=a.charAt(d);","!==e||c?this.isNumeric(e)&&(b=e+b):b="."+b}return parseFloat(b)},b.prototype.blendRGBColors=function(a,b,c){return c=Math.min(Math.max(c,0),1),[a[0]*(1-c)+b[0]*c,a[1]*(1-c)+b[1]*c,a[2]*(1-c)+b[2]*c]},b.prototype.rgbToHtmlHex=function(a){var b=a[0]<<16|a[1]<<8|a[2];return"#"+function(a){return new Array(7-a.length).join("0")+a}(b.toString(16).toUpperCase())},a.ifUtil=new b}(this),function(a){function b(){}IFObject.inherit(b,IFObject),b.prototype._paramsToString=function(){return""},a.GEvent=b}(this),function(a){function b(){}b.prototype._listeners=null,b.prototype.addEventListener=function(a,b,c,d){var e=IFObject.getTypeId(a);this._listeners||(this._listeners={});var f=b;if(c||d){var g=d?d.slice():[];g.unshift(c?c:b),b=Function.prototype.bind.apply(b,g)}e in this._listeners||(this._listeners[e]={eventClass:a,listeners:[]}),this._listeners[e].listeners.push({listener:b,sourceListener:f,target:c})},b.prototype.removeEventListener=function(a,b,c){var d=IFObject.getTypeId(a);if(this._listeners&&d in this._listeners){for(var e=this._listeners[d].listeners,f=0;f<e.length;++f)e[f].sourceListener!=b||c&&e[f].target!==c||e.splice(f,1);0==e.length&&delete this._listeners[d]}},b.prototype.hasEventListeners=function(a){var b=IFObject.getTypeId(a);return this._listeners&&b in this._listeners?!0:!1},b.prototype.trigger=function(a){if(this._listeners){var b=IFObject.getTypeId(a);if(b in this._listeners)for(var c=this._listeners[b].listeners,d=0;d<c.length;++d){var e=c[d];e.listener.call(this,a)}}},a.GEventTarget=b}(this),function(a){function b(){}IFObject.inherit(b,GEvent),b.prototype.toString=function(){return"[Object GUIInputEvent("+this._paramsToString()+")]"},b.prototype._paramsToString=function(){return""},a.GUIInputEvent=b}(this),function(a){function b(){}IFObject.inherit(b,GUIInputEvent),b.prototype.key=null,b.prototype.toString=function(){return"[Object GUIKeyEvent("+this._paramsToString()+")]"},b.prototype.GUIKeyEvent=function(){return"key="+this.key},a.GUIKeyEvent=b,b.Down=function(){},IFObject.inherit(b.Down,b),b.Down.prototype.toString=function(){return"[Object GUIKeyEvent.Down("+this._paramsToString()+")]"},b.Release=function(){},IFObject.inherit(b.Release,b),b.Release.prototype.toString=function(){return"[Object GUIKeyEvent.Release("+this._paramsToString()+")]"},b.Press=function(){},IFObject.inherit(b.Press,b),b.Press.prototype.toString=function(){return"[Object GUIKeyEvent.Press("+this._paramsToString()+")]"}}(this),function(a){function b(){}IFObject.inherit(b,GUIInputEvent),b.BUTTON_LEFT=0,b.BUTTON_MIDDLE=1,b.BUTTON_RIGHT=2,b.isDragEvent=function(a){return a instanceof b&&(a instanceof b.DragStart||a instanceof b.Drag||a instanceof b.DragEnd)||a==b.DragStart||a==b.Drag||a==b.DragEnd},b.prototype.client=0,b.prototype.button=0,b.prototype.toString=function(){return"[Object GUIMouseEvent("+this._paramsToString()+")]"},b.prototype._paramsToString=function(){return"client="+this.client.toString()+", "+GUIInputEvent.prototype._paramsToString.call(this)},a.GUIMouseEvent=b,b.Move=function(){},IFObject.inherit(b.Move,b),b.Move.prototype.toString=function(){return"[Object GUIMouseEvent.Move("+this._paramsToString()+")]"},b.Enter=function(){},IFObject.inherit(b.Enter,b),b.Enter.prototype.toString=function(){return"[Object GUIMouseEvent.Enter("+this._paramsToString()+")]"},b.Leave=function(){},IFObject.inherit(b.Leave,b),b.Leave.prototype.toString=function(){return"[Object GUIMouseEvent.Leave("+this._paramsToString()+")]"},b.Down=function(){},IFObject.inherit(b.Down,b),b.Down.prototype.toString=function(){return"[Object GUIMouseEvent.Down("+this._paramsToString()+")]"},b.Release=function(){},IFObject.inherit(b.Release,b),b.Release.prototype.toString=function(){return"[Object GUIMouseEvent.Release("+this._paramsToString()+")]"},b.Click=function(){},IFObject.inherit(b.Click,b),b.Click.prototype.toString=function(){return"[Object GUIMouseEvent.Click("+this._paramsToString()+")]"},b.DblClick=function(){},IFObject.inherit(b.DblClick,b),b.DblClick.prototype.toString=function(){return"[Object GUIMouseEvent.DblClick("+this._paramsToString()+")]"},b.DragStart=function(){},IFObject.inherit(b.DragStart,b),b.DragStart.prototype.toString=function(){return"[Object GUIMouseEvent.DragStart("+this._paramsToString()+")]"},b.Drag=function(){},IFObject.inherit(b.Drag,b),b.prototype.clientStart=0,b.prototype.clientDelta=0,b.Drag.prototype.toString=function(){return"[Object GUIMouseEvent.Drag("+this._paramsToString()+")]"},b.DragEnd=function(){},IFObject.inherit(b.DragEnd,b.Drag),b.DragEnd.prototype.toString=function(){return"[Object GUIMouseEvent.DragEnd("+this._paramsToString()+")]"}}(this),function(a){function b(a,c){this._value=a,this._unit=c?c:b.Unit.PT}b.Unit={PT:"t",PX:"x",PC:"p",IN:"i",MM:"m",CM:"c"};var c=72,d={t:1,x:1,p:c/6,i:c,m:c/25.4,c:c/2.54};b.parseLength=function(a,c){if(!a)return null;if(a=a.trim(),0==a.length)return null;var d=ifUtil.parseNumber(a);if("number"!=typeof d)return null;var e=c?c:b.Unit.PT,f=a.substr(d.toString().length);return f&&f.length>0&&(f=f.trim().toLowerCase(),f.length>=2&&"p"==f.charAt(0)&&"t"==f.charAt(1)?e=b.Unit.PT:f.length>=2&&"p"==f.charAt(0)&&"x"==f.charAt(1)?e=b.Unit.PX:f.length>=2&&"p"==f.charAt(0)&&"c"==f.charAt(1)?e=b.Unit.PC:f.length>=2&&"i"==f.charAt(0)&&"n"==f.charAt(1)?e=b.Unit.IN:f.length>=2&&"m"==f.charAt(0)&&"m"==f.charAt(1)?e=b.Unit.MM:f.length>=2&&"c"==f.charAt(0)&&"m"==f.charAt(1)?e=b.Unit.CM:f.length>=1&&"m"==f.charAt(0)&&(e=b.Unit.M)),new b(d,e)},b.parseEquation=function(a,c){c=c||b.Unit.PT;
var d=new e.Context(c),f=new e.Evaluator(d);try{return result=f.evaluate(a),new b(result,c)}catch(g){return null}},b.parseEquationValue=function(a){var c=b.parseEquation(a);return c?c.getValue():null},b.prototype._value=null,b.prototype._unit=b.Unit.PT,b.prototype.getValue=function(){return this._value},b.prototype.getUnit=function(){return this._unit},b.prototype.toPoint=function(){return this._unit!=b.Unit.PT?d[this._unit]*this._value:this._value},b.prototype.toUnit=function(a){if(this._unit!=a){var b=this.toPoint();return b/d[a]}return this._value},b.prototype.convert=function(a){if(this._unit!=a){var c=this.toPoint();return new b(c/d[a],a)}return new b(this._value,a)},b.prototype.toString=function(a){var c=ifUtil.formatNumber(this._value,a);switch(this._unit){case b.Unit.PT:c+="pt";break;case b.Unit.PX:c+="px";break;case b.Unit.PC:c+="pc";break;case b.Unit.IN:c+="in";break;case b.Unit.MM:c+="mm";break;case b.Unit.CM:c+="cm"}return c};var e={};e.Token={Operator:"Operator",Identifier:"Identifier",Number:"Number"},e.Lexer=function(){function a(){var a=s;return r>a?q.charAt(a):"\x00"}function b(){var a="\x00",b=s;return r>b&&(a=q.charAt(b),s+=1),a}function c(a){return"	"===a||" "===a||" "===a}function d(a){return a>="a"&&"z">=a||a>="A"&&"Z">=a}function f(a){return a>="0"&&"9">=a}function g(a,b){return{unit:a,value:b,start:t,end:s-1}}function h(){for(var d;r>s&&(d=a(),c(d));)b()}function i(){var c=a();return"+-*/()^%=;,".indexOf(c)>=0?g(u.Operator,b()):void 0}function j(a){return"_"===a||d(a)}function k(a){return j(a)||f(a)}function l(){var c,d;if(c=a(),!j(c))return void 0;for(d=b();;){if(c=a(),!k(c))break;d+=b()}return g(u.Identifier,d)}function m(){var c,e;if(c=a(),!f(c)&&"."!==c)return void 0;if(e="","."!==c)for(e=b();;){if(c=a(),!f(c))break;e+=b()}if("."===c||","===c)for(e+=b();;){if(c=a(),!f(c))break;e+=b()}if("e"===c||"E"===c){if(e+=b(),c=a(),"+"!==c&&"-"!==c&&!f(c))throw c="character "+c,s>=r&&(c="<end>"),new SyntaxError("Unexpected "+c+" after the exponent sign");for(e+=b();;){if(c=a(),!f(c))break;e+=b()}}if(d(c))for(e+=b();;){if(c=a(),!d(c))break;e+=b()}if("."===e)throw new SyntaxError("Expecting decimal digits after the dot sign");return g(u.Number,e)}function n(a){q=a,r=a.length,s=0}function o(){var b;if(h(),s>=r)return void 0;if(t=s,b=m(),"undefined"!=typeof b)return b;if(b=i(),"undefined"!=typeof b)return b;if(b=l(),"undefined"!=typeof b)return b;throw new SyntaxError("Unknown token from character "+a())}function p(){var a,b;b=s;try{a=o(),delete a.start,delete a.end}catch(c){a=void 0}return s=b,a}var q="",r=0,s=0,t=0,u=e.Token;return{reset:n,next:o,peek:p}},e.Parser=function(){function a(a,b){return"undefined"!=typeof a&&a.unit===m.Operator&&a.value===b}function b(){for(var b,c,d=[];;){if(c=j(),"undefined"==typeof c)break;if(d.push(c),b=l.peek(),!a(b,","))break;l.next()}return d}function c(c){var d,e=[];if(d=l.next(),!a(d,"("))throw new SyntaxError('Expecting ( in a function call "'+c+'"');if(d=l.peek(),a(d,")")||(e=b()),d=l.next(),!a(d,")"))throw new SyntaxError('Expecting ) in a function call "'+c+'"');return{FunctionCall:{name:c,args:e}}}function d(){var b,d;if(b=l.peek(),"undefined"==typeof b)throw new SyntaxError("Unexpected termination of expression");if(b.unit===m.Identifier)return b=l.next(),a(l.peek(),"(")?c(b.value):{Identifier:b.value};if(b.unit===m.Number)return b=l.next(),{Number:b.value};if(a(b,"(")){if(l.next(),d=i(),b=l.next(),!a(b,")"))throw new SyntaxError("Expecting )");return{Expression:d}}throw new SyntaxError("Parse error, can not process token "+b.value)}function f(){var b,c;return b=l.peek(),a(b,"-")||a(b,"+")?(b=l.next(),c=f(),{Unary:{operator:b.value,expression:c}}):d()}function g(){var b,c;for(b=f(),c=l.peek();a(c,"*")||a(c,"/");)c=l.next(),b={Binary:{operator:c.value,left:b,right:f()}},c=l.peek();return b}function h(){var b,c;for(b=g(),c=l.peek();a(c,"+")||a(c,"-");)c=l.next(),b={Binary:{operator:c.value,left:b,right:g()}},c=l.peek();return b}function i(){var b,c;return c=h(),"undefined"!=typeof c&&c.Identifier?(b=l.peek(),a(b,"=")?(l.next(),{Assignment:{name:c,value:i()}}):c):c}function j(){return i()}function k(a){var b,c;if(l.reset(a),b=j(),c=l.next(),"undefined"!=typeof c)throw new SyntaxError("Unexpected token "+c.value);return{Expression:b}}var l=new e.Lexer,m=e.Token;return{parse:k}},e.Context=function(a){var b,c;return b={pi:3.141592653589793,phi:1.618033988749895},c={abs:Math.abs,acos:Math.acos,asin:Math.asin,atan:Math.atan,ceil:Math.ceil,cos:Math.cos,exp:Math.exp,floor:Math.floor,ln:Math.ln,random:Math.random,sin:Math.sin,sqrt:Math.sqrt,tan:Math.tan},{Unit:a,Constants:b,Functions:c,Variables:{}}},e.Evaluator=function(a){function c(d){var e,f,h,i,j;if(d.hasOwnProperty("Expression"))return c(d.Expression);if(d.hasOwnProperty("Number")){var k=b.parseLength(d.Number,a.Unit);if(!k)throw new SyntaxError("Invalid length "+d.Number);return k.toUnit(a.Unit)}if(d.hasOwnProperty("Binary"))switch(d=d.Binary,e=c(d.left),f=c(d.right),d.operator){case"+":return e+f;case"-":return e-f;case"*":return e*f;case"/":return e/f;default:throw new SyntaxError("Unknown operator "+d.operator)}if(d.hasOwnProperty("Unary"))switch(d=d.Unary,h=c(d.expression),d.operator){case"+":return h;case"-":return-h;default:throw new SyntaxError("Unknown operator "+d.operator)}if(d.hasOwnProperty("Identifier")){if(g.Constants.hasOwnProperty(d.Identifier))return g.Constants[d.Identifier];if(g.Variables.hasOwnProperty(d.Identifier))return g.Variables[d.Identifier];throw new SyntaxError("Unknown identifier")}if(d.hasOwnProperty("Assignment"))return f=c(d.Assignment.value),g.Variables[d.Assignment.name.Identifier]=f,f;if(d.hasOwnProperty("FunctionCall")){if(h=d.FunctionCall,g.Functions.hasOwnProperty(h.name)){for(i=[],j=0;j<h.args.length;j+=1)i.push(c(h.args[j]));return g.Functions[h.name].apply(null,i)}throw new SyntaxError("Unknown function "+h.name)}throw new SyntaxError("Unknown syntax node")}function d(a){var b=f.parse(a);return c(b)}var f=new e.Parser,g=arguments.length<1?new e.Context(b.Unit.PT):a;return{evaluate:d}},a.IFLength=b}(this),function(a){function b(a,b){this._x=a,this._y=b}b.equals=function(a,b){return a&&a==b?!0:a&&b?ifMath.isEqualEps(a._x,b._x)&&ifMath.isEqualEps(a._y,b._y):!1},b.min=function(){for(var a=new b(null,null),c=0;c<arguments.length;++c)(null==a._x||arguments[c]._x<a._x)&&(a._x=arguments[c]._x),(null==a._y||arguments[c]._y<a._y)&&(a._y=arguments[c]._y);return a},b.max=function(){for(var a=new b(null,null),c=0;c<arguments.length;++c)(null==a._x||arguments[c]._x>a._x)&&(a._x=arguments[c]._x),(null==a._y||arguments[c]._y>a._y)&&(a._y=arguments[c]._y);return a},b.prototype._x=0,b.prototype._y=0,b.prototype.getX=function(){return this._x},b.prototype.getY=function(){return this._y},b.prototype.subtract=function(a){return new b(this._x-a._x,this._y-a._y)},b.prototype.add=function(a){return new b(this._x+a._x,this._y+a._y)},b.prototype.translated=function(a,c){return new b(this._x+a,this._y+c)},b.prototype.rotated=function(a){var c=Math.cos(a),d=Math.sin(a);return new b(c*this._x-d*this._y,d*this._x+c*this._y)},b.prototype.rotatedAt=function(a,c){if(!c)return this.rotated(a);var d=Math.cos(a),e=Math.sin(a);return new b(d*(this._x-c._x)-e*(this._y-c._y)+c._x,e*(this._x-c._x)+d*(this._y-c._y)+c._y)},b.prototype.toString=function(){return"[Object IFPoint(x="+this._x+", y="+this._y+"]"},a.IFPoint=b}(this),function(a){function b(a,b,c,d){this._x=a?a:0,this._y=b?b:0,this._width=c?c:0,this._height=d?d:0}b.Side={TOP_LEFT:"tl",TOP_CENTER:"tc",TOP_RIGHT:"tr",RIGHT_CENTER:"rc",BOTTOM_RIGHT:"br",BOTTOM_CENTER:"bc",BOTTOM_LEFT:"bl",LEFT_CENTER:"lc",CENTER:"cc"},b.UNIT_RECT=new b(0,0,1,1),b.fromPoints=function(){var a=IFPoint.min.apply(null,arguments),c=IFPoint.max.apply(null,arguments);return new b(a.getX(),a.getY(),c.getX()-a.getX(),c.getY()-a.getY())},b.equals=function(a,b){return a||a!==b?a&&b?ifMath.isEqualEps(a._x,b._x)&&ifMath.isEqualEps(a._y,b._y)&&ifMath.isEqualEps(a._width,b._width)&&ifMath.isEqualEps(a._height,b._height):!1:!0},b.prototype._x=0,b.prototype._y=0,b.prototype._width=0,b.prototype._height=0,b.prototype.getX=function(){return this._x},b.prototype.getY=function(){return this._y},b.prototype.getWidth=function(){return this._width},b.prototype.getHeight=function(){return this._height},b.prototype.isEmpty=function(){return this._width<=0&&this._height<=0},b.prototype.containsPoint=function(a){return this.containsPointXY(a.getX(),a.getY())},b.prototype.containsPointXY=function(a,b){var c=this._x,d=this._x;if(this._width<0?c+=this._width:d+=this._width,c==d)return!1;if(c>a||a>d)return!1;var e=this._y,f=this._y;return this._height<0?e+=this._height:f+=this._height,e==f?!1:e>b||b>f?!1:!0},b.prototype.containsRect=function(a){var b=this._x,c=this._x;if(this._width<0?b+=this._width:c+=this._width,b==c)return!1;var d=a._x,e=a._x;if(a._width<0?d+=a._width:e+=a._width,d==e)return!1;if(b>d||e>c)return!1;var f=this._y,g=this._y;if(this._height<0?f+=this._height:g+=this._height,f==g)return!1;var h=a._y,i=a._y;return a._height<0?h+=a._height:i+=a._height,h==i?!1:f>h||i>g?!1:!0},b.prototype.intersectsRect=function(a){return this.intersectsRectXYWH(a._x,a._y,a._width,a._height)},b.prototype.intersectsRectXYWH=function(a,b,c,d){var e=this._x,f=this._x;if(this._width<0?e+=this._width:f+=this._width,e==f)return!1;var g=a,h=a;if(0>c?g+=c:h+=c,g==h)return!1;if(e>=h||g>=f)return!1;var i=this._y,j=this._y;if(this._height<0?i+=this._height:j+=this._height,i==j)return!1;var k=b,l=b;return 0>d?k+=d:l+=d,k==l?!1:i>=l||k>=j?!1:!0},b.prototype.expanded=function(a,c,d,e){return new b(this._x-a,this._y-c,this._width+a+d,this._height+c+e)},b.prototype.translated=function(a,c){return new b(this._x+a,this._y+c,this._width,this._height)},b.prototype.scaled=function(a,c){return new b(this._x*a,this._y*c,this._width*a,this._height*c)},b.prototype.scaledAt=function(a,c,d){return d?new b((this._x-d.getX())*a+d.getX(),(this._y-d.getY())*c+d.getY(),this._width*a,this._height*c):this.scaled(a,c)},b.prototype.united=function(a){var c=this._x,d=this._x;if(this._width<0?c+=this._width:d+=this._width,c==d)return a;var e=a._x,f=a._x;if(a._width<0?e+=a._width:f+=a._width,e==f)return this;var g=this._y,h=this._y;if(this._height<0?g+=this._height:h+=this._height,g==h)return a;var i=a._y,j=a._y;if(a._height<0?i+=a._height:j+=a._height,i==j)return this;var k=new b;return k._x=Math.min(c,e),k._y=Math.min(g,i),k._width=Math.max(d,f)-k._x,k._height=Math.max(h,j)-k._y,k},b.prototype.intersected=function(a){var c=this._x,d=this._x;if(this._width<0?c+=this._width:d+=this._width,c==d)return new b(0,0,0,0);var e=a._x,f=a._x;if(a._width<0?e+=a._width:f+=a._width,e==f)return new b(0,0,0,0);if(c>=f||e>=d)return new b(0,0,0,0);var g=this._y,h=this._y;if(this._height<0?g+=this._height:h+=this._height,g==h)return new b(0,0,0,0);var i=a._y,j=a._y;if(a._height<0?i+=a._height:j+=a._height,i==j)return new b(0,0,0,0);if(g>=j||i>=h)return new b(0,0,0,0);var k=new b;return k._x=Math.max(c,e),k._y=Math.max(g,i),k._width=Math.min(d,f)-k._x,k._height=Math.min(h,j)-k._y,k},b.prototype.toAlignedRect=function(){var a=Math.floor(this._x),c=Math.ceil(this._x+this._width),d=Math.floor(this._y),e=Math.ceil(this._y+this._height);return new b(a,d,c-a,e-d)},b.prototype.getSide=function(a){switch(a){case b.Side.TOP_LEFT:return new IFPoint(this._x,this._y);case b.Side.TOP_CENTER:return new IFPoint(this._x+this._width/2,this._y);case b.Side.TOP_RIGHT:return new IFPoint(this._x+this._width,this._y);case b.Side.RIGHT_CENTER:return new IFPoint(this._x+this._width,this._y+this._height/2);case b.Side.BOTTOM_RIGHT:return new IFPoint(this._x+this._width,this._y+this._height);case b.Side.BOTTOM_CENTER:return new IFPoint(this._x+this._width/2,this._y+this._height);case b.Side.BOTTOM_LEFT:return new IFPoint(this._x,this._y+this._height);case b.Side.LEFT_CENTER:return new IFPoint(this._x,this._y+this._height/2);case b.Side.CENTER:return new IFPoint(this._x+this._width/2,this._y+this._height/2);default:throw new Error("Illegal Argument: "+a)}},b.prototype.getClosestSideName=function(a){var c=[b.Side.TOP_LEFT,b.Side.TOP_CENTER,b.Side.TOP_RIGHT,b.Side.LEFT_CENTER,b.Side.CENTER,b.Side.RIGHT_CENTER,b.Side.BOTTOM_LEFT,b.Side.BOTTOM_CENTER,b.Side.BOTTOM_RIGHT],d=1,e=1;return a.getX()<=this._x+this._width/3?d=0:a.getX()>=this._x+2*this._width/3&&(d=2),a.getY()<=this._y+this._height/3?e=0:a.getY()>=this._y+2*this._height/3&&(e=2),c[3*e+d]},b.prototype.toString=function(){return"[Object IFRect(x="+this._x+", y="+this._y+", width="+this._width+", height="+this._height+")]"},a.IFRect=b}(this),function(a){function b(a,b,c,d,e,f){this._sx="number"==typeof a?a:1,this._shy="number"==typeof b?b:0,this._shx="number"==typeof c?c:0,this._sy="number"==typeof d?d:1,this._tx="number"==typeof e?e:0,this._ty="number"==typeof f?f:0}b.serialize=function(a){var b=[];return ifMath.isEqualEps(a._sx,1)&&ifMath.isEqualEps(a._sy,1)||(b=b.concat(["S"],a._sx,a._sy)),ifMath.isEqualEps(a._shx,0)&&ifMath.isEqualEps(a._shy,0)||(b=b.concat(["H"],a._shx,a._shy)),ifMath.isEqualEps(a._tx,0)&&ifMath.isEqualEps(a._ty,0)||(b=b.concat(["T"],a._tx,a._ty)),b},b.deserialize=function(a){for(var c=1,d=0,e=0,f=1,g=0,h=1,i=-1,j=0;j<a.length;)if("string"==typeof a[j]){if("S"===a[j])i=0;else if("H"===a[j])i=1;else{if("T"!==a[j])throw new Error("Broken transform integrity.");i=2}j+=1}else{switch(i){case 0:c=a[j],f=a[j+1];break;case 1:e=a[j],d=a[j+1];break;case 2:g=a[j],h=a[j+1];break;default:throw new Error("Broken transform integrity.")}j+=2}return new b(c,d,e,f,g,h)},b.equals=function(a,b){return a&&a==b?!0:a&&b?ifMath.isEqualEps(a._sx,b._sx)&&ifMath.isEqualEps(a._shy,b._shy)&&ifMath.isEqualEps(a._shx,b._shx)&&ifMath.isEqualEps(a._sy,b._sy)&&ifMath.isEqualEps(a._tx,b._tx)&&ifMath.isEqualEps(a._ty,b._ty):!1},b.prototype._sx,b.prototype._shy,b.prototype._shx,b.prototype._sy,b.prototype._tx,b.prototype._ty,b.prototype.isIdentity=function(){return ifMath.isEqualEps(this._sx,1)&&ifMath.isEqualEps(this._shy,0)&&ifMath.isEqualEps(this._shx,0)&&ifMath.isEqualEps(this._sy,1)&&ifMath.isEqualEps(this._tx,0)&&ifMath.isEqualEps(this._ty,0)},b.prototype.isValid=function(){return Math.abs(this._sx)>ifMath.defaultEps&&Math.abs(this._sy)>ifMath.defaultEps},b.prototype.getMatrix=function(){return[this._sx,this._shy,this._shx,this._sy,this._tx,this._ty]},b.prototype.getDeterminant=function(){return this._sx*this._sy-this._shy*this._shx},b.prototype.getDeterminantReciprocal=function(){return 1/(this._sx*this._sy-this._shy*this._shx)},b.prototype.getTranslation=function(){return new IFPoint(this._tx,this._ty)},b.prototype.getScaleFactor=function(){var a=.707106781*this._sx+.707106781*this._shx,b=.707106781*this._shy+.707106781*this._sy;return Math.sqrt(a*a+b*b)},b.prototype.getRotationFactor=function(){return Math.atan2(this._shx,this._sx)},b.prototype.multiplied=function(a){var c=this._sx,d=this._shy,e=this._shx,f=this._sy,g=this._tx,h=this._ty,i=c*a._sx+d*a._shx,j=e*a._sx+f*a._shx,k=g*a._sx+h*a._shx+a._tx;return d=c*a._shy+d*a._sy,f=e*a._shy+f*a._sy,h=g*a._shy+h*a._sy+a._ty,c=i,e=j,g=k,new b(c,d,e,f,g,h)},b.prototype.preMultiplied=function(a){var c=a._sx*this._sx+a._shy*this._shx,d=a._sx*this._shy+a._shy*this._sy,e=a._shx*this._shy+a._sy*this._sy,f=a._shx*this._sx+a._sy*this._shx,g=a._tx*this._sx+a._ty*this._shx+this._tx,h=a._tx*this._shy+a._ty*this._sy+this._ty;return new b(c,d,f,e,g,h)},b.prototype.inverted=function(){var a=this._sx,c=this._sy,d=this._shx,e=this._shy,f=this._tx,g=this._ty,h=1/(a*c-e*d),i=c*h;c=a*h,e=-e*h,d=-d*h;var j=-f*i-g*d;return g=-f*e-g*c,a=i,f=j,new b(a,e,d,c,f,g)},b.prototype.rotated=function(a){return this.multiplied(new b(Math.cos(a),Math.sin(a),-Math.sin(a),Math.cos(a),0,0))},b.prototype.translated=function(a,c){return this.multiplied(new b(1,0,0,1,a,c))},b.prototype.scaled=function(a,c){return c||(c=a),this.multiplied(new b(a,0,0,c,0,0))},b.prototype.skewed=function(a,c){return this.multiplied(new b(1,Math.tan(c),Math.tan(a),1,0,0))},b.prototype.map=function(a){if(!this.isIdentity()){var b=a.x;a.x=b*this._sx+a.y*this._shx+this._tx,a.y=b*this._shy+a.y*this._sy+this._ty}},b.prototype.mapPoint=function(a){if(this.isIdentity())return a;var b=a.getX(),c=a.getY(),d=b*this._sx+c*this._shx+this._tx,e=b*this._shy+c*this._sy+this._ty;return new IFPoint(d,e)},b.prototype.mapRect=function(a){if(this.isIdentity()||null==a)return a;var b=a.getSide(IFRect.Side.TOP_LEFT),c=a.getSide(IFRect.Side.TOP_RIGHT),d=a.getSide(IFRect.Side.BOTTOM_RIGHT),e=a.getSide(IFRect.Side.BOTTOM_LEFT);return IFRect.fromPoints(this.mapPoint(b),this.mapPoint(c),this.mapPoint(d),this.mapPoint(e))},b.prototype.toString=function(){return"[Object IFTransform(sx="+this._sx.toString()+", shy="+this._shy.toString()+", shx="+this._shx.toString()+", sx="+this._sx.toString()+", tx="+this._tx.toString()+", ty="+this._ty.toString()+")]"},a.IFTransform=b}(this),function(a){function b(){}b.Command={Move:1,Line:2,Curve:3,Curve2:4,Close:5},b.prototype.command=null,b.prototype.x=null,b.prototype.y=null,a.IFVertex=b}(this),function(a){function b(){}b.prototype.rewindVertices=function(){return!1},b.prototype.readVertex=function(){return!1},b.prototype.toString=function(){return"[Object IFVertexSource]"},a.IFVertexSource=b}(this),function(a){function b(){}b.prototype.addVertex=function(){throw new Error("Not Supported")},b.prototype.appendVertices=function(a,b){if(a.rewindVertices(b?b:0))for(var c=new IFVertex;a.readVertex(c);)this.addVertex(c.command,c.x,c.y)},b.prototype.clearVertices=function(){throw new Error("Not Supported.")},b.prototype.toString=function(){return"[Object IFVertexTarget]"},a.IFVertexTarget=b}(this),function(a){function b(){this._vertices=[]}IFObject.mix(b,[IFVertexSource,IFVertexTarget]),b.prototype._index=0,b.prototype._vertices=null,b.prototype.addVertex=function(a,b,c){this._vertices.push({c:a,x:b,y:c}),this._index=this._vertices.length+1},b.prototype.clearVertices=function(){this._vertices=[]},b.prototype.transformVertices=function(a){for(var b=0;b<this._vertices.length;++b)a.map(this._vertices[b])},b.prototype.getCount=function(){return this._vertices.length},b.prototype.rewindVertices=function(a){return a>=0&&a<=this._vertices.length?(this._index=a,!0):!1},b.prototype.readVertex=function(a){if(this._index>=0&&this._index<this._vertices.length){var b=this._vertices[this._index];return a.command=b.c,a.x=b.x,a.y=b.y,this._index++,!0}return!1},b.prototype.toString=function(){return"[Object IFVertexContainer]"},a.IFVertexContainer=b}(this),function(a){function b(){}b.HitResult=function(){},b.HitResult.prototype.segment=null,b.HitResult.prototype.x=null,b.HitResult.prototype.y=null,b.HitResult.prototype.slope=null,b.HitResult.prototype.outline=null,b.prototype._hitTestSegment=function(a,b,c,d,e,f,g,h,i){var j=[],k=ifMath.sqrSegmentDist(a,b,c,d,e,f,j,g);return g>=k?(i&&(i.segment=h,i.x=a+j[0]*(c-a),i.y=b+j[0]*(d-b),i.slope=j[0],i.outline=!0),!0):!1},b.prototype._hitTestCurve=function(a,b,c,d,e,f,g,h,i,j,k){var l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D=[],E=new Float64Array(5),F=new Float64Array(4),G=[],H=1e-6,I=!1,J=!0;if(z=(a+c+e)/3,A=(b+d+f)/3,p=ifMath.sqrSegmentDist(a,b,c,d,g,h,D,i),i>=p?I=!0:ifMath.segmentSide(a,b,c,d,g,h)*ifMath.segmentSide(a,b,c,d,z,A)<0&&(J=!1),I&&(0==D[0]||1==D[0]))return k&&(k.segment=j,k.outline=!0,k.slope=D[0],0==D[0]?(k.x=a,k.y=b):(k.x=c,k.y=d)),!0;if(q=ifMath.sqrSegmentDist(a,b,e,f,g,h),i>=q?I=!0:ifMath.segmentSide(a,b,e,f,g,h)*ifMath.segmentSide(a,b,e,f,z,A)<0&&(J=!1),r=ifMath.sqrSegmentDist(e,f,c,d,g,h),i>=r?I=!0:ifMath.segmentSide(e,f,c,d,g,h)*ifMath.segmentSide(e,f,c,d,z,A)<0&&(J=!1),!I&&!J)return!1;if(l=c-2*e+a,m=d-2*f+b,0==l&&0==m)return this._hitTestSegment(a,b,c,d,g,h,i,j,k);if(n=2*(e-a),o=2*(f-b),E[0]=l*l+m*m,E[1]=2*(l*n+m*o),E[2]=n*n+o*o+2*l*(a-g)+2*m*(b-h),E[3]=2*(n*(a-g)+o*(b-h)),E[4]=(a-g)*(a-g)+(b-h)*(b-h),B=2*E[0],s=3*E[1]/(2*B),t=E[2]/B,u=E[3]/(2*B),F[0]=1,F[1]=s,F[2]=t,F[3]=u,y=!1,v=ifMath.getCubicRoots(F,0,1,G,y,H),0==v)return!1;for(w=i+1,x=v+1,C=0;v>C;++C)B=ifMath.evalPoly(E,4,G[C]),w>B&&(w=B,x=C);return i>=w?(k&&(k.segment=j,k.x=(G[x]*l+n)*G[x]+a,k.y=(G[x]*m+o)*G[x]+b,k.outline=!0,k.slope=G[x]),!0):!1},b.prototype._hitTestCurve2=function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z=[],$=new Float64Array(7),_=new Float64Array(6),ab=new Float64Array(6),bb=new Float64Array(4),cb=new Float64Array(4),db=null,eb=null,fb=!1,gb=!0,hb=[];if(s=e-a,w=3*s,t=f-b,x=3*t,A=g-e-s,u=3*A,q=2*A,A=h-f-t,v=3*A,r=2*A,o=c-g-s-q,p=d-h-t-r,B=a-i,C=b-j,$[0]=o*o+p*p,$[1]=2*(o*u+p*v),$[2]=u*u+v*v+2*(o*w+p*x),$[3]=2*(o*B+u*w+p*C+v*x),$[4]=w*w+x*x+2*(u*B+v*C),$[5]=2*(w*B+x*C),$[6]=B*B+C*C,ifMath.getCoeffPolyDeriv($,6,_),ifMath.inversePolyUnaryInterval(_,5,ab),0==ifMath.estimPositiveRootsDescartes(ab,5))return y=ifMath.ptSqrDist(a,b,i,j),z=ifMath.ptSqrDist(c,d,i,j),k>=y||k>=z?(m&&(m.segment=l,m.outline=!0,z>y?(m.x=a,m.y=b,m.slope=0):(m.x=c,m.y=d,m.slope=1)),!0):!1;n=ifMath.getCubicCurveSplits(o,q,s,p,r,t,Z);for(var ib=0;n-1>ib;++ib){if(0==ib){if(D=Z[ib],F=ifMath.evalCubic(o,u,w,a,D),G=ifMath.evalCubic(p,v,x,b,D),J=ifMath.ptSqrDist(F,G,i,j),k>=J)return m&&(m.segment=l,m.outline=!0,m.x=F,m.y=G,m.slope=D),!0}else D=E,F=H,G=I,J=K;if(E=Z[ib+1],H=ifMath.evalCubic(o,u,w,a,E),I=ifMath.evalCubic(p,v,x,b,E),K=ifMath.ptSqrDist(H,I,i,j),k>=K)return m&&(m.segment=l,m.outline=!0,m.x=H,m.y=I,m.slope=E),!0;for(ifMath.getCtrlPts(a,c,e,g,D,E,bb),ifMath.getCtrlPts(b,d,f,h,D,E,cb),fb=!1,gb=!0,V=(bb[0]+bb[1]+bb[2]+bb[3])/4,W=(cb[0]+cb[1]+cb[2]+cb[3])/4,T=0;4>T;++T){if(U=3==T?0:T+1,ifMath.sqrSegmentDist(bb[T],cb[T],bb[U],cb[U],i,j)<=k){fb=!0;break}ifMath.segmentSide(bb[T],cb[T],bb[U],cb[U],i,j)*ifMath.segmentSide(bb[T],cb[T],bb[U],cb[U],V,W)<0&&(gb=!1)}if((fb||gb)&&(L=ifMath.evalPoly(_,5,D),ifMath.isEqualEps(L,0)&&(D+=.005,L=ifMath.evalPoly(_,5,D)),M=ifMath.evalPoly(_,5,E),ifMath.isEqualEps(M,0)&&(E-=.005,M=ifMath.evalPoly(_,5,E)),ifMath.inversePolyInterval(_,5,D,E,ab),N=ifMath.estimPositiveRootsDescartes(ab,5),0!=N)){if(db||(db=new Float64Array(5),ifMath.getCoeffPolyDeriv(_,5,db)),eb||(eb=new Float64Array(4),ifMath.getCoeffPolyDeriv(db,4,eb)),1==N&&(P=ifMath.locateByNewton(D,E,L,M,_,5,db,eb,.005),null==P&&(P=(D+E)/2),Q=ifMath.evalCubic(o,u,w,a,P),R=ifMath.evalCubic(p,v,x,b,P),S=ifMath.ptSqrDist(Q,R,i,j),k>=S))return m&&(m.segment=l,m.outline=!0,m.x=Q,m.y=R,m.slope=P),!0;if(N>1){if(0==hb.length&&ifMath.getSturmPRS(_,5,db,hb),X=[],Y=[L,M],O=ifMath.countRootsNSturm(_,5,db,D,E,hb,X,Y),0==O)continue;if(1==O&&(P=ifMath.locateByNewton(D,E,L,M,_,5,db,eb,.005,hb,X),null==P&&(P=(D+E)/2),Q=ifMath.evalCubic(o,u,w,a,P),R=ifMath.evalCubic(p,v,x,b,P),S=ifMath.ptSqrDist(Q,R,i,j),k>=S))return m&&(m.segment=l,m.outline=!0,m.x=Q,m.y=R,m.slope=P),!0;if(O>1){var jb=[];ifMath.locRootsSturm(_,5,db,D,E,hb,O,X,Y,jb);for(var kb=0;kb<jb.length;++kb)if(P=ifMath.locateByNewton(jb[kb][0],jb[kb][1],jb[kb][2],jb[kb][3],_,5,db,eb,.005,hb),null==P&&(P=(jb[kb][0]+jb[kb][1])/2),Q=ifMath.evalCubic(o,u,w,a,P),R=ifMath.evalCubic(p,v,x,b,P),S=ifMath.ptSqrDist(Q,R,i,j),k>=S)return m&&(m.segment=l,m.outline=!0,m.x=Q,m.y=R,m.slope=P),!0}}}}return!1},b.prototype._hitUnderSegment=function(a,b,c,d,e,f,g){var h,i,j;return h=ifMath.segmentSide(0,0,a,b,e,f),i=ifMath.segmentSide(a,b,c,d,e,f),j=ifMath.segmentSide(c,d,0,0,e,f),h>0&&i>0&&j>0?2:0>h&&0>i&&0>j?-2:0==h?i>0&&j>0?1:0>i&&0>j?-1:0:0==j?h>0&&i>0?1:0>h&&0>i?-1:0:g&&0==i?h>0&&j>0?1:0>h&&0>j?-1:0:0},b.prototype._evalConicReg=function(a,b,c,d,e,f,g,h,i,j){var k,l,m,n,o=-ifMath.segmentSide(a,b,c,d,e,f);return 0==o?this._hitUnderSegment(a,b,c,d,i,j):(k=this._hitUnderSegment(a,b,c,d,i,j,!0),l=g(i,j),0>l?k:0==l?o+k:(m=-h(e,f),n=-h(i,j),n>0&&0>m||0>n&&m>0?o+o+k:k))},b.prototype._hitUnderCurve=function(a,b,c,d,e,f,g,h){function i(g,h){var i=(a-e)*(d-f)+(e-c)*(b-f),j=g-e,k=h-f,l=j*(b-2*f+d)-k*(a-2*e+c);return l*l+(2*(j*(b-d)+k*(c-a))+i)*i}function j(g,h){var i,j,k,l=(a+e+c)/3,m=(b+f+d)/3;return k=ifMath.segmentSide(c,d,a,b,g,h),0==k?0:(i=ifMath.segmentSide(a,b,e,f,g,h),j=ifMath.segmentSide(e,f,c,d,g,h),i!=ifMath.segmentSide(a,b,e,f,l,m)||j!=ifMath.segmentSide(e,f,c,d,l,m)||k!=ifMath.segmentSide(c,d,a,b,l,m)?-1:1)}return this._evalConicReg(a,b,c,d,e,f,j,i,g,h)},b.prototype._hitUnderCurve2=function(a,b,c,d,e,f,g,h,i,j){function k(a,b){var c=Q[0]-3*Q[1]+3*Q[2]-Q[3],d=(Q[0]-Q[1]-Q[2]+Q[3])/2,e=(Q[0]+Q[1]-Q[2]-Q[3])/4,f=(Q[0]+3*Q[1]+3*Q[2]+Q[3])/8,g=R[0]-3*R[1]+3*R[2]-R[3],h=(R[0]-R[1]-R[2]+R[3])/2,i=(R[0]+R[1]-R[2]-R[3])/4,j=(R[0]+3*R[1]+3*R[2]+R[3])/8,k=c*i-e*g,l=c*h-d*g,m=d*i-e*h,n=c*j-f*g,o=d*j-f*h,p=e*j-f*i,q=c*c,r=d*d,s=g*g,t=h*h,u=k*k,v=n*n,w=l*m,x=l*o,y=l*k,z=3*x-k*n,A=3*u-l*(4*n+9*m),B=s*g,C=c*s,D=q*g,E=q*c,F=n*s-3*g*(2*l*i+k*h)+9*l*t,G=(2*n+3*m)*c*g+9*(2*l*d*h+d*e*s-q*h*i),H=n*q-3*(2*l*e+k*d)*c+9*l*r,I=v*g+6*z*h+3*A*i+9*y*j,J=v*c+6*z*d+3*A*e+9*y*f,K=n*(v-9*(k*o+2*l*p))+27*(x*o+u*p)-81*w*p,L=a*a,M=b*b;return(B*a-3*C*b+3*F)*L+(3*D*a-E*b+3*H)*M+3*((I-G*b)*a-J*b)+K}function l(a,b){var c,d,e,f=(Q[0]+Q[1]+Q[2]+Q[3])/4,g=(R[0]+R[1]+R[2]+R[3])/4;for(d=0;4>d;++d){if(e=3==d?0:d+1,c=ifMath.segmentSide(Q[d],R[d],Q[e],R[e],a,b),3==d&&0==c)return 0;if(c*ifMath.segmentSide(Q[d],R[d],Q[e],R[e],f,g)<0)return-1}return 1}var m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U=0,V=[];q=e-a,u=3*q,r=f-b,v=3*r,D=g-e-q,s=3*D,o=2*D,D=h-f-r,t=3*D,p=2*D,m=c-g-q-o,n=d-h-r-p,A=o*n-p*m,B=2*(q*n-r*m),C=q*p-r*o,ifMath.getQuadraticRoots(A,B,C,V),0==V.length&&(w=new Float64Array(4),x=new Float64Array(4),y=new Float64Array(4),z=new Float64Array(4),w[0]=m,w[1]=s,w[2]=u,w[3]=a,x[0]=n,x[1]=t,x[2]=v,x[3]=b,ifMath.shiftPoly(w,3,.5,y),ifMath.shiftPoly(x,3,.5,z),E=-y[0],F=y[1]/3,G=-y[2]/3,H=-z[0],I=z[1]/3,J=-z[2]/3,K=E*J-G*H,L=E*I-F*H,M=F*J-G*I,D=12*L*M-3*K*K,D>0&&(N=Math.sqrt(D),O=(K-N)/(2*L),P=(K+N)/(2*L),O>-.5&&.5>O&&(V.push(O+.5),P>-.5&&.5>P&&(V.push(P+.5),V.push((O+P)/2+.5))),P>-.5&&.5>P&&V.push(P+.5))),V.push(0),V.push(1);var W=[],X=ifUtil.uSortSegment(0,1,V,W);Q=new Float64Array(4),R=new Float64Array(4);for(var Y=0;X-1>Y;++Y)S=0==Y?W[Y]:T,T=W[Y+1],0==S&&1==T?(Q[0]=a,Q[1]=e,Q[2]=g,Q[3]=c,R[0]=b,R[1]=f,R[2]=h,R[3]=d):(ifMath.getCtrlPts(a,c,e,g,S,T,Q),ifMath.getCtrlPts(b,d,f,h,S,T,R)),U+=ifMath.isEqualEps(Q[0],Q[1])&&ifMath.isEqualEps(R[0],R[1])?this._evalConicReg(Q[0],R[0],Q[3],R[3],Q[2],R[2],l,k,i,j):this._evalConicReg(Q[0],R[0],Q[3],R[3],Q[1],R[1],l,k,i,j);return U},b.prototype.hitTest=function(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o,p=0,q=!1,r=new IFVertex,s=d?d/2*(d/2):ifMath.defaultEps,t=0,u=0;if(n=null,o=null,ifMath.isEqualEps(a,0)&&ifMath.isEqualEps(b,0)&&(u=1),c.rewindVertices(0)){for(;c.readVertex(r);)switch(r.command){case IFVertex.Command.Move:h=r.x,i=r.y,n=h,o=i;break;case IFVertex.Command.Line:if(++p,q=this._hitTestSegment(h,i,r.x,r.y,a,b,s,p,f))return q;e&&(t+=this._hitUnderSegment(h+u,i,r.x+u,r.y,a+u,b)),h=r.x,i=r.y;break;case IFVertex.Command.Curve:if(++p,j=r.x,k=r.y,c.readVertex(r)){if(q=this._hitTestCurve(h,i,j,k,r.x,r.y,a,b,s,p,f))return q;e&&(t+=this._hitUnderCurve(h+u,i,j+u,k,r.x+u,r.y,a+u,b)),h=j,i=k}break;case IFVertex.Command.Curve2:if(++p,j=r.x,k=r.y,c.readVertex(r)&&(l=r.x,m=r.y,c.readVertex(r))){if(q=this._hitTestCurve2(h,i,j,k,l,m,r.x,r.y,a,b,s,p,f))return q;e&&(t+=this._hitUnderCurve2(h+u,i,j+u,k,l+u,m,r.x+u,r.y,a+u,b)),h=j,i=k}break;case IFVertex.Command.Close:if(n!=h||o!=i){if(++p,q=this._hitTestSegment(h,i,n,o,a,b,s,p,f))return q;e&&(t+=this._hitUnderSegment(h+u,i,n+u,o,a+u,b))}n=h,o=i;break;default:throw new Error("Unknown vertex command: "+r.command.toString())}e&&(null==g&&(2==t||-2==t)||2==t&&!g||-2==t&&g)&&(f&&(f.outline=!1),q=!0)}return q},b.prototype.calculateBounds=function(a,b){function c(a,b){(null==l||l>a)&&(l=a),(null==n||a>n)&&(n=a),(null==m||m>b)&&(m=b),(null==o||b>o)&&(o=b)}function d(a,b,d,e,f,g){var h=0,i=0,j=0,k=0;c(d,e),i=d-2*f+a,0!=i&&(h=(a-f)/i,h>0&&1>h&&(j=(a*d-f*f)/(d-2*f+a),k=ifMath.getCurveAtT(b,e,g,h),c(j,k))),i=e-2*g+b,0!=i&&(h=(b-g)/i,h>0&&1>h&&(k=(b*e-g*g)/(e-2*g+b),j=ifMath.getCurveAtT(a,d,f,h),c(j,k)))}function e(a,b,d,e,f,g,h,i){function j(j){var k=0,l=0;j>0&&1>j&&(k=ifMath.getCubicCurveAtT(a,d,f,h,j),l=ifMath.getCubicCurveAtT(b,e,g,i,j),c(k,l))}function k(a,b,c){var d=0,e=0;0==a?0!=b&&(l=-c/b,j(l)):(d=b*b-4*a*c,0==d?(l=-b/(2*a),j(l)):d>0&&(e=Math.sqrt(d),l=(-b+e)/(2*a),j(l),l=(-b-e)/(2*a),j(l)))}var l=0;c(d,e);var m=f-a,n=g-b,o=2*(h-f-m),p=2*(i-g-n),q=d-h-m-o,r=e-i-n-p;k(q,o,m),k(r,p,n)}if(a.rewindVertices(0)){for(var f,g,h,i,j,k,l=null,m=null,n=null,o=null,p=new IFVertex;a.readVertex(p);)switch(p.command){case IFVertex.Command.Move:case IFVertex.Command.Line:c(p.x,p.y),f=p.x,g=p.y;break;case IFVertex.Command.Curve:h=p.x,i=p.y,a.readVertex(p)&&(b?d(f,g,h,i,p.x,p.y):(c(h,i),c(p.x,p.y)),f=h,g=i);break;case IFVertex.Command.Curve2:h=p.x,i=p.y,a.readVertex(p)&&(j=p.x,k=p.y,a.readVertex(p)&&(b?e(f,g,h,i,j,k,p.x,p.y):(c(h,i),c(j,k),c(p.x,p.y)),f=h,g=i));break;case IFVertex.Command.Close:break;default:throw new Error("Unknown vertex command: "+p.command.toString())}if(null!=l&&null!=m)return new IFRect(l,m,null!=n?n-l:0,null!=o?o-m:0)}return null},b.prototype.toString=function(){return"[Object IFVertexInfo]"},a.IFVertexInfo=b,a.ifVertexInfo=new b}(this),function(a){function b(a){this._source=a}IFObject.inherit(b,IFVertexSource),b.prototype._source=null,b.prototype.rewindVertices=function(a){return this._source.rewindVertices(a)},b.prototype.readVertex=function(a){return this._source.readVertex(a)?(a.command>=IFVertex.Command.Move&&a.command<IFVertex.Command.Close&&(a.x=Math.floor(a.x)+.5,a.y=Math.floor(a.y)+.5),!0):!1},b.prototype.toString=function(){return"[Object IFVertexPixelAligner]"},a.IFVertexPixelAligner=b}(this),function(a){function b(a,b){this._source=a,this._transform=b}IFObject.inherit(b,IFVertexSource),b.transformVertex=function(a,b){if(b)switch(a.command){case IFVertex.Command.Move:case IFVertex.Command.Line:case IFVertex.Command.Curve:case IFVertex.Command.Curve2:b.map(a);break;case IFVertex.Command.Close:break;default:throw new Error("Unknown vertex command: "+a.command.toString())}},b.prototype._source=null,b.prototype._transform=null,b.prototype.getTransform=function(){return this._transform},b.prototype.setTransform=function(a){this._transform=a},b.prototype.rewindVertices=function(a){return this._source.rewindVertices(a)},b.prototype.readVertex=function(a){return this._source.readVertex(a)?(b.transformVertex(a,this._transform),!0):!1},b.prototype.toString=function(){return"[Object IFVertexTransformer]"},a.IFVertexTransformer=b}(this),function(a){function b(a,b,c,d,e){this._tolerance=e?e/3:.03,this._source=a,this._offset=b,this._makeInset=c,this._makeOutset=d,this._startVertex=null;for(var f=1,e=this._tolerance,g=0;1>e;++g)e*=10,f*=10;this._tolRange=f}IFObject.inherit(b,IFVertexSource),b.MAX_RECURS=100,b.PolySegment=function(a,b,c,d){if(this.point=a,null!=b&&(this.bulge=b,b)){if(!c||!d||0>d)return;this.center=c,this.radius=d}},b.PolySegment.prototype.point=null,b.PolySegment.prototype.bulge=null,b.PolySegment.prototype.center=null,b.PolySegment.prototype.radius=null,b.PolySegment.prototype.next=null,b.PolySegment.prototype.previous=null,b.PolyOffsetSegment=function(a,c,d,e,f,g){b.PolySegment.call(this,c,e,f,g),this.basepoint=a,d&&(this.point2=d)},IFObject.inherit(b.PolyOffsetSegment,b.PolySegment),b.PolyOffsetSegment.prototype.basepoint=null,b.PolyOffsetSegment.prototype.point2=null,b.IntersectionType=function(){},b.IntersectionType.prototype.TIP=!1,b.IntersectionType.prototype.FIP=!1,b.IntersectionType.prototype.PFIP=!1,b.IntersectionResult=function(){this.intTypes=[new b.IntersectionType,new b.IntersectionType]},b.IntersectionResult.prototype.point=null,b.IntersectionResult.prototype.intTypes=null,b.IntersectionResult.prototype.clear=function(){this.point=null,this.intTypes[0].TIP=!1,this.intTypes[0].FIP=!1,this.intTypes[0].PFIP=!1,this.intTypes[1].TIP=!1,this.intTypes[1].FIP=!1,this.intTypes[1].PFIP=!1},b.PolySegmentContainer=function(){this.count=0},b.PolySegmentContainer.prototype.head=null,b.PolySegmentContainer.prototype.end=null,b.PolySegmentContainer.prototype.closed=null,b.PolySegmentContainer.prototype.count=0,b.PolySegmentContainer.prototype.insertSegment=function(a,b){a.next=null,a.previous=null,this.head?b?(this.head==b?this.head=a:(a.previous=b.previous,b.previous.next=a),a.next=b,b.previous=a):(this.end.next=a,a.previous=this.end,this.end=a):(this.head=a,this.end=a),++this.count
},b.PolySegmentContainer.prototype.deleteSegment=function(a){a.previous&&(a.previous.next=a.next),a.next&&(a.next.previous=a.previous),this.head==a&&(this.head=a.next),this.end==a&&(this.end=a.previous),--this.count},b.IntersectionPt=function(a,b,c,d,e){this.x=a,this.y=b,this.slope=c,this.segm=d,this.segmIdx=e},b.IntersectionPt.prototype.x=null,b.IntersectionPt.prototype.y=null,b.IntersectionPt.prototype.slope=null,b.IntersectionPt.prototype.segm=null,b.IntersectionPt.prototype.segmIdx=null,b.prototype._source=null,b.prototype._offset=null,b.prototype._makeInset=!1,b.prototype._makeOutset=!1,b.prototype._tolerance=null,b.prototype._tolRange=1,b.prototype._polyline=null,b.prototype._polyinset=null,b.prototype._polyoutset=null,b.prototype._pieces=null,b.prototype._pieceIdx=0,b.prototype._startVertex=null,b.prototype.rewindVertices=function(a){return 0!=a?!1:(this._pieces=null,this._pieceIdx=0,this._startVertex=null,this._source.rewindVertices(0))},b.prototype.readVertex=function(a){return this._pieces&&this._pieces.length&&this._readVertex(a)?!0:(this._polyline=new b.PolySegmentContainer,this._polyoutset=[],this._polyinset=[],this._pieces=[],this._pieceIdx=0,this._startVertex=this.generatePolyLine(this._tolerance,this._startVertex),this._polyline.count&&(this.generatePolyOffset(Math.abs(this._offset),this._makeInset,this._makeOutset,this._tolerance),this.generateOffset(this._makeInset,this._makeOutset,this._tolerance),this._pieces.length&&(this._rewindVertices(),this._pieceIdx=0),this._pieces&&this._pieces.length&&this._readVertex(a))?!0:!1)},b.prototype.addCurveToPolyline=function(a,c,d,e,f){if(++f,this._isQudraticCurveFlat(a,c,d,e)){var g=new b.PolySegment(a,0);return void this._polyline.insertSegment(g)}var h=ifMath.ptDist(a.getX(),a.getY(),c.getX(),c.getY()),i=ifMath.ptDist(c.getX(),c.getY(),d.getX(),d.getY()),j=ifMath.ptDist(a.getX(),a.getY(),d.getX(),d.getY()),k=new IFPoint((c.getX()-a.getX())/h,(c.getY()-a.getY())/h),l=new IFPoint((d.getX()-c.getX())/i,(d.getY()-c.getY())/i),m=new IFPoint((d.getX()-a.getX())/j,(d.getY()-a.getY())/j),n=ifMath.vDotProduct(k.getX(),k.getY(),l.getX(),l.getY()),o=new IFPoint(h*(l.getX()-k.getX()*n),h*(l.getY()-k.getY()*n)),p=h*n-i,q=i*n-h,r=new IFPoint(o.getX()+p*k.getX()+q*l.getX(),o.getY()+p*k.getY()+q*l.getY());p=Math.sqrt(ifMath.vDotProduct(o.getX(),o.getY(),o.getX(),o.getY())),q=Math.sqrt(ifMath.vDotProduct(r.getX(),r.getY(),r.getX(),r.getY()));var s=new IFPoint(o.getX()/p,o.getY()/p),t=new IFPoint(r.getX()/q,r.getY()/q),u=1-n,v=ifMath.vDotProduct(l.getX(),l.getY(),s.getX(),s.getY()),w=ifMath.vDotProduct(m.getX(),m.getY(),k.getX(),k.getY()),x=ifMath.vDotProduct(m.getX(),m.getY(),s.getX(),s.getY()),y=ifMath.vDotProduct(k.getX(),k.getY(),t.getX(),t.getY()),z=ifMath.vDotProduct(m.getX(),m.getY(),l.getX(),l.getY()),A=ifMath.vDotProduct(m.getX(),m.getY(),t.getX(),t.getY()),B=v*w/x+y*z/A,C=-(v*y)/(x*A*2),D=[];ifMath.getQuadraticRoots(u,B,C,D);var E=null;null!=D[0]&&D[0]<1&&D[0]>0?E=D[0]:null!=D[1]&&D[1]<1&&D[1]>0&&(E=D[1]);var F=E*j*A/y,G=E*j*x/v,H=Math.sqrt((1-w)/2),I=Math.sqrt((1+w)/2),J=F*I/H,K=Math.sqrt((1-z)/2),L=Math.sqrt((1+z)/2),M=G*L/K,N=new IFPoint(a.getX()+J*s.getX(),a.getY()+J*s.getY()),O=new IFPoint(d.getX()+M*t.getX(),d.getY()+M*t.getY());p=2*h*w,D=[],ifMath.getQuadraticRoots(j-p,p,-F*(1+w),D);var P=.5;null!=D[0]&&D[0]<1&&D[0]>0?P=D[0]:null!=D[1]&&D[1]<1&&D[1]>0&&(P=D[1]);var Q=Math.sqrt(1-w*w),R=Math.abs((2*h*P*(1-P)-F)*Q),S=h*h,T=i*i,U=h*i*n;p=S+T-U;var V=Math.sqrt(1-n*n),W=R,X=P;if(D=[],ifMath.getQuadraticRoots(p,3*(U-S),2*S-J*i*V,D),null!=D[0]&&D[0]<P&&D[0]>0){var Y=new IFPoint(ifMath.getCurveAtT(a.getX(),d.getX(),c.getX(),D[0]),ifMath.getCurveAtT(a.getY(),d.getY(),c.getY(),D[0])),Z=Math.abs(J-ifMath.ptDist(Y.getX(),Y.getY(),N.getX(),N.getY()));Z>W&&(W=Z,X=D[0])}if(null!=D[1]&&D[1]<P&&D[1]>0){var $=new IFPoint(ifMath.getCurveAtT(a.getX(),d.getX(),c.getX(),D[1]),ifMath.getCurveAtT(a.getY(),d.getY(),c.getY(),D[1])),_=Math.abs(J-ifMath.ptDist($.getX(),$.getY(),N.getX(),N.getY()));_>W&&(W=_,X=D[1])}if(D=[],ifMath.getQuadraticRoots(p,-2*S+T+U,S+U-M*h*V,D),null!=D[0]&&D[0]<1&&D[0]>P){var ab=new IFPoint(ifMath.getCurveAtT(a.getX(),d.getX(),c.getX(),D[0]),ifMath.getCurveAtT(a.getY(),d.getY(),c.getY(),D[0])),bb=Math.abs(M-ifMath.ptDist(ab.getX(),ab.getY(),O.getX(),O.getY()));bb>W&&(W=bb,X=D[0])}if(null!=D[1]&&D[1]<1&&D[1]>P){var cb=new IFPoint(ifMath.getCurveAtT(a.getX(),d.getX(),c.getX(),D[1]),ifMath.getCurveAtT(a.getY(),d.getY(),c.getY(),D[1])),db=Math.abs(M-ifMath.ptDist(cb.getX(),cb.getY(),O.getX(),O.getY()));db>W&&(W=db,X=D[1])}if(W>e&&f<b.MAX_RECURS){var eb=new Float64Array(3),fb=new Float64Array(3),gb=new Float64Array(3),hb=new Float64Array(3);ifMath.divideQuadraticCurve(a.getX(),c.getX(),d.getX(),X,eb,gb),ifMath.divideQuadraticCurve(a.getY(),c.getY(),d.getY(),X,fb,hb),this.addCurveToPolyline(a,new IFPoint(eb[1],fb[1]),new IFPoint(eb[2],fb[2]),e,f),this.addCurveToPolyline(new IFPoint(gb[0],hb[0]),new IFPoint(gb[1],hb[1]),d,e,f)}else{var ib=new IFPoint(a.getX()+F*(k.getX()+m.getX()),a.getY()+F*(k.getY()+m.getY())),jb=H/(I+1);ifMath.segmentSide(a.getX(),a.getY(),ib.getX(),ib.getY(),N.getX(),N.getY())>0&&(jb=-jb);var g=new b.PolySegment(a,jb,N,J);this._polyline.insertSegment(g);var kb=K/(L+1);0>jb&&(kb=-kb),g=new b.PolySegment(ib,kb,O,M),this._polyline.insertSegment(g)}},b.prototype.addCubicCurveToPolyline=function(a,b,c,d,e){for(var f,g,h=b.getX()-a.getX(),i=b.getY()-a.getY(),j=2*(c.getX()-b.getX()-h),k=2*(c.getY()-b.getY()-i),l=d.getX()-c.getX()-h-j,m=d.getY()-c.getY()-i-k,n=[],o=ifMath.getCubicCurveSplits(l,j,h,m,k,i,n),p=new Float64Array(4),q=new Float64Array(4),r=0;o-1>r;++r){f=n[r],g=n[r+1],ifMath.getCtrlPts(a.getX(),d.getX(),b.getX(),c.getX(),f,g,p),ifMath.getCtrlPts(a.getY(),d.getY(),b.getY(),c.getY(),f,g,q);var s=0;this._addCubicSegmToPolyline(p,q,e,s)}},b.prototype._isQudraticCurveFlat=function(a,b,c,d){var e=ifMath.getCurveAtT(a.getX(),c.getX(),b.getX(),.5),f=ifMath.getCurveAtT(a.getY(),c.getY(),b.getY(),.5),g=ifMath.ptSqrDist(e,f,(a.getX()+c.getX())/2,(a.getY()+c.getY())/2);return d*d>=g},b.prototype._isCubicCurveFlat=function(a,b,c){var d=3*a[1]-2*a[0]-a[3];d*=d;var e=3*b[1]-2*b[0]-b[3];e*=e;var f=3*a[2]-2*a[3]-a[0];f*=f;var g=3*b[2]-2*b[3]-b[0];return g*=g,f>d&&(d=f),g>e&&(e=g),16*c*c>=d+e},b.prototype._addCubicSegmToPolyline=function(a,c,d,e){++e;var f=a[0],g=c[0],h=a[3],i=c[3];if(this._isCubicCurveFlat(a,c,d)){var j=new b.PolySegment(new IFPoint(f,g),0);return void this._polyline.insertSegment(j)}var k,l=!ifMath.isEqualEps(f,a[1])||!ifMath.isEqualEps(g,c[1]),m=!ifMath.isEqualEps(h,a[2])||!ifMath.isEqualEps(i,c[2]);if(l&&m){var n=[];k=ifMath.getIntersectionPoint(f,g,a[1],c[1],a[2],c[2],h,i,n)}else if(l)k=new IFPoint(a[1],c[1]);else{if(!m)return void this._polyline.insertSegment(new b.PolySegment(new IFPoint(f,g),0));k=new IFPoint(a[2],c[2])}var o=ifMath.ptDist(f,g,h,i),p=ifMath.ptDist(f,g,k.getX(),k.getY()),q=ifMath.ptDist(h,i,k.getX(),k.getY()),r=o+p+q,s=(f*q+h*p+k.getX()*o)/r,t=(g*q+i*p+k.getY()*o)/r;if(ifMath.isEqualEps(f,s)||ifMath.isEqualEps(g,t)||ifMath.isEqualEps(h,s)||ifMath.isEqualEps(i,t)){var j=new b.PolySegment(new IFPoint(f,g),0);this._polyline.insertSegment(j)}else{var u=(g-t)/(f-s),v=(i-t)/(h-s),w=(u*v*(g-i)+v*(f+s)-u*(s+h))/2/(v-u),x=-1/u*(w-(f+s)/2)+(g+t)/2,y=ifMath.ptDist(f,g,w,x),z=a[1]-f,A=3*z,B=c[1]-g,C=3*B,D=a[2]-a[1]-z,E=3*D,F=2*D;D=c[2]-c[1]-B;var G=3*D,H=2*D,I=h-a[2]-z-F,J=i-c[2]-B-H,K=f-w,L=g-x,M=new Float64Array(7);M[0]=I*I+J*J,M[1]=2*(I*E+J*G),M[2]=E*E+G*G+2*(I*A+J*C),M[3]=2*(I*K+E*A+J*L+G*C),M[4]=A*A+C*C+2*(E*K+G*L),M[5]=2*(A*K+C*L),M[6]=K*K+L*L;var N=new Float64Array(6);ifMath.getCoeffPolyDeriv(M,6,N);var O=new Float64Array(5);ifMath.getCoeffPolyDeriv(N,5,O);var P=new Float64Array(4);ifMath.getCoeffPolyDeriv(O,4,P);var Q=new Float64Array(6);ifMath.inversePolyUnaryInterval(N,5,Q);var R,S,T,U,V=ifMath.estimPositiveRootsDescartes(Q,5),W=0,X=[];if(V>0){var Y=0,Z=1;R=ifMath.evalPoly(N,5,Y),ifMath.isEqualEps(R,0)&&(Y+=.005,R=ifMath.evalPoly(N,5,Y)),S=ifMath.evalPoly(N,5,Z),ifMath.isEqualEps(S,0)&&(Z-=.005,S=ifMath.evalPoly(N,5,Z)),V>1&&(ifMath.getSturmPRS(N,5,O,X),T=[],U=[R,S],V=ifMath.countRootsNSturm(N,5,O,Y,Z,X,T,U))}if(0==V);else if(1==V){var $=ifMath.locateByNewton(Y,Z,R,S,N,5,O,P,.005);null==$&&($=(Y+Z)/2);var _=ifMath.evalCubic(I,E,A,f,$),ab=ifMath.evalCubic(J,G,C,g,$);W=Math.abs(ifMath.ptDist(_,ab,w,x)-y)}else{var bb=[];ifMath.locRootsSturm(N,5,O,Y,Z,X,V,T,U,bb);for(var cb=0;cb<bb.length;++cb){$=ifMath.locateByNewton(bb[cb][0],bb[cb][1],bb[cb][2],bb[cb][3],N,5,O,P,.005,X),null==$&&($=(bb[cb][0]+bb[cb][1])/2),_=ifMath.evalCubic(I,E,A,f,$),ab=ifMath.evalCubic(J,G,C,g,$);var db=Math.abs(ifMath.ptDist(_,ab,w,x)-y);db>W&&(W=db)}}if(W>d&&e<b.MAX_RECURS){var eb=new Float64Array(4),fb=new Float64Array(4),gb=new Float64Array(4),hb=new Float64Array(4);ifMath.getCtrlPtsCasteljau(a[0],a[1],a[2],a[3],.5,null,eb,gb),ifMath.getCtrlPtsCasteljau(c[0],c[1],c[2],c[3],.5,null,fb,hb),this._addCubicSegmToPolyline(eb,fb,d,e),this._addCubicSegmToPolyline(gb,hb,d,e)}else{var ib=o/2/y,jb=ib/(Math.sqrt(1-ib*ib)+1);ifMath.segmentSide(f,g,h,i,w,x)>0&&(jb=-jb);var kb=new b.PolySegment(new IFPoint(f,g),jb,new IFPoint(w,x),y);this._polyline.insertSegment(kb)}}},b.prototype.generatePolyLine=function(a,c){for(var d,e=null,f=c,g=f,h=new IFVertex,i=!0;i&&this._source.readVertex(h);)switch(h.command){case IFVertex.Command.Move:f&&this._polyline.count?(e=h,i=!1):(g=h,f=g,h=new IFVertex);break;case IFVertex.Command.Line:g?(d=new b.PolySegment(new IFPoint(g.x,g.y),0),this._polyline.insertSegment(d),g=h,h=new IFVertex):(g=h,h=new IFVertex);break;case IFVertex.Command.Curve:if(g){var j=new IFPoint(g.x,g.y);if(g=h,h=new IFVertex,this._source.readVertex(h)){var k=0;this.addCurveToPolyline(j,new IFPoint(h.x,h.y),new IFPoint(g.x,g.y),a,k),h=new IFVertex}}else g=h,h=new IFVertex;break;case IFVertex.Command.Curve2:if(g){var j=new IFPoint(g.x,g.y),l=new IFPoint(h.x,h.y);g=h,h=new IFVertex;var m=new IFVertex;this._source.readVertex(h)&&this._source.readVertex(m)&&(this.addCubicCurveToPolyline(j,new IFPoint(h.x,h.y),new IFPoint(m.x,m.y),l,a),h=new IFVertex)}else g=h,h=new IFVertex;break;case IFVertex.Command.Close:this._polyline&&(g&&(d=new b.PolySegment(new IFPoint(g.x,g.y),0),this._polyline.insertSegment(d),g=null),this._polyline.closed=!0,d=new b.PolySegment(this._polyline.head.point,0),this._polyline.insertSegment(d),e=new IFVertex,e.command=IFVertex.Command.Move,e.x=this._polyline.head.point.getX(),e.y=this._polyline.head.point.getY(),i=!1);break;default:throw new Error("Unknown vertex command: "+vertex.command.toString())}return g&&this._polyline.count&&(d=new b.PolySegment(new IFPoint(g.x,g.y),0),this._polyline.insertSegment(d),ifMath.isEqualEps(g.x,this._polyline.head.point.getX())&&ifMath.isEqualEps(g.y,this._polyline.head.point.getY())&&(this._polyline.closed=!0)),e},b.prototype.generatePolyOffset=function(a,c,d,e){var f=null,g=null;d&&(f=new b.PolySegmentContainer),c&&(g=new b.PolySegmentContainer);for(var h,i=0,j=this._polyline.head;i<this._polyline.count;++i)d&&(h=this._offsetPolySegment(j,-a,e),h&&f.insertSegment(h)),c&&(h=this._offsetPolySegment(j,a,e),h&&g.insertSegment(h)),j=j.next;var k=new b.PolySegmentContainer,l=new b.PolySegmentContainer;d&&this._trimOffsetPoly(f,-a,k),c&&this._trimOffsetPoly(g,a,l);var m=[],n=[];c&&d&&this._calcIntersectionPoints(k,l,m,n),d&&this._calcSelfIntersectionPoints(k,m),c&&this._calcSelfIntersectionPoints(l,n),m.length>0&&this._sortInsertsectionPoints(m),n.length>0&&this._sortInsertsectionPoints(n);var o=[],p=[],q=[],r=[];if(d)if(m.length>0){q=this._splitForClipping(k,m);for(var i=0;i<q.length;++i){var s=[],t=[];if(this._calcIntersectionPoints(q[i],this._polyline,s,t),0==s.length)o.push(q[i]);else if(!this._polyline.closed){for(var u=!1,v=0;v<t.length;++v)if(0==t[v].segmIdx||t[v].segmIdx==this._polyline.count-1){u=!0;break}u&&this._excludeCircleInside(q[i],s,t,a,o)}}}else o[0]=k;if(c)if(n.length>0){r=this._splitForClipping(l,n);for(var i=0;i<r.length;++i){var s=[],t=[];if(this._calcIntersectionPoints(r[i],this._polyline,s,t),0==s.length)p.push(r[i]);else if(!this._polyline.closed){for(var u=!1,v=0;v<t.count;++v)if(0==t[v].segmIdx||t[v].segmIdx==this._polyline.count-1){u=!0;break}u&&this._excludeCircleInside(r[i],s,t,a,p)}}}else p[0]=l;c&&d?(this._gcppFilter(o,this._polyline,a,3*e,this._polyoutset),this._gcppFilter(p,this._polyline,a,3*e,this._polyinset)):(this._gcppClipping(o,this._polyline,a,this._polyoutset),this._gcppClipping(p,this._polyline,a,this._polyinset))},b.prototype.generateOffset=function(a,b,c){var d=[];b&&a&&!this._polyline.closed?(this._genCurves(this._polyoutset,d,c),this._genCurves(this._polyinset,d,c)):(b&&this._genCurves(this._polyoutset,d,c),a&&this._genCurves(this._polyinset,d,c)),this._pieces=this._mergePieces(d)},b.prototype._mergePieces=function(a){for(var b=[];a.length>0;){var c=a[0];a.splice(0,1);for(var d=c.stPt.getX()!=c.endPt.getX()||c.stPt.getY()!=c.endPt.getY();d;){d=!1;for(var e=null,f=a.length-1;f>=0;--f)e=a[f],e.stPt.getX()==c.endPt.getX()&&e.stPt.getY()==c.endPt.getY()?(c.endPt=e.endPt,c.vrt.push.apply(c.vrt,e.vrt),d=!0,a.splice(f,1)):c.stPt.getX()==e.endPt.getX()&&c.stPt.getY()==e.endPt.getY()&&(e.endPt=c.endPt,e.vrt.push.apply(e.vrt,c.vrt),c=e,d=!0,a.splice(f,1))}var g=new IFVertexContainer;g.addVertex(IFVertex.Command.Move,c.stPt.getX(),c.stPt.getY());for(var f=0;f<c.vrt.length;++f){var h=c.vrt[f];g.addVertex(h.c,h.x,h.y)}b.push(g)}return b},b.prototype._offsetPolySegment=function(a,c,d){var e=null,f=Math.abs(c),g=a.point.getX(),h=a.point.getY();if(a.bulge){if(a.radius){var i=a.radius,j=null;if(c*a.bulge>0?(i+=f,j=i/a.radius):ifMath.isEqualEps(a.radius,f,d)||(a.radius>f?(i-=f,j=i/a.radius):(i=f-a.radius,j=f/a.radius)),null!=j){var k,l,m=a.center.getX(),n=a.center.getY();a.next?(k=a.next.point.getX(),l=a.next.point.getY()):(k=this._polyline.head.point.getX(),l=this._polyline.head.point.getY());var o=new IFPoint(m+j*(g-m),n+j*(h-n)),p=new IFPoint(m+j*(k-m),n+j*(l-n));e=new b.PolyOffsetSegment(a.point,o,p,a.bulge,a.center,i)}}}else if(a.next||this._polyline.closed){var k,l;a.next?(k=a.next.point.getX(),l=a.next.point.getY()):(k=this._polyline.head.point.getX(),l=this._polyline.head.point.getY());var q=ifMath.ptDist(g,h,k,l);if(!ifMath.isEqualEps(q,0)){var r=new IFPoint(-c*(l-h)/q,-c*(g-k)/q),o=new IFPoint(g+r.getX(),h+r.getY()),p=new IFPoint(k+r.getX(),l+r.getY());e=new b.PolyOffsetSegment(a.point,o,p,0)}}return e},b.prototype._insersectOffsetSegments=function(a,b,c){if(0==a.bulge&&0==b.bulge){var d=[null,null],e=ifMath.getIntersectionPoint(a.point.getX(),a.point.getY(),a.point2.getX(),a.point2.getY(),b.point.getX(),b.point.getY(),b.point2.getX(),b.point2.getY(),d);c.point=e,e&&(this._fillLineIntType(d[0],c.intTypes[0]),this._fillLineIntType(d[1],c.intTypes[1]))}else if(0!=a.bulge&&0==b.bulge||0==a.bulge&&0!=b.bulge){var d=[null,null],f=null,g=null,h=null;if(0==a.bulge){var i=a.point.getX(),j=a.point.getY(),k=a.point2.getX()-a.point.getX(),l=a.point2.getY()-a.point.getY();if(ifMath.circleLineIntersection(i,j,k,l,b.center.getX(),b.center.getY(),b.radius,d),null!=d[0]&&(f=i+k*d[0],g=j+l*d[0],h=d[0]),null!=d[0]&&null!=d[1]){var m=i+k*d[1],n=j+l*d[1],o=ifMath.ptSqrDist(f,g,b.basepoint.getX(),b.basepoint.getY()),p=ifMath.ptSqrDist(m,n,b.basepoint.getX(),b.basepoint.getY());o>p&&(f=m,g=n,h=d[1])}null!=h&&(c.point=new IFPoint(f,g),this._fillLineIntType(h,c.intTypes[0]),this._fillArcIntType(b,f,g,c.intTypes[1]))}else{var i=b.point.getX(),j=b.point.getY(),k=b.point2.getX()-b.point.getX(),l=b.point2.getY()-b.point.getY();if(ifMath.circleLineIntersection(i,j,k,l,a.center.getX(),a.center.getY(),a.radius,d),null!=d[0]&&(f=i+k*d[0],g=j+l*d[0],h=d[0]),null!=d[0]&&null!=d[1]){var m=i+k*d[1],n=j+l*d[1],o=ifMath.ptSqrDist(f,g,b.basepoint.getX(),b.basepoint.getY()),p=ifMath.ptSqrDist(m,n,b.basepoint.getX(),b.basepoint.getY());o>p&&(f=m,g=n,h=d[1])}null!=h&&(c.point=new IFPoint(f,g),this._fillLineIntType(h,c.intTypes[1]),this._fillArcIntType(a,f,g,c.intTypes[0]))}}else{var d=[null,null];ifMath.circleCircleIntersection(a.center.getX(),a.center.getY(),a.radius,b.center.getX(),b.center.getY(),b.radius,d);var q=null;if(null!=d[0]&&(q=0),null!=d[0]&&null!=d[1]){var o=ifMath.ptSqrDist(d[0].getX(),d[0].getY(),b.basepoint.getX(),b.basepoint.getY()),p=ifMath.ptSqrDist(d[1].getX(),d[1].getY(),b.basepoint.getX(),b.basepoint.getY());o>p&&(q=1)}null!==q&&(c.point=d[q],this._fillArcIntType(a,d[q].getX(),d[q].getY(),c.intTypes[0]),this._fillArcIntType(b,d[q].getX(),d[q].getY(),c.intTypes[1]))}},b.prototype._fillArcIntType=function(a,b,c,d){var e=a.point.getX(),f=a.point.getY(),g=a.point2.getX(),h=a.point2.getY(),i=a.center.getX(),j=a.center.getY();if(ifMath.segmentSide(e,f,g,h,b,c)==ifMath.segmentSide(e,f,g,h,i,j)){var k=(e+g)/2,l=(f+h)/2,m=a.radius/ifMath.ptDist(k,l,i,j),n=i+(i-k)*m,o=j+(j-l)*m;ifMath.segmentSide(e,f,n,o,b,c)==ifMath.segmentSide(e,f,n,o,i,j)?(d.FIP=!0,d.PFIP=!0):d.FIP=!0}else d.TIP=!0},b.prototype._fillLineIntType=function(a,b){0>a?b.FIP=!0:a>1?(b.FIP=!0,b.PFIP=!0):b.TIP=!0},b.prototype._trimOffsetPoly=function(a,c,d){var e=1e-6,f=null,g=a.head;if(g){d.insertSegment(new b.PolySegment(g.point,g.bulge,g.center,g.radius));for(var h=new b.IntersectionResult,i=0;i<a.count-1;++i)if(f=new b.PolyOffsetSegment(g.basepoint,d.end.point,g.point2,d.end.bulge,g.center,g.radius),g=g.next,ifMath.isEqualEps(f.point2.getX(),g.point.getX(),e)&&ifMath.isEqualEps(f.point2.getY(),g.point.getY(),e))d.insertSegment(new b.PolySegment(g.point,g.bulge,g.center,g.radius));else if(h.clear(),this._insersectOffsetSegments(f,g,h),0==f.bulge&&0==g.bulge)h.point?h.intTypes[0].TIP&&h.intTypes[1].TIP||h.intTypes[0].FIP&&h.intTypes[1].FIP&&h.intTypes[0].PFIP?d.insertSegment(new b.PolySegment(h.point,0)):(d.insertSegment(new b.PolySegment(f.point2,0)),d.insertSegment(new b.PolySegment(g.point,0))):d.insertSegment(new b.PolySegment(f.point2,0));else if(0==f.bulge&&0!=g.bulge)if(h.point)if(h.intTypes[0].TIP&&h.intTypes[1].TIP||h.intTypes[0].TIP&&h.intTypes[1].FIP&&!h.intTypes[1].PFIP||h.intTypes[0].PFIP&&h.intTypes[1].TIP){var j=((h.point.getX()+g.point2.getX())/2,(h.point.getY()+g.point2.getY())/2,this._calculateBulge(h.point.getX(),h.point.getY(),g.point2.getX(),g.point2.getY(),g.center.getX(),g.center.getY(),g.bulge));d.insertSegment(new b.PolySegment(h.point,j,g.center,g.radius))}else if(h.intTypes[0].PFIP&&h.intTypes[1].FIP){var k=this._constructJoinArc(f,g,!0);d.insertSegment(k),d.insertSegment(new b.PolySegment(g.point,g.bulge,g.center,g.radius))}else d.insertSegment(new b.PolySegment(f.point2,0)),d.insertSegment(new b.PolySegment(g.point,g.bulge,g.center,g.radius));else{var k=this._constructJoinArc(f,g,!0);d.insertSegment(k),d.insertSegment(new b.PolySegment(g.point,g.bulge,g.center,g.radius))}else if(0!=f.bulge&&0==g.bulge)if(h.point)if(h.intTypes[0].TIP&&h.intTypes[1].TIP){var l=this._calculateBulge(f.point.getX(),f.point.getY(),h.point.getX(),h.point.getY(),f.center.getX(),f.center.getY(),f.bulge);d.end.bulge=l,d.insertSegment(new b.PolySegment(h.point,0))}else if(h.intTypes[0].FIP&&h.intTypes[1].FIP&&!h.intTypes[1].PFIP){var k=this._constructJoinArc(f,g,!0);d.insertSegment(k),d.insertSegment(new b.PolySegment(g.point,0))}else d.insertSegment(new b.PolySegment(f.point2,0)),d.insertSegment(new b.PolySegment(g.point,0));else{var k=this._constructJoinArc(f,g,!0);d.insertSegment(k),d.insertSegment(new b.PolySegment(g.point,0))}else if(h.point)if(h.intTypes[0].FIP&&!h.intTypes[0].PFIP||h.intTypes[1].PFIP){var k=this._constructJoinArc(f,g,!1);d.insertSegment(k),d.insertSegment(new b.PolySegment(g.point,g.bulge,g.center,g.radius))}else{var l=this._calculateBulge(f.point.getX(),f.point.getY(),h.point.getX(),h.point.getY(),f.center.getX(),f.center.getY(),f.bulge);d.end.bulge=l,l=this._calculateBulge(h.point.getX(),h.point.getY(),g.point2.getX(),g.point2.getY(),g.center.getX(),g.center.getY(),g.bulge),d.insertSegment(new b.PolySegment(h.point,l,g.center,g.radius))}else{var k=this._constructJoinArc(f,g,!0);d.insertSegment(k),d.insertSegment(new b.PolySegment(g.point,g.bulge,g.center,g.radius))}if(this._polyline.closed)if(f=new b.PolyOffsetSegment(g.basepoint,d.end.point,g.point2,d.end.bulge,g.center,g.radius),g=a.head,ifMath.isEqualEps(f.point2.getX(),g.point.getX(),e)&&ifMath.isEqualEps(f.point2.getY(),g.point.getY(),e))d.insertSegment(new b.PolySegment(g.point,0));else if(h.clear(),this._insersectOffsetSegments(f,g,h),0==f.bulge&&0==g.bulge)h.point?h.intTypes[0].TIP&&h.intTypes[1].TIP||h.intTypes[0].FIP&&h.intTypes[1].FIP&&h.intTypes[0].PFIP?(d.insertSegment(new b.PolySegment(h.point,0)),d.head.point=h.point):(d.insertSegment(new b.PolySegment(f.point2,0)),d.insertSegment(new b.PolySegment(g.point,0))):d.insertSegment(new b.PolySegment(f.point2,0));else if(0==f.bulge&&0!=g.bulge)if(h.point)if(h.intTypes[0].TIP&&h.intTypes[1].TIP||h.intTypes[0].TIP&&h.intTypes[1].FIP&&!h.intTypes[1].PFIP||h.intTypes[0].PFIP&&h.intTypes[1].TIP){var j=this._calculateBulge(h.point.getX(),h.point.getY(),g.point2.getX(),g.point2.getY(),g.center.getX(),g.center.getY(),g.bulge);d.insertSegment(new b.PolySegment(h.point,0)),d.head.point=h.point,d.head.bulge=j}else if(h.intTypes[0].PFIP&&h.intTypes[1].FIP){var k=this._constructJoinArc(f,g,!0);d.insertSegment(k),d.insertSegment(new b.PolySegment(g.point,0))}else d.insertSegment(new b.PolySegment(f.point2,0)),d.insertSegment(new b.PolySegment(g.point,0));else{var k=this._constructJoinArc(f,g,!0);d.insertSegment(k),d.insertSegment(new b.PolySegment(g.point,0))}else if(0!=f.bulge&&0==g.bulge)if(h.point)if(h.intTypes[0].TIP&&h.intTypes[1].TIP){var l=this._calculateBulge(f.point.getX(),f.point.getY(),h.point.getX(),h.point.getY(),f.center.getX(),f.center.getY(),f.bulge);d.end.bulge=l,d.insertSegment(new b.PolySegment(h.point,0)),d.head.point=h.point}else if(h.intTypes[0].FIP&&h.intTypes[1].FIP&&!h.intTypes[1].PFIP){var k=this._constructJoinArc(f,g,!0);d.insertSegment(k),d.insertSegment(new b.PolySegment(g.point,0))}else d.insertSegment(new b.PolySegment(f.point2,0)),d.insertSegment(new b.PolySegment(g.point,0));else{var k=this._constructJoinArc(f,g,!0);d.insertSegment(k),d.insertSegment(new b.PolySegment(g.point,0))}else if(h.point)if(h.intTypes[0].FIP&&!h.intTypes[0].PFIP||h.intTypes[1].PFIP){var k=this._constructJoinArc(f,g,!1);d.insertSegment(k),d.insertSegment(new b.PolySegment(g.point,0))}else{var l=this._calculateBulge(f.point.getX(),f.point.getY(),h.point.getX(),h.point.getY(),f.center.getX(),f.center.getY(),f.bulge);d.end.bulge=l,d.insertSegment(new b.PolySegment(h.point,0)),l=this._calculateBulge(h.point.getX(),h.point.getY(),g.point2.getX(),g.point2.getY(),g.center.getX(),g.center.getY(),g.bulge),d.head.point=h.point,d.head.bulge=l}else{var k=this._constructJoinArc(f,g,!0);d.insertSegment(k),d.insertSegment(new b.PolySegment(g.point,0))}else d.insertSegment(new b.PolySegment(g.point2,0))}},b.prototype._constructJoinArc=function(a,c,d){var e=0;if(a.bulge){var f=a.bulge>0?1:-1,g=(a.point2.getY()-a.center.getY())*f,h=(a.center.getX()-a.point2.getX())*f;e=-ifMath.segmentSide(a.point2.getX(),a.point2.getY(),a.point2.getX()+g,a.point2.getY()+h,c.point.getX(),c.point.getY())}else e=-ifMath.segmentSide(a.point.getX(),a.point.getY(),a.point2.getX(),a.point2.getY(),c.point.getX(),c.point.getY());d||(e=-e);var i=null,j=0;return e&&(j=this._calculateBulge(a.point2.getX(),a.point2.getY(),c.point.getX(),c.point.getY(),c.basepoint.getX(),c.basepoint.getY(),e)),i=j?new b.PolySegment(a.point2,j,c.basepoint,ifMath.ptDist(a.point2.getX(),a.point2.getY(),c.basepoint.getX(),c.basepoint.getY())):new b.PolySegment(a.point2,0)},b.prototype._calculateBulge=function(a,b,c,d,e,f,g){var h=ifMath.ptSqrDist(a,b,e,f),i=ifMath.ptSqrDist(c,d,e,f),j=0;if(ifMath.isEqualEps(h,i,1e-8)){var k=ifMath.ptSqrDist((a+c)/2,(b+d)/2,e,f);if(ifMath.isEqualEps(k,0,1e-8))j=1;else{var l=Math.sqrt(k/h);j=Math.sqrt((1-l)/(1+l))}var m=Math.sqrt(h),n=(b-f)/m,o=(a-e)/m,p=(d-f)/m,q=(c-e)/m,r=n*q-o*p;j=0>r?-j:j,g&&(0>g&&j>0||g>0&&0>j)&&(j=-1/j)}return j},b.prototype._calcIntersectionPoints=function(a,b,c,d){for(var e,f=a.head,g=0;g<a.count-1;++g){e=b.head;for(var h=0;h<b.count-1;++h)this._calcSegmIntersectionPoints(f,e,g,h,c,d),e=e.next;f=f.next}},b.prototype._calcSelfIntersectionPoints=function(a,b){for(var c,d=a.head,e=0;e<a.count-2;++e){c=d.next;for(var f=e+1;f<a.count-1;++f)this._calcSegmIntersectionPoints(d,c,e,f,b,b,f==e+1),c=c.next;d=d.next}},b.prototype._calcSegmIntersectionPoints=function(a,c,d,e,f,g,h){if(a.bulge||c.bulge)if(!a.bulge&&c.bulge){var i=[null,null],j=a.next.point.getX()-a.point.getX(),k=a.next.point.getY()-a.point.getY();if(ifMath.circleLineIntersection(a.point.getX(),a.point.getY(),j,k,c.center.getX(),c.center.getY(),c.radius,i),null!=i[0]&&i[0]>=0&&i[0]<=1&&(!h||!ifMath.isEqualEps(i[0],1))){var l=a.point.getX()+j*i[0],m=a.point.getY()+k*i[0],n=this._calculateBulge(c.point.getX(),c.point.getY(),l,m,c.center.getX(),c.center.getY(),c.bulge);(0>n&&n>=c.bulge||n>0&&n<=c.bulge)&&(f.push(new b.IntersectionPt(l,m,i[0],a,d)),g.push(new b.IntersectionPt(l,m,n,c,e)))}if(null!=i[1]&&i[1]>=0&&i[1]<=1&&(!h||!ifMath.isEqualEps(i[1],1))){var l=a.point.getX()+j*i[1],m=a.point.getY()+k*i[1],n=this._calculateBulge(c.point.getX(),c.point.getY(),l,m,c.center.getX(),c.center.getY(),c.bulge);(0>n&&n>=c.bulge||n>0&&n<=c.bulge)&&(f.push(new b.IntersectionPt(l,m,i[1],a,d)),g.push(new b.IntersectionPt(l,m,n,c,e)))}}else if(a.bulge&&!c.bulge){var i=[null,null],j=c.next.point.getX()-c.point.getX(),k=c.next.point.getY()-c.point.getY();if(ifMath.circleLineIntersection(c.point.getX(),c.point.getY(),j,k,a.center.getX(),a.center.getY(),a.radius,i),null!=i[0]&&i[0]>=0&&i[0]<=1&&(!h||!ifMath.isEqualEps(i[0],0))){var l=c.point.getX()+j*i[0],m=c.point.getY()+k*i[0],n=this._calculateBulge(a.point.getX(),a.point.getY(),l,m,a.center.getX(),a.center.getY(),a.bulge);(0>n&&n>=a.bulge||n>0&&n<=a.bulge)&&(f.push(new b.IntersectionPt(l,m,n,a,d)),g.push(new b.IntersectionPt(l,m,i[0],c,e)))}if(null!=i[1]&&i[1]>=0&&i[1]<=1&&(!h||!ifMath.isEqualEps(i[1],0))){var l=c.point.getX()+j*i[1],m=c.point.getY()+k*i[1],n=this._calculateBulge(a.point.getX(),a.point.getY(),l,m,a.center.getX(),a.center.getY(),a.bulge);(0>n&&n>=a.bulge||n>0&&n<=a.bulge)&&(f.push(new b.IntersectionPt(l,m,n,a,d)),g.push(new b.IntersectionPt(l,m,i[1],c,e)))}}else{var i=[null,null];if(ifMath.circleCircleIntersection(a.center.getX(),a.center.getY(),a.radius,c.center.getX(),c.center.getY(),c.radius,i),i[0]&&(!h||!ifMath.isEqualEps(i[0].getX(),c.point.getX())&&!ifMath.isEqualEps(i[0].getY(),c.point.getY()))){var o=this._calculateBulge(a.point.getX(),a.point.getY(),i[0].getX(),i[0].getY(),a.center.getX(),a.center.getY(),a.bulge);if(0>o&&o>=a.bulge||o>0&&o<=a.bulge){var p=this._calculateBulge(c.point.getX(),c.point.getY(),i[0].getX(),i[0].getY(),c.center.getX(),c.center.getY(),c.bulge);(0>p&&p>=c.bulge||p>0&&p<=c.bulge)&&(f.push(new b.IntersectionPt(i[0].getX(),i[0].getY(),o,a,d)),g.push(new b.IntersectionPt(i[0].getX(),i[0].getY(),p,c,e)))}}if(i[1]&&(!h||!ifMath.isEqualEps(i[1].getX(),c.point.getX())&&!ifMath.isEqualEps(i[1].getY(),c.point.getY()))){var q=this._calculateBulge(a.point.getX(),a.point.getY(),i[1].getX(),i[1].getY(),a.center.getX(),a.center.getY(),a.bulge);if(0>q&&q>=a.bulge||q>0&&q<=a.bulge){var r=this._calculateBulge(c.point.getX(),c.point.getY(),i[1].getX(),i[1].getY(),c.center.getX(),c.center.getY(),c.bulge);(0>r&&r>=c.bulge||r>0&&r<=c.bulge)&&(f.push(new b.IntersectionPt(i[1].getX(),i[1].getY(),q,a,d)),g.push(new b.IntersectionPt(i[1].getX(),i[1].getY(),r,c,e)))}}}else if(!h){var i=[null,null],s=ifMath.getIntersectionPoint(a.point.getX(),a.point.getY(),a.next.point.getX(),a.next.point.getY(),c.point.getX(),c.point.getY(),c.next.point.getX(),c.next.point.getY(),i);s&&0<=i[0]&&i[0]<=1&&0<=i[1]&&i[1]<=1&&(f.push(new b.IntersectionPt(s.getX(),s.getY(),i[0],a,d)),g.push(new b.IntersectionPt(s.getX(),s.getY(),i[1],c,e)))}},b.prototype._sortInsertsectionPoints=function(a){a.sort(function(a,b){return a.segmIdx!=b.segmIdx?a.segmIdx-b.segmIdx:a.slope>0?a.slope-b.slope:b.slope-a.slope})},b.prototype._splitForClipping=function(a,c){for(var d,e=1e-6,f=a.head,g=0,h=f,i=h,j=[],k=0;k<c.length;++k){j[k]=new b.PolySegmentContainer;for(var l=g;l<c[k].segmIdx;++l)j[k].insertSegment(new b.PolySegment(h.point,h.bulge,h.center,h.radius)),h=i.next,i=h;h.bulge?ifMath.isEqualEps(c[k].x,h.point.getX(),e)&&ifMath.isEqualEps(c[k].y,h.point.getY(),e)?j[k].insertSegment(new b.PolySegment(h.point,0)):(h==i?j[k].insertSegment(new b.PolySegment(h.point,c[k].slope,h.center,h.radius)):(d=(c[k].slope-c[k-1].slope)/(1+c[k].slope*c[k-1].slope),j[k].insertSegment(new b.PolySegment(h.point,d,h.center,h.radius))),j[k].insertSegment(new b.PolySegment(new IFPoint(c[k].x,c[k].y),0)),d=(i.bulge-c[k].slope)/(1+i.bulge*c[k].slope),h=new b.PolySegment(new IFPoint(c[k].x,c[k].y),d,h.center,h.radius)):(j[k].insertSegment(new b.PolySegment(h.point,0)),ifMath.isEqualEps(c[k].x,h.point.getX(),e)&&ifMath.isEqualEps(c[k].y,h.point.getY(),e)||(h=new b.PolySegment(new IFPoint(c[k].x,c[k].y),0),j[k].insertSegment(h))),g=l,ifMath.isEqualEps(c[k].x,i.next.point.getX(),e)&&ifMath.isEqualEps(c[k].y,i.next.point.getY(),e)&&(++g,h=i.next,i=h)}var m=this._polyline.closed;if(g!=a.count-1){j[k]=new b.PolySegmentContainer;for(var l=g;l<a.count;++l)j[k].insertSegment(new b.PolySegment(h.point,h.bulge,h.center,h.radius)),h=i.next,i=h}else m=!1;if(1==j[0].count&&(j=j.slice(1),m=!1),m){var n=j.length,o=j[n-1],p=o.end.point,q=j[0].head.point;if(n>1&&ifMath.isEqualEps(p.getX(),q.getX(),e)&&ifMath.isEqualEps(p.getY(),q.getY(),e)){o.deleteSegment(o.end),h=j[0].head;for(var k=0;k<j[0].count;++k)o.insertSegment(new b.PolySegment(h.point,h.bulge,h.center,h.radius)),h=h.next;j=j.slice(1)}else j[0].closed=!0}for(var r=[],k=0;k<j.length;++k)1!=j[k].count&&r.push(j[k]);return r},b.prototype._excludeCircleInside=function(a,c,d,e,f){for(var g=0,h=new b.PolySegment(a.head.point,a.head.bulge,a.head.center,a.head.radius),i=a.head,j=new b.PolySegmentContainer,k=0;k<c.length;++k){for(var l=g;l<c[k].segmIdx-1;++l)j.insertSegment(h),i=i.next,h=new b.PolySegment(i.point,i.bulge,i.center,i.radius);if(h.bulge){var m=[null,null];if(ifMath.circleCircleIntersection(i.center.getX(),i.center.getY(),i.radius,d[k].x,d[k].y,e,m),null!=m[0]){var n=this._calculateBulge(h.point.getX(),h.point.getY(),m[0].getX(),m[0].getY(),i.center.getX(),i.center.getY(),h.bulge);0>n&&n>h.bulge||n>0&&n<h.bulge?(j.insertSegment(new b.PolySegment(h.point,n,i.center,i.radius)),j.insertSegment(new b.PolySegment(m[0],0)),f.push(j)):(j.insertSegment(new b.PolySegment(h.point,0)),f.push(j))}if(null!=m[1]){var o=this._calculateBulge(h.point.getX(),h.point.getY(),m[1].getX(),m[1].getY(),i.center.getX(),i.center.getY(),h.bulge);if(0>o&&o>h.bulge&&n>o||o>0&&o<h.bulge&&o>n){j=new b.PolySegmentContainer;var p=(h.bulge-o)/(1+h.bulge*o);h=new b.PolySegment(new IFPoint(s,t),p,i.center,i.radius)}else j=new b.PolySegmentContainer}else j=new b.PolySegmentContainer}else{var m=[null,null],q=i.next.point.getX()-h.point.getX(),r=i.next.point.getY()-h.point.getY();if(ifMath.circleLineIntersection(h.point.getX(),h.point.getY(),q,r,d[k].x,d[k].y,e,m),null!=m[0])if(m[0]<=0)j.insertSegment(new b.PolySegment(h.point,0)),f.push(j);else if(m[0]>0&&m[0]<1){var s=h.point.getX()+q*m[0],t=h.point.getY()+r*m[0];j.insertSegment(new b.PolySegment(h.point,0)),j.insertSegment(new b.PolySegment(new IFPoint(s,t),0)),f.push(j)}else j.insertSegment(new b.PolySegment(h.point,0)),j.insertSegment(new b.PolySegment(i.next.point,0)),f.push(j);null!=m[1]&&m[1]>m[0]&&m[1]<1?(j=new b.PolySegmentContainer,s=h.point.getX()+q*m[1],t=h.point.getY()+r*m[1],h=new b.PolySegment(new IFPoint(s,t),0)):j=new b.PolySegmentContainer}g=c[k].segmIdx}for(var l=g;l<a.count;++l)h&&(j.insertSegment(h),i=i.next,h=i?new b.PolySegment(i.point,i.bulge,i.center,i.radius):null)},b.prototype._gcppClipping=function(a,b,c,d){for(var e,f=0;f<a.length;++f){e=a[f];for(var g=b.head,h=0;h<b.count-1;++h){for(var i=e.head,j=0;j<e.count-1;++j)i=i.next;g=g.next}d.push(e)}},b.prototype._gcppFilter=function(a,b,c,d,e){for(var f,g,h=(c-d)*(c-d),i=c+d,j=i*i,k=0;k<a.length;++k){f=a[k];
var l=b.head;g=j;for(var m=0;m<b.count-1&&g>=h;++m){for(var n=f.head,o=0;o<f.count-1&&g>=h;++o)g=this._getPlSegmSqrDist(l,l.next.point,n,n.next.point,i),n=n.next;l=l.next}g>=h&&e.push(f)}},b.prototype._getPlSegmSqrDist=function(a,b,c,d,e){var f;return f=a.bulge||c.bulge?c.bulge?a.bulge?this._getArcToArcSqrDist(a,b,c,d,e):this._getSegmToArcSqrDist(c.point,c.bulge,c.center,c.radius,d,a.point,b,e*e):this._getSegmToArcSqrDist(a.point,a.bulge,a.center,a.radius,b,c.point,d,e*e):ifMath.getSegmToSegmSqrDist(a.point,b,c.point,d)},b.prototype._getSegmToArcSqrDist=function(a,b,c,d,e,f,g,h){if(ifMath.isEqualEps(f.getX(),g.getX())&&ifMath.isEqualEps(f.getY(),g.getY()))return this._getPtToArcSqrDist(a,b,c,d,e,f);var i,j=h,k=[null,null],l=g.getX()-f.getX(),m=g.getY()-f.getY();if(ifMath.circleLineIntersection(f.getX(),f.getY(),l,m,c.getX(),c.getY(),d,k),null!=k[0]&&null==k[1]){var n=this._calculateBulge(a.getX(),a.getY(),k[0].getX(),k[0].getY(),c.getX(),c.getY(),b),o=k[1].getX()-f.getX(),p=k[1].getY()-f.getY();(0>o&&o>=l||o>=0&&l>=o)&&(0>p&&p>=m||p>=0&&m>=p)?0>n&&n>=b||n>=0&&b>=n?j=0:(j=ifMath.sqrSegmentDist(f.getX(),f.getY(),g.getX(),g.getY(),a.getX(),a.getY()),i=ifMath.sqrSegmentDist(f.getX(),f.getY(),g.getX(),g.getY(),e.getX(),e.getY()),j>i&&(j=i)):(j=this._getPtToArcSqrDist(a,b,c,d,e,f),i=this._getPtToArcSqrDist(a,b,c,d,e,g),j>i&&(j=i))}else{if(null==k[0]){var q=[null];if(i=ifMath.sqrSegmentDist(f.getX(),f.getY(),g.getX(),g.getY(),c.getX(),c.getY(),q),q[0]>0&&1>q){var r=f.getX()+q[0]*(g.getX()-f.getX()),s=f.getY()+q[0]*(g.getY()-f.getY()),t=d/Math.sqrt(i),u=c.getX()+t*(r-c.getX()),v=c.getY()+t*(s-c.getY()),w=this._calculateBulge(a.getX(),a.getY(),u,v,c.getX(),c.getY(),b);(0>w&&w>=b||w>=0&&b>=w)&&(j=ifMath.sqrSegmentDist(f.getX(),f.getY(),g.getX(),g.getY(),u,v))}}i=ifMath.sqrSegmentDist(f.getX(),f.getY(),g.getX(),g.getY(),a.getX(),a.getY()),j>i&&(j=i),j>0&&(i=ifMath.sqrSegmentDist(f.getX(),f.getY(),g.getX(),g.getY(),e.getX(),e.getY()),j>i&&(j=i),j>0&&(i=this._getPtToArcSqrDist(a,b,c,d,e,f),j>i&&(j=i),j>0&&(i=this._getPtToArcSqrDist(a,b,c,d,e,g),j>i&&(j=i))))}return j},b.prototype._getPtToArcSqrDist=function(a,b,c,d,e,f){var g,h=ifMath.ptSqrDist(f.getX(),f.getY(),c.getX(),c.getY());if(ifMath.isEqualEps(h,0))g=d*d;else{var i=d/Math.sqrt(h),j=c.getX()+i*(f.getX()-c.getX()),k=c.getY()+i*(f.getY()-c.getY()),l=this._calculateBulge(a.getX(),a.getY(),j,k,c.getX(),c.getY(),b);0>l&&l>=b||l>=0&&b>=l?g=ifMath.ptSqrDist(f.getX(),f.getY(),j,k):(g=ifMath.ptSqrDist(f.getX(),f.getY(),a.getX(),a.getY()),h=ifMath.ptSqrDist(f.getX(),f.getY(),e.getX(),e.getY()),g>h&&(g=h))}return g},b.prototype._getArcToArcSqrDist=function(a,b,c,d,e){var f=a.center.getX(),g=a.center.getY(),h=c.center.getX(),i=c.center.getY(),j=a.radius+c.radius+e,k=e*e;if(ifMath.ptSqrDist(f,g,h,i)>j*j)return k;var l=null,m=[a.point,b],n=[c.point,d],o=[null,null];ifMath.circleCircleIntersection(f,g,a.radius,h,i,c.radius,o);for(var p,q,r,s=0;2>s&&null!=o[s]&&null===l;++s)p=this._calculateBulge(a.point.getX(),a.point.getY(),o[s].getX(),o[s].getY(),a.center.getX(),a.center.getY(),a.bulge),q=0>p&&a.bulge<=p||p>=0&&a.bulge>=p,p=this._calculateBulge(c.point.getX(),c.point.getY(),o[s].getX(),o[s].getY(),c.center.getX(),c.center.getY(),c.bulge),r=0>p&&c.bulge<=p||p>=0&&c.bulge>=p,q&&r?l=0:q?m.push(o[s]):r&&n.push(o[s]);if(!(o[0]||ifMath.isEqualEps(f,h)&&ifMath.isEqualEps(g,i))){var t=h-f,u=i-g,v=[null,null];ifMath.circleLineIntersection(f,g,t,u,h,i,c.radius,v);for(var w,x,s=0;2>s&&null!=v[s];++s)w=f+t*v[s],x=g+u*v[s],p=this._calculateBulge(c.point.getX(),c.point.getY(),w,x,c.center.getX(),c.center.getY(),c.bulge),r=0>p&&c.bulge<=p||p>=0&&c.bulge>=p,r&&n.push(new IFPoint(w,x));t=-t,u=-u,v=[null,null],ifMath.circleLineIntersection(h,i,t,u,f,g,a.radius,v);for(var s=0;2>s&&null!=v[s];++s)w=h+t*v[s],x=i+u*v[s],p=this._calculateBulge(a.point.getX(),a.point.getY(),w,x,a.center.getX(),a.center.getY(),a.bulge),q=0>p&&a.bulge<=p||p>=0&&a.bulge>=p,q&&m.push(new IFPoint(w,x))}if(0!==l){l=k;for(var y,s=0;s<m.length&&l>0;++s)y=this._getPtToArcSqrDist(c.point,c.bulge,c.center,c.radius,d,m[s]),l>y&&(l=y);for(var s=0;s<n.length&&l>0;++s)y=this._getPtToArcSqrDist(a.point,a.bulge,a.center,a.radius,b,n[s]),l>y&&(l=y)}return l},b.prototype._roundOut=function(a){var b=Math.round(a*this._tolRange)/this._tolRange;return b},b.prototype._genCurves=function(a,b,c){for(var d,e=0;e<a.length;++e){d=a[e];for(var f=d.head,g=[],h=new IFPoint(this._roundOut(f.point.getX()),this._roundOut(f.point.getY())),i=h,j=0;j<d.count-1;++j){if(f.bulge){if(this._genBeziers(f.point,f.next.point,f.bulge,f.center,f.radius,c,g),j==d.count-2){var k=g[g.length-3];i=new IFPoint(k.x,k.y)}}else g.push({c:IFVertex.Command.Line,x:this._roundOut(f.next.point.getX()),y:this._roundOut(f.next.point.getY())}),j==d.count-2&&(i=new IFPoint(this._roundOut(f.next.point.getX()),this._roundOut(f.next.point.getY())));f=f.next}var l={stPt:h,endPt:i,vrt:g};b.push(l)}},b.prototype._genBeziers=function(a,b,c,d,e,f,g){var h=Math.abs(4*Math.atan(c)),i=Math.ceil(2*h/Math.PI);for(h/=i;32>=i&&this._getCubicBezierArcError(h,e)>f;)h/=2,i=2*i;c>0&&(h=-h);for(var j,k,l,m,n,o,p,q,r=Math.cos(h),s=Math.sin(h),t=(1-r)/(1+r),u=e*s*(Math.sqrt(4+3*t)-1)/3,v=(a.getX()-d.getX())/e,w=(a.getY()-d.getY())/e,x=a.getX(),y=a.getY(),z=0;i>z;++z)l=x,m=y,j=v,k=w,v=j*r-k*s,w=k*r+j*s,x=d.getX()+e*v,y=d.getY()+e*w,n=l-u*k,o=m+u*j,p=x+u*w,q=y-u*v,g.push({c:IFVertex.Command.Curve2,x:this._roundOut(x),y:this._roundOut(y)}),g.push({c:IFVertex.Command.Curve2,x:this._roundOut(n),y:this._roundOut(o)}),g.push({c:IFVertex.Command.Curve2,x:this._roundOut(p),y:this._roundOut(q)})},b.prototype._getCubicBezierArcError=function(a,b){var c=5.15347174*b,d=Math.cos(a),e=d*d,f=2*e-1,g=(4*e-3)*d,h=-19.65763511+22979e-8*d+42715e-8*f+.00103256*g,i=9.92683097+45907e-8*d+.00174813*f-34153e-8*g;return c*Math.exp(h+i*a)},b.prototype._rewindVertices=function(){for(var a=0;a<this._pieces.length;++a)this._pieces[a].rewindVertices(0)},b.prototype._readVertex=function(a){return this._pieces[this._pieceIdx]&&this._pieces[this._pieceIdx].readVertex(a)?!0:(++this._pieceIdx,this._pieces[this._pieceIdx]&&this._pieces[this._pieceIdx].readVertex(a))},b.prototype.toString=function(){return"[Object IFVertexOffsetter]"},a.IFVertexOffsetter=b}(this),function(a){function b(){}var c='url("data:image/svg+xml;base64,'+btoa('<svg xmlns="http://www.w3.org/2000/svg" width="8" height="8"><rect width="8" height="8" fill="white"/><rect width="4" height="4" fill="#CDCDCD"/><rect x="4" y="4" width="4" height="4" fill="#CDCDCD"/></svg>')+'")';IFObject.inherit(b,IFObject),b.Type={Color:"C",Gradient:"G",Texture:"T",Noise:"N"},b.MIME_TYPE="application/infinity+pattern",b.equals=function(a,b){if(!a&&a===b)return!0;if(a&&b){if(a instanceof IFColor&&b instanceof IFColor)return IFColor.equals(a,b);if(a instanceof IFGradient&&b instanceof IFGradient)return IFGradient.equals(a,b)}return!1},b.parsePattern=function(a){if(a&&a.length>0){var c=a.charAt(0);if(a=a.substring(1),c===b.Type.Color)return IFColor.parseColor(a);if(c===b.Type.Gradient)return IFGradient.parseGradient(a)}return null},b.asString=function(a){return a?a.getPatternType()+a.asString():null},b.asCSSBackground=function(a){var d=c;if(a)switch(a.getPatternType()){case b.Type.Color:d="linear-gradient("+a.asCSSString()+", "+a.asCSSString()+"), "+d;break;case b.Type.Gradient:d=a.asCSSBackgroundString()+", "+d}return d},b.prototype.getPatternType=function(){throw new Error("Not supported")},a.IFPattern=b}(this),function(a){function b(){}b.prototype.AnnotType={Rectangle:0,Circle:1,Diamond:2};var c={};b.prototype.paintAnnotation=function(a,b,c,d,e,f,g,h){var i=this._getAnnotationTemplate(d);b&&(c=b.mapPoint(c));var j=h?h:a.selectionOutlineColor,k=g?g:null;e&&(k=j,j=IFColor.WHITE);var l=Math.floor(c.getX())+(k?.5:0),m=Math.floor(c.getY())+(k?.5:0),n=f/2/i.scaleFactor,o=f/2/i.scaleFactor,p=a.canvas,q=new IFVertexTransformer(i.vertices,new IFTransform(n,0,0,o,l,m));p.putVertices(q),p.fillVertices(j),k&&p.strokeVertices(k,1)},b.prototype.getAnnotationBBox=function(a,b,c){a&&(b=a.mapPoint(b));var d=Math.floor(b.getX())+.5,e=Math.floor(b.getY())+.5;return new IFRect(d-c/2-1,e-c/2-1,c+2,c+2)},b.prototype._getAnnotationTemplate=function(a){var b=c[a];if(!b){var d=new IFVertexContainer,e=1;switch(a){case this.AnnotType.Rectangle:d.addVertex(IFVertex.Command.Move,-1,-1),d.addVertex(IFVertex.Command.Line,1,-1),d.addVertex(IFVertex.Command.Line,1,1),d.addVertex(IFVertex.Command.Line,-1,1),d.addVertex(IFVertex.Command.Close);break;case this.AnnotType.Circle:d.addVertex(IFVertex.Command.Move,-1,0),d.addVertex(IFVertex.Command.Curve,0,-1),d.addVertex(IFVertex.Command.Curve,-1,-1),d.addVertex(IFVertex.Command.Curve,1,0),d.addVertex(IFVertex.Command.Curve,1,-1),d.addVertex(IFVertex.Command.Curve,0,1),d.addVertex(IFVertex.Command.Curve,1,1),d.addVertex(IFVertex.Command.Curve,-1,0),d.addVertex(IFVertex.Command.Curve,-1,1);break;case this.AnnotType.Diamond:d.addVertex(IFVertex.Command.Move,-1,0),d.addVertex(IFVertex.Command.Line,0,-1),d.addVertex(IFVertex.Command.Line,1,0),d.addVertex(IFVertex.Command.Line,0,1),d.addVertex(IFVertex.Command.Close),e=Math.cos(Math.PI/4)}b={vertices:d,scaleFactor:e},c[a]=b}return b},a.ifAnnotation=new b}(this),function(a){function b(){this._types={}}b.Style={Normal:"N",Italic:"I"},b.Weight={Thin:100,ExtraLight:200,Light:300,Regular:400,Medium:500,SemiBold:600,Bold:700,ExtraBold:800,Heavy:900},b.WeightName={100:new IFLocale.Key(b,"weight.thin"),200:new IFLocale.Key(b,"weight.extra-light"),300:new IFLocale.Key(b,"weight.light"),400:new IFLocale.Key(b,"weight.regular"),500:new IFLocale.Key(b,"weight.medium"),600:new IFLocale.Key(b,"weight.semi-bold"),700:new IFLocale.Key(b,"weight.bold"),800:new IFLocale.Key(b,"weight.extra-bold"),900:new IFLocale.Key(b,"weight.heavy")},b.Category={Other:0,Serif:100,Monospace:200,Iconic:300},b.CategoryName={0:new IFLocale.Key(b,"category.other"),100:new IFLocale.Key(b,"category.serif"),200:new IFLocale.Key(b,"category.monospace"),300:new IFLocale.Key(b,"category.iconic")},b.prototype._types=null,b.prototype.addType=function(a,c,d,e,f){var g=this._types[a];g||(g={styles:{},weights:{},variants:{},category:f||b.Category.Other},this._types[a]=g);var h=c+d.toString();g.styles[c]=!0,g.weights[d]=!0;var i=function(a){switch(a){case b.Style.Normal:return"normal";case b.Style.Italic:return"italic";default:throw new Error("Unknown style")}},j=new XMLHttpRequest;j.open("get",e),j.responseType="arraybuffer",j.onload=function(){if(j.response&&j.response instanceof ArrayBuffer){var b=opentype.parse(j.response);b&&b.supported&&(g.variants[h]={url:e,font:b,outlines:{}},$("<style></style>").attr("type","text/css").text('@font-face {font-family: "'+a+'";src: url("'+e+'");font-weight: '+d.toString()+";font-style: "+i(c)+";} ").appendTo($("body")),$("<span></span>").css({position:"absolute",opacity:"0","font-family":a,"font-weight":d.toString(),"font-style":i(c)}).text(".").appendTo($("body")))}},j.send()},b.prototype.getFamilies=function(){var a=Object.keys(this._types);return a.sort(),a},b.prototype.getCategory=function(a){var c=this._types[a];return c?c.category:b.Category.Other},b.prototype.getStyles=function(a){var b=this._types[a];return b?Object.keys(b.styles):null},b.prototype.getWeights=function(a){var b=this._types[a];if(b){for(var c=Object.keys(b.weights),d=[],e=0;e<c.length;++e)d.push(parseInt(c[e]));return d.sort(),d}return null},b.prototype.getVariant=function(a,c,d,e){var f=this._types[a];if(f){if(f.styles.hasOwnProperty(c)||e||(c=b.Style.Normal),d="number"==typeof d?d:parseInt(d),!e){for(;!f.weights.hasOwnProperty(d)&&d>=100;)d-=100;for(;!f.weights.hasOwnProperty(d)&&900>=d;)d+=100}var g=c+d.toString();if(f.variants.hasOwnProperty(g))return g}return null},b.prototype.getGlyphBaseline=function(a,b,c,d){var e=this._types[a].variants[b].font,f=e.charToGlyph(d),g=1/e.unitsPerEm*c,h=(f.yMax-f.yMin)*g;return h+(e.ascender*g-h)},b.prototype.getGlyphOutline=function(a,b,c,d,e,f){var g=this._types[a].variants[b],h=g.font,i=g.outlines[f],j=1/h.unitsPerEm*c;if(!i){var k=h.charToGlyph(f),l=k.getPath(0,0,h.unitsPerEm);i=new IFVertexContainer,g.outlines[f]=i;for(var m=0;m<l.commands.length;m+=1){var n=l.commands[m];"M"===n.type?i.addVertex(IFVertex.Command.Move,n.x,n.y):"L"===n.type?i.addVertex(IFVertex.Command.Line,n.x,n.y):"C"===n.type?(i.addVertex(IFVertex.Command.Curve2,n.x,n.y),i.addVertex(IFVertex.Command.Curve2,n.x1,n.y1),i.addVertex(IFVertex.Command.Curve2,n.x2,n.y2)):"Q"===n.type?(i.addVertex(IFVertex.Command.Curve,n.x,n.y),i.addVertex(IFVertex.Command.Curve,n.x1,n.y1)):"Z"===n.type&&i.addVertex(IFVertex.Command.Close)}}return new IFVertexTransformer(i,new IFTransform(j,0,0,j,d,e))},a.IFFont=b,a.ifFont=new b}(this),function(a){var b={None:"n",RGB:"rgb",CMYK:"cmyk",LAB:"lab",XYZ:"xyz"};a.IFColorSpace=b}(this),function(a){function b(a,b){this._type=a,this._value=b&&b instanceof Array?b.slice():b}IFObject.inherit(b,IFPattern),b.Type={RGB:{key:"rgb",space:IFColorSpace.RGB,fromString:function(a){var b=[0,0,0,0],c=a.split(",");if(4!==c.length)b=null;else for(var d=0;4>d;++d){var e=parseInt(c[d]);if(isNaN(e)||0>e||3===d&&e>100||3>d&&e>255){b=null;break}b[d]=e}return b},toString:function(a){return a.join(",")}},HSL:{key:"hsl",space:IFColorSpace.RGB,fromString:function(a){var b=[0,0,0,0],c=a.split(",");if(4!==c.length)b=null;else for(var d=0;4>d;++d){var e=parseInt(c[d]);if(isNaN(e)||0>e||0===d&&e>360||d>0&&e>100){b=null;break}b[d]=e}return b},toString:function(a){return a.join(",")}},Tone:{key:"tone",space:IFColorSpace.RGB,fromString:function(a){var b=[0,0],c=a.split(",");if(2!==c.length)b=null;else for(var d=0;2>d;++d){var e=parseInt(c[d]);if(isNaN(e)||0>e||e>100){b=null;break}b[d]=e}return b},toString:function(a){return a.join(",")}},CMYK:{key:"cmyk",space:IFColorSpace.CMYK,fromString:function(a){var b=[0,0,0,0],c=a.split(",");if(4!==c.length)b=null;else for(var d=0;4>d;++d){var e=parseInt(c[d]);if(isNaN(e)||0>e||e>100){b=null;break}b[d]=e}return b},toString:function(a){return a.join(",")}},Reference:{key:"#",space:IFColorSpace.None,fromString:function(a){return a},toString:function(a){return a}},White:{key:"white",space:IFColorSpace.None},Black:{key:"black",space:IFColorSpace.None},Registration:{key:"registration",space:IFColorSpace.None}},b.BLACK=new b(b.Type.Black),b.WHITE=new b(b.Type.White),b.SELECTION_OUTLINE=new b(b.Type.RGB,[0,168,255,100]),b.HIGHLIGHT_OUTLINE=new b(b.Type.RGB,[255,0,0,100]),b.GUIDE_OUTLINE=new b(b.Type.RGB,[46,204,64,100]),b.MARGIN_OUTLINE=new b(b.Type.RGB,[255,0,255,100]),b.parseColor=function(a){if(!a||""===a)return null;for(var c in b.Type){var d=b.Type[c];if(0===a.indexOf(d.key)){if(!d.fromString)return new b(d);var e=d.fromString(a.substring(d.key.length));if(e)return new b(d,e)}}return null},b.parseCSSColor=function(a){function c(a){return a=Math.round(a),0>a?0:a>255?255:a}function d(a){return 0>a?0:a>1?1:a}function e(a){return c("%"===a[a.length-1]?parseFloat(a)/100*255:parseInt(a))}function f(a){return d("%"===a[a.length-1]?parseFloat(a)/100:parseFloat(a))}function g(a,b,c){return 0>c?c+=1:c>1&&(c-=1),1>6*c?a+(b-a)*c*6:1>2*c?b:2>3*c?a+(b-a)*(2/3-c)*6:a}var h={transparent:[0,0,0,0],aliceblue:[240,248,255,100],antiquewhite:[250,235,215,100],aqua:[0,255,255,100],aquamarine:[127,255,212,100],azure:[240,255,255,100],beige:[245,245,220,100],bisque:[255,228,196,100],black:[0,0,0,100],blanchedalmond:[255,235,205,100],blue:[0,0,255,100],blueviolet:[138,43,226,100],brown:[165,42,42,100],burlywood:[222,184,135,100],cadetblue:[95,158,160,100],chartreuse:[127,255,0,100],chocolate:[210,105,30,100],coral:[255,127,80,100],cornflowerblue:[100,149,237,100],cornsilk:[255,248,220,100],crimson:[220,20,60,100],cyan:[0,255,255,100],darkblue:[0,0,139,100],darkcyan:[0,139,139,100],darkgoldenrod:[184,134,11,100],darkgray:[169,169,169,100],darkgreen:[0,100,0,100],darkgrey:[169,169,169,100],darkkhaki:[189,183,107,100],darkmagenta:[139,0,139,100],darkolivegreen:[85,107,47,100],darkorange:[255,140,0,100],darkorchid:[153,50,204,100],darkred:[139,0,0,100],darksalmon:[233,150,122,100],darkseagreen:[143,188,143,100],darkslateblue:[72,61,139,100],darkslategray:[47,79,79,100],darkslategrey:[47,79,79,100],darkturquoise:[0,206,209,100],darkviolet:[148,0,211,100],deeppink:[255,20,147,100],deepskyblue:[0,191,255,100],dimgray:[105,105,105,100],dimgrey:[105,105,105,100],dodgerblue:[30,144,255,100],firebrick:[178,34,34,100],floralwhite:[255,250,240,100],forestgreen:[34,139,34,100],fuchsia:[255,0,255,100],gainsboro:[220,220,220,100],ghostwhite:[248,248,255,100],gold:[255,215,0,100],goldenrod:[218,165,32,100],gray:[128,128,128,100],green:[0,128,0,100],greenyellow:[173,255,47,100],grey:[128,128,128,100],honeydew:[240,255,240,100],hotpink:[255,105,180,100],indianred:[205,92,92,100],indigo:[75,0,130,100],ivory:[255,255,240,100],khaki:[240,230,140,100],lavender:[230,230,250,100],lavenderblush:[255,240,245,100],lawngreen:[124,252,0,100],lemonchiffon:[255,250,205,100],lightblue:[173,216,230,100],lightcoral:[240,128,128,100],lightcyan:[224,255,255,100],lightgoldenrodyellow:[250,250,210,100],lightgray:[211,211,211,100],lightgreen:[144,238,144,100],lightgrey:[211,211,211,100],lightpink:[255,182,193,100],lightsalmon:[255,160,122,100],lightseagreen:[32,178,170,100],lightskyblue:[135,206,250,100],lightslategray:[119,136,153,100],lightslategrey:[119,136,153,100],lightsteelblue:[176,196,222,100],lightyellow:[255,255,224,100],lime:[0,255,0,100],limegreen:[50,205,50,100],linen:[250,240,230,100],magenta:[255,0,255,100],maroon:[128,0,0,100],mediumaquamarine:[102,205,170,100],mediumblue:[0,0,205,100],mediumorchid:[186,85,211,100],mediumpurple:[147,112,219,100],mediumseagreen:[60,179,113,100],mediumslateblue:[123,104,238,100],mediumspringgreen:[0,250,154,100],mediumturquoise:[72,209,204,100],mediumvioletred:[199,21,133,100],midnightblue:[25,25,112,100],mintcream:[245,255,250,100],mistyrose:[255,228,225,100],moccasin:[255,228,181,100],navajowhite:[255,222,173,100],navy:[0,0,128,100],oldlace:[253,245,230,100],olive:[128,128,0,100],olivedrab:[107,142,35,100],orange:[255,165,0,100],orangered:[255,69,0,100],orchid:[218,112,214,100],palegoldenrod:[238,232,170,100],palegreen:[152,251,152,100],paleturquoise:[175,238,238,100],palevioletred:[219,112,147,100],papayawhip:[255,239,213,100],peachpuff:[255,218,185,100],peru:[205,133,63,100],pink:[255,192,203,100],plum:[221,160,221,100],powderblue:[176,224,230,100],purple:[128,0,128,100],red:[255,0,0,100],rosybrown:[188,143,143,100],royalblue:[65,105,225,100],saddlebrown:[139,69,19,100],salmon:[250,128,114,100],sandybrown:[244,164,96,100],seagreen:[46,139,87,100],seashell:[255,245,238,100],sienna:[160,82,45,100],silver:[192,192,192,100],skyblue:[135,206,235,100],slateblue:[106,90,205,100],slategray:[112,128,144,100],slategrey:[112,128,144,100],snow:[255,250,250,100],springgreen:[0,255,127,100],steelblue:[70,130,180,100],tan:[210,180,140,100],teal:[0,128,128,100],thistle:[216,191,216,100],tomato:[255,99,71,100],turquoise:[64,224,208,100],violet:[238,130,238,100],wheat:[245,222,179,100],white:[255,255,255,100],whitesmoke:[245,245,245,100],yellow:[255,255,0,100],yellowgreen:[154,205,50,100]},i=a.replace(/ /g,"").toLowerCase();if(i in h)return new b(b.Type.RGB,h[i].slice());if("#"===i[0]){if(4===i.length){var j=parseInt(i.substr(1),16);return j>=0&&4095>=j?new b(b.Type.RGB,[(3840&j)>>4|(3840&j)>>8,240&j|(240&j)>>4,15&j|(15&j)<<4,100]):null}if(7===i.length){var j=parseInt(i.substr(1),16);return j>=0&&16777215>=j?new b(b.Type.RGB,[(16711680&j)>>16,(65280&j)>>8,255&j,100]):null}return null}var k=i.indexOf("("),l=i.indexOf(")");if(-1!==k&&l+1===i.length){var m=i.substr(0,k),n=i.substr(k+1,l-(k+1)).split(","),o=100;switch(m){case"rgba":if(4!==n.length)return null;o=Math.round(100*f(n.pop()));case"rgb":return 3!==n.length?null:new b(b.Type.RGB,[e(n[0]),e(n[1]),e(n[2]),o]);case"hsla":if(4!==n.length)return null;o=Math.round(100*f(n.pop()));case"hsl":if(3!==n.length)return null;var p=(parseFloat(n[0])%360+360)%360/360,q=f(n[1]),r=f(n[2]),s=.5>=r?r*(q+1):r+q-r*q,t=2*r-s;return new b(b.Type.RGB,[c(255*g(t,s,p+1/3)),c(255*g(t,s,p)),c(255*g(t,s,p-1/3)),o]);default:return null}}return null},b.equals=function(a,b){if(!a&&a===b)return!0;if(a&&b&&a._type===b._type){var c=a._value,d=b._value;if(!c&&c===d)return!0;if(c instanceof Array&&d instanceof Array){if(c.length!==d.length)return!1;for(var e=0;e<c.length;++e)if(c[e]!==d[e])return!1;return!0}return c===d}return!1},b.prototype._type=null,b.prototype._value=null,b.prototype.getPatternType=function(){return IFPattern.Type.Color},b.prototype.getType=function(){return this._type},b.prototype.getValue=function(){return this._value},b.prototype.getSpace=function(){return this._type.space},b.prototype.difference=function(a){var b=this.asLAB(),c=a.asLAB();return ciede2000({L:b[0],a:b[1],b:b[2]},{L:c[0],a:c[1],b:c[2]})},b.prototype.toRGB=function(){return new b(b.Type.RGB,this.asRGB())},b.prototype.toHSL=function(){return new b(b.Type.HSL,this.asHSL())},b.prototype.toTone=function(){return new b(b.Type.Tone,this.asTone())},b.prototype.toCMYK=function(){return new b(b.Type.CMYK,this.asCMYK())},b.prototype.toType=function(a){switch(a){case b.Type.HSL:return this.toHSL();case b.Type.CMYK:return this.toCMYK();case b.Type.Tone:return this.toTone();default:return this.toRGB()}},b.prototype.asRGB=function(){if(this._type===b.Type.RGB)return this._value.slice();if(this._type===b.Type.HSL){var a,c,d,e,f,g,h=this._value[0]/360,i=this._value[1]/100,j=this._value[2]/100;0===i?a=c=d=j:(f=.5>j?j*(1+i):j+i-i*j,e=2*j-f,g=h+1/3,0>g&&(g+=1),g>1&&(g-=1),a=1>6*g?e+6*(f-e)*g:1>2*g?f:2>3*g?e+(f-e)*(2/3-g)*6:e,g=h,0>g&&(g+=1),g>1&&(g-=1),c=1>6*g?e+6*(f-e)*g:1>2*g?f:2>3*g?e+(f-e)*(2/3-g)*6:e,g=h-1/3,0>g&&(g+=1),g>1&&(g-=1),d=1>6*g?e+6*(f-e)*g:1>2*g?f:2>3*g?e+(f-e)*(2/3-g)*6:e);var k=Math.min(255,Math.max(0,Math.round(255*a))),l=Math.min(255,Math.max(0,Math.round(255*c))),m=Math.min(255,Math.max(0,Math.round(255*d)));return[k,l,m,this._value[3]]}if(this._type===b.Type.Tone){var n=255-Math.min(255,Math.max(0,Math.round(this._value[0]/100*255)));return[n,n,n,this._value[1]]}if(this._type===b.Type.CMYK){var o=this._value[0]/100,p=this._value[1]/100,q=this._value[2]/100,r=this._value[3]/100,s=o*(1-r)+r,t=p*(1-r)+r,u=q*(1-r)+r,k=Math.min(255,Math.max(0,Math.round(255*(1-s)))),l=Math.min(255,Math.max(0,Math.round(255*(1-t)))),m=Math.min(255,Math.max(0,Math.round(255*(1-u))));return[k,l,m,100]}if(this._type===b.Type.White)return[255,255,255,100];if(this._type===b.Type.Black)return[0,0,0,100];if(this._type===b.Type.Registration)return[0,0,0,100];throw new Error("Unable to convert to rgb from color type.")},b.prototype.asRGBInt=function(){var a=this.asRGB(),b=a[0],c=a[1],d=a[2],e=Math.round(2.55*a[3]);return ifSystem.littleEndian?e<<24|d<<16|c<<8|b:b<<24|c<<16|d<<8|e},b.prototype.asHSL=function(){if(this._type===b.Type.HSL)return this._value.slice();var a,c,d=this.asRGB(),e=d[0]/255,f=d[1]/255,g=d[2]/255,h=d[3],i=Math.min(e,f,g),j=Math.max(e,f,g),k=j-i,l=(j+i)/2;if(0===k)a=0,c=0;else{c=.5>l?k/(j+i):k/(2-j-i);var m=((j-e)/6+k/2)/k,n=((j-f)/6+k/2)/k,o=((j-g)/6+k/2)/k;e===j?a=o-n:f===j?a=1/3+m-o:g===j&&(a=2/3+n-m),0>a&&(a+=1),a>1&&(a-=1)}var p=Math.min(360,Math.max(0,Math.round(360*a))),q=Math.min(100,Math.max(0,Math.round(100*c))),r=Math.min(100,Math.max(0,Math.round(100*l)));return[p,q,r,h]},b.prototype.asTone=function(){if(this._type===b.Type.Tone)return this._value.slice();var a=this.asRGB(),c=a[0]/255,d=a[1]/255,e=a[2]/255,f=a[3],g=.299*c+.587*d+.114*e,h=100-Math.min(100,Math.max(0,Math.round(100*g)));return[h,f]},b.prototype.asCMYK=function(){if(this._type===b.Type.CMYK)return this._value.slice();var a=this.asRGB(),c=1-a[0]/255,d=1-a[1]/255,e=1-a[2]/255,f=Math.min(e,Math.min(d,Math.min(c,1))),g=a[3]/100,h=Math.round((c-f)/(1-f)*100*g),i=Math.round((d-f)/(1-f)*100*g),j=Math.round((e-f)/(1-f)*100*g),k=100*f*g;return[h,i,j,k]},b.prototype.asXYZ=function(a){var b=this.asRGB(),c=function(a){return a>.04045?Math.pow((a+.055)/1.055,2.4):a/12.92},d=100*c(b[0]/255),e=100*c(b[1]/255),f=100*c(b[2]/255),g=.4124*d+.3576*e+.1805*f,h=.2126*d+.7152*e+.0722*f,i=.0193*d+.1192*e+.9505*f;return[g,h,i]},b.prototype.asLAB=function(a){var b=this.asXYZ(a),c=function(a){return a>.008856?Math.pow(a,1/3):7.787037*a+4/29},d=c(b[0]/95.047),e=c(b[1]/100),f=c(b[2]/108.883);return[116*e-16,500*(d-e),200*(e-f)]},b.prototype.asString=function(){var a=this._type.key;return this._type.toString&&(a+=this._type.toString(this._value)),a},b.prototype.asCSSString=function(){var a=this.asRGB();return 100===a[3]?this.asHTMLHexString():"rgba("+a[0].toString()+","+a[1].toString()+","+a[2].toString()+","+(a[3]/100).toString()+")"},b.prototype.asHTMLHexString=function(){var a=this.asRGB(),b=a[0]<<16|a[1]<<8|a[2];return"#"+function(a){return new Array(7-a.length).join("0")+a}(b.toString(16).toUpperCase())},b.prototype.withTint=function(a){if(this._type===b.Type.CMYK){for(var c=a/100,d=this._value.slice(),e=0;4>e;++e)d[e]=Math.round(d[e]*c);return new b(b.Type.CMYK,d)}var c=1-a/100,f=this.asRGB();return f[0]=Math.round((255-f[0])*c+f[0]),f[1]=Math.round((255-f[1])*c+f[1]),f[2]=Math.round((255-f[2])*c+f[2]),new b(b.Type.RGB,f).toType(this._type)},b.prototype.withShade=function(a){if(this._type===b.Type.CMYK){var c=this.asCMYK();return c[3]=a,new b(b.Type.CMYK,c).toType(this._type)}var d=1-a/100,e=this.asRGB();return e[0]=Math.round(e[0]*d),e[1]=Math.round(e[1]*d),e[2]=Math.round(e[2]*d),new b(b.Type.RGB,e).toType(this._type)},b.prototype.withTone=function(a){return this.withTint(a).withShade(a)},b.prototype.toString=function(){return"[Object IFColor]"},a.IFColor=b}(this),function(a){function b(){}b.prototype._colorSpace=null,b.prototype._pcsSpace=null,b.prototype._illumination=null,b.convertColor=function(a){if(a.getType()===IFColor.Type.White);else if(a.getType()===IFColor.Type.Black);else{if(a.getSpace()!==this._colorSpace)throw new Error("Color space is different than profile color space.");var c=null;switch(this._pcsSpace){case b.Space.RGB:c=a.asRGB(),c[0]=c[0]/255,c[1]=c[1]/255,c[2]=c[2]/255;break;case b.Space.CMYK:c=a.asCMYK(),c[0]=c[0]/100,c[1]=c[1]/100,c[2]=c[2]/100,c[3]=c[3]/100;break;case b.Space.LAB:c=a.asLAB(this._illumination);break;case b.Space.XYZ:c=a.asXYZ(this._illumination);break;default:throw new Error("Unable to convert.")}}},b.prototype.toString=function(){return"[Object IFColorProfile]"},a.IFColorProfile=b}(this),function(a){function b(){}b.options={epsilon:2500,bufferSize:10},b.Matcher=function(){},b.Matcher.prototype._unitedArea=null,b.Matcher.prototype._rects=null,b.Matcher.prototype.isDirty=function(a){if(this._unitedArea&&!this._unitedArea.intersectsRect(a))return!1;if(this._rects&&this._rects.length>0)for(var b=0;b<this._rects.length;++b){var c=this._rects[b];if(c.intersectsRect(a))return!0}return!1},b.Matcher.prototype.transform=function(a){if(this._unitedArea&&(this._unitedArea=a.mapRect(this._unitedArea)),this._rects&&this._rects.length>0)for(var b=0;b<this._rects.length;++b)this._rects[b]=a.mapRect(this._rects[b])},b.Matcher.prototype.clip=function(a){if(this._rects&&this._rects.length>0){this._unitedArea&&(this._unitedArea=a.intersected(this._unitedArea));for(var b=0;b<this._rects.length;++b)this._rects[b]=a.intersected(this._rects[b])}else this._unitedArea=a,this._rects=[a]},b.Matcher.prototype.getDirtyRectangles=function(){return this._rects},b.prototype._area=null,b.prototype._dirties=null,b.prototype._numDirties=0,b.prototype.setArea=function(a){this._area=a},b.prototype.getArea=function(){return this._area},b.prototype.dirty=function(a,c,d,e){var f=Math.floor(a),g=Math.floor(c);if(d=Math.ceil(a+d)-f,e=Math.ceil(c+e)-g,a=f,c=g,this._area){if(!this._area.intersectsRectXYWH(a,c,d,e))return!1;a<this._area.getX()&&(a=this._area.getX()),c<this._area.getY()&&(c=this._area.getY()),a+d>this._area.getX()+this._area.getWidth()&&(d=this._area.getX()+this._area.getWidth()-a),c+e>this._area.getY()+this._area.getHeight()&&(e=this._area.getY()+this._area.getHeight()-c)}null==this._dirties?this._dirties=new Array(b.options.bufferSize):this._numDirties==this._dirties.length&&(this._dirties.length+=b.options.bufferSize);for(var h=0;h<this._numDirties;h++){var i=this._dirties[h];if(a>=i[0]&&c>=i[1]&&a+d<=i[0]+i[2]&&c+e<=i[1]+i[3])return!1;if(a<=i[0]&&c<=i[1]&&a+d>=i[0]+i[2]&&c+e>=i[1]+i[3])this._dirties[h][2]=0,this._dirties[h][3]=0;else{if(a>=i[0]&&a<i[0]+i[2]&&c>=i[1]&&c+e<=i[1]+i[3]){d=a+d-(i[0]+i[2]),a=i[0]+i[2],h=-1;continue}if(a+d>i[0]&&a+d<=i[0]+i[2]&&c>=i[1]&&c+e<=i[1]+i[3]){d=i[0]-a,h=-1;continue}if(a>=i[0]&&a+d<=i[0]+i[2]&&c>=i[1]&&c<i[1]+i[3]){e=c+e-(i[1]+i[3]),c=i[1]+i[3],h=-1;continue}if(a>=i[0]&&a+d<=i[0]+i[2]&&c+e>i[1]&&c+e<=i[1]+i[3]){e=i[1]-c,h=-1;continue}if(this._dirties[h][0]>=a&&this._dirties[h][0]<a+d&&this._dirties[h][1]>=c&&this._dirties[h][1]+this._dirties[h][3]<=c+e){this._dirties[h][2]=this._dirties[h][2]-(a+d-this._dirties[h][0]),this._dirties[h][0]=a+d,h=-1;continue}if(this._dirties[h][0]+this._dirties[h][2]>a&&this._dirties[h][0]+this._dirties[h][2]<=a+d&&this._dirties[h][1]>=c&&this._dirties[h][1]+this._dirties[h][3]<=c+e){this._dirties[h][2]=a-this._dirties[h][0],h=-1;continue}if(this._dirties[h][0]>=a&&this._dirties[h][0]+this._dirties[h][2]<=a+d&&this._dirties[h][1]>=c&&this._dirties[h][1]<c+e){this._dirties[h][3]=this._dirties[h][3]-(c+e-this._dirties[h][1]),this._dirties[h][1]=c+e,h=-1;continue}if(this._dirties[h][0]>=a&&this._dirties[h][0]+this._dirties[h][2]<=a+d&&this._dirties[h][1]+this._dirties[h][3]>c&&this._dirties[h][1]+this._dirties[h][3]<=c+e){this._dirties[h][3]=c-this._dirties[h][1],h=-1;continue}}}for(var h=0;h<this._numDirties;h++){var i=this._dirties[h];if(d>0&&e>0&&i[2]>0&&i[3]>0&&(Math.max(a+d,i[0]+i[2])-Math.min(a,i[0]))*(Math.max(c+e,i[1]+i[3])-Math.min(c,i[1]))<d*e+i[2]*i[3]+b.options.epsilon){var j=Math.min(i[0],a),k=Math.min(i[1],c),l=Math.max(a+d,i[0]+i[2])-Math.min(i[0],a),m=Math.max(c+e,i[1]+i[3])-Math.min(i[1],c);return this._dirties[h][2]=0,this._dirties[h][3]=0,this.dirty(j,k,l,m)}}return this._dirties[this._numDirties++]=[a,c,d,e],!0},b.prototype.flush=function(){var a=null;if(this._numDirties>0){a=new b.Matcher,a._rects=new Array(this._numDirties);for(var c=0,d=0;d<this._numDirties;++d){var e=this._dirties[d];if(e&&e[2]>0&&e[3]>0){var f=new IFRect(e[0],e[1],e[2],e[3]);a._rects[c++]=f,a._unitedArea=null==a._unitedArea?f:a._unitedArea.united(f)}}a._rects.length=c,0==a._rects.length&&(a=null)}return this.reset(),a},b.prototype.reset=function(){this._numDirties>0&&(this._dirties.length=b.options.bufferSize,this._numDirties=0)},b.prototype.toString=function(){return"[Object IFDirtyList]"},a.IFDirtyList=b}(this),function(a){function b(a,c){if(a){this._stops=[];for(var d=0;d<a.length;++d)this._stops.push({position:a[d].position<0?0:a[d].position>100?100:a[d].position,color:a[d].color})}else this._stops=[new IFColor(IFColor.Type.Black),new IFColor(IFColor.Type.White)];this._type=c?c:b.Type.Linear}IFObject.inherit(b,IFPattern),b.Type={Linear:"L",Radial:"R"},b.parseGradient=function(a){if(!a||""===a)return null;var c=JSON.parse(a);if(c){var d=new b;d._type=c.t,d._stops=[];for(var e=0;e<c.s.length;++e){var f=c.s[e];d._stops.push({position:f.p,color:IFColor.parseColor(f.c)})}return d}return null},b.equals=function(a,b,c){if(!a&&a===b)return!0;if(a&&b){if(!c&&a._type!==b._type)return!1;if(a._stops.length!==b._stops.length)return!1;for(var d=a._stops,e=b._stops,f=0;f<d.length;++f){if(d[f].position!==e[f].position)return!1;if(!IFColor.equals(d[f].color,e[f].color))return!1}}return!1},b.prototype._stops=null,b.prototype.getPatternType=function(){return IFPattern.Type.Gradient},b.prototype.getType=function(){return this._type},b.prototype.getStops=function(){return this._stops},b.prototype.asString=function(){for(var a=[],b=0;b<this._stops.length;++b)a.push({p:this._stops[b].position,c:this._stops[b].color.asString()});var c={t:this._type,s:a};return JSON.stringify(c)},b.prototype.asCSSString=function(){for(var a=[],b=0;b<this._stops.length;++b){var c=this._stops[b];a.push(""+c.color.asCSSString()+" "+c.position+"%")}return a.join(", ")
},b.prototype.asCSSBackgroundString=function(){var a=this.asCSSString();switch(this._type){case b.Type.Radial:return"radial-gradient(ellipse at center, "+a+")";default:return"linear-gradient(90deg, "+a+")"}},b.prototype.toString=function(){return"[Object IFGradient]"},a.IFGradient=b}(this),function(a){function b(){var a=document.createElement("canvas");this._canvasContext=a.getContext("2d")}function c(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}IFObject.inherit(b,IFObject),b.LineCap={Butt:"butt",Round:"round",Square:"square"},b.LineJoin={Miter:"miter",Bevel:"bevel",Round:"round"},b.BlendMode={Normal:"normal",Multiply:"multiply",Screen:"screen",Overlay:"overlay",Darken:"darken",Lighten:"lighten",ColorDoge:"color-doge",ColorBurn:"color-burn",HardLight:"hard-light",SoftLight:"soft-light",Difference:"difference",Exclusion:"exclusion",Hue:"hue",Saturation:"saturation",Color:"color",Luminosity:"luminosity"},b.CompositeOperator={SourceOver:"source-over",SourceAtTop:"source-atop",SourceIn:"source-in",SourceOut:"source-out",DestinationOver:"destination-over",DestinationAtTop:"destination-atop",DestinationIn:"destination-in",DestinationOut:"destination-out",Copy:"copy",Xor:"xor",Lighter:"lighter",Darker:"darker"},b.RepeatMode={Both:"repeat",Horizontal:"repeat-x",Vertical:"repeat-y",None:"no-repeat"},b.COLOR_MATRIX_IDENTITY=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],b.COLOR_MATRIX_INVERT=[-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0],b.COLOR_MATRIX_GRAYSCALE=[.33,.33,.33,0,0,.33,.33,.33,0,0,.33,.33,.33,0,0,0,0,0,1,0],b.createChessboard=function(a,b,c){var d=document.createElement("canvas");d.width=2*a,d.height=2*a;var e=d.getContext("2d");return e.fillStyle=b,e.fillRect(0,0,d.width,d.height),e.fillStyle=c,e.fillRect(0,0,a,a),e.fillRect(a,a,a,a),d},b.prototype._canvasContext=null,b.prototype._transform=null,b.prototype._offset=null,b.prototype._origin=null,b.prototype._scale=null,b.prototype._areas=null,b.prototype.getWidth=function(){return this._canvasContext.canvas.width},b.prototype.getHeight=function(){return this._canvasContext.canvas.height},b.prototype.asPNGImage=function(){return this._canvasContext.canvas.toDataURL("image/png")},b.prototype.asJPEGImage=function(a){return a=a||1,this._canvasContext.canvas.toDataURL("image/jpeg",a)},b.prototype.resize=function(a,b){(a!=this._canvasContext.canvas.width||b!=this._canvasContext.canvas.height)&&(this._canvasContext.canvas.width=a,this._canvasContext.canvas.height=b)},b.prototype.getOffset=function(){return this._offset},b.prototype.setOffset=function(a){this._offset=a},b.prototype.getOrigin=function(){return this._origin},b.prototype.setOrigin=function(a){IFPoint.equals(a,this._origin)||(this._origin=a,this._updateTransform())},b.prototype.getScale=function(){return this._scale},b.prototype.setScale=function(a){a!==this._scale&&(this._scale=a,this._updateTransform())},b.prototype.getTransform=function(a){var b=this._transform;if(!a){var c=this._origin.getX(),d=this._origin.getY(),e=this._scale;b=b.multiplied((new IFTransform).scaled(e,e).translated(-c,-d))}return b},b.prototype.setTransform=function(a){null==a&&(a=new IFTransform);var b=this._transform;return this._transform=a,this._updateTransform(),b},b.prototype.resetTransform=function(){return this.setTransform(null)},b.prototype.prepare=function(a){if(this._canvasContext.save(),this._transform=new IFTransform,this._origin=new IFPoint(0,0),this._scale=1,this._areas=a?a.slice():null,this._updateTransform(),a&&a.length>0){this._canvasContext.beginPath();for(var b=0;b<a.length;++b){var c=a[b],d=c.getX(),e=d+c.getWidth(),f=c.getY(),g=f+c.getHeight();d=Math.max(0,d),e=Math.min(this.getWidth(),e),f=Math.max(0,f),g=Math.min(this.getHeight(),g),this._canvasContext.moveTo(d,f),this._canvasContext.lineTo(e,f),this._canvasContext.lineTo(e,g),this._canvasContext.lineTo(d,g),this._canvasContext.lineTo(d,f),this._canvasContext.clearRect(d,f,e-d,g-f)}this._canvasContext.clip()}else this._canvasContext.clearRect(0,0,this.getWidth(),this.getHeight())},b.prototype.finish=function(){this._canvasContext.restore(),this._transform=null,this._origin=null,this._scale=null,this._areas=null},b.prototype.createCanvas=function(a,c){var d=new b,e=this.getTransform(!1).mapRect(a),f=e.getX(),g=e.getY(),h=e.getWidth(),i=e.getHeight();0>g&&(i+=g,g=0),0>f&&(h+=f,f=0),f+h>this.getWidth()&&(h=this.getWidth()-f),g+i>this.getHeight()&&(i=this.getHeight()-g);var j=this.getTransform(!1).inverted().mapRect(new IFRect(f,g,h,i)),k=new IFRect(j.getX()*this._scale,j.getY()*this._scale,j.getWidth()*this._scale,j.getHeight()*this._scale);d.resize(k.getWidth(),k.getHeight());var l=null;if(c&&this._areas){l=[];for(var m=0;m<this._areas.length;++m)l.push(this._areas[m].translated(-f,-g))}d.prepare(l);var n=k.getSide(IFRect.Side.TOP_LEFT);return d.setOrigin(n),d.setOffset(n),d.setScale(this._scale),d},b.prototype.clear=function(){var a=this.getTransform(!1).inverted().mapRect(new IFRect(0,0,this.getWidth(),this.getHeight()));this._canvasContext.clearRect(a.getX(),a.getY(),a.getWidth(),a.getHeight())},b.prototype.drawCanvas=function(a,c,d,e,f,g){var h=this._getImageSmoothingEnabled(),i=this._scale;this._setImageSmoothingEnabled(1>i),1!==a.getScale()&&this.setScale(1);var j=this.resetTransform(),k=j.getTranslation();c=0|c,d=0|d;var l=a.getOffset(),m=l?l.getX():0,n=l?l.getY():0,o=a.getWidth(),p=a.getHeight();m+=c+k.getX()*i,n+=d+k.getY()*i,g&&this._canvasContext.clearRect(m,n,o,p),this._canvasContext.globalAlpha="number"==typeof e?e:1,this._canvasContext.globalCompositeOperation=f?f:b.CompositeOperator.SourceOver,this._canvasContext.drawImage(a._canvasContext.canvas,0,0,o,p,m,n,o,p),this.setTransform(j),this.setScale(i),this._setImageSmoothingEnabled(h)},b.prototype.createTexture=function(a,c){return c=c||b.RepeatMode.Both,a=this._convertImage(a),this._canvasContext.createPattern(a,c)},b.prototype.createLinearGradient=function(a,b,c,d,e){for(var f=this._canvasContext.createLinearGradient(a,b,c,d),g=e.getStops(),h=0;h<g.length;++h)f.addColorStop(g[h].position/100,g[h].color.asCSSString());return f},b.prototype.createRadialGradient=function(a,b,c,d){for(var e=this._canvasContext.createRadialGradient(a,b,0,a,b,c),f=d.getStops(),g=0;g<f.length;++g)e.addColorStop(f[g].position/100,f[g].color.asCSSString());return e},b.prototype.clipRect=function(a,b,c,d){this._canvasContext.save(),this._canvasContext.beginPath(),this._canvasContext.moveTo(a,b),this._canvasContext.lineTo(a+c,b),this._canvasContext.lineTo(a+c,b+d),this._canvasContext.lineTo(a,b+d),this._canvasContext.lineTo(a,b),this._canvasContext.clip()},b.prototype.resetClip=function(){this._canvasContext.restore()},b.prototype.putVertices=function(a){if(a.rewindVertices(0)){this._canvasContext.beginPath();for(var b=new IFVertex;a.readVertex(b);)switch(b.command){case IFVertex.Command.Move:this._canvasContext.moveTo(b.x,b.y);break;case IFVertex.Command.Line:this._canvasContext.lineTo(b.x,b.y);break;case IFVertex.Command.Curve:var c=b.x,d=b.y;a.readVertex(b)&&this._canvasContext.quadraticCurveTo(b.x,b.y,c,d);break;case IFVertex.Command.Curve2:var c=b.x,d=b.y;if(a.readVertex(b)){var e=b.x,f=b.y;a.readVertex(b)&&this._canvasContext.bezierCurveTo(e,f,b.x,b.y,c,d)}break;case IFVertex.Command.Close:this._canvasContext.closePath();break;default:throw new Error("Unknown Command Type - "+b.command)}}},b.prototype.strokeVertices=function(a,c,d,e,f,g,h){this._canvasContext.strokeStyle=this._convertStyle(a),this._canvasContext.lineWidth="number"==typeof c?c:1,this._canvasContext.lineCap=d?d:"butt",this._canvasContext.lineJoin=e?e:"miter",this._canvasContext.miterLimit="number"==typeof f?f:10,this._canvasContext.globalAlpha="number"==typeof g?g:1,this._canvasContext.globalCompositeOperation=h?h:b.CompositeOperator.SourceOver,this._canvasContext.stroke()},b.prototype.fillVertices=function(a,c,d){this._canvasContext.fillStyle=this._convertStyle(a),this._canvasContext.globalAlpha="number"==typeof c?c:1,this._canvasContext.globalCompositeOperation=d?d:b.CompositeOperator.SourceOver,this._canvasContext.fill()},b.prototype.fillCanvas=function(a){var b=this.getTransform(!1).inverted().mapRect(new IFRect(0,0,this.getWidth(),this.getHeight()));this.fillRect(b.getX(),b.getY(),b.getWidth(),b.getHeight(),a)},b.prototype.fillRect=function(a,c,d,e,f,g){f=this._convertStyle(f?f:IFColor.BLACK),this._canvasContext.globalCompositeOperation=b.CompositeOperator.SourceOver,this._canvasContext.globalAlpha="number"==typeof g?g:1,this._canvasContext.fillStyle=f,this._canvasContext.fillRect(a,c,d,e)},b.prototype.strokeRect=function(a,c,d,e,f,g,h){g=this._convertStyle(g?g:IFColor.BLACK),f=f||1,this._canvasContext.globalCompositeOperation=b.CompositeOperator.SourceOver,this._canvasContext.globalAlpha="number"==typeof h?h:1,this._canvasContext.strokeStyle=g,this._canvasContext.lineWidth=f,this._canvasContext.strokeRect(a,c,d,e)},b.prototype.strokeLine=function(a,c,d,e,f,g){g=this._convertStyle(g?g:IFColor.BLACK),f=f||1,this._canvasContext.globalCompositeOperation=b.CompositeOperator.SourceOver,this._canvasContext.globalAlpha=1,this._canvasContext.strokeStyle=g,this._canvasContext.lineWidth=f,this._canvasContext.beginPath(),this._canvasContext.moveTo(a,c),this._canvasContext.lineTo(d,e),this._canvasContext.stroke()},b.prototype.drawImage=function(a,c,d,e,f,g){c=c||0,d=d||0,a=this._convertImage(a),this._canvasContext.globalAlpha="number"==typeof f?f:1,this._canvasContext.globalCompositeOperation=g?g:b.CompositeOperator.SourceOver;var h=this._getImageSmoothingEnabled();this._setImageSmoothingEnabled(!e),this._canvasContext.drawImage(a,c?c:0,d?d:0),this._setImageSmoothingEnabled(h)},b.prototype.modifyPixels=function(a,b){if(b=b||new IFRect(0,0,this.getWidth(),this.getHeight()),!b.isEmpty()){var c=this._canvasContext.getImageData(b.getX(),b.getY(),b.getWidth(),b.getHeight());a(c.data,b.getWidth(),b.getHeight()),this._canvasContext.putImageData(c,b.getX(),b.getY())}},b.prototype.blur=function(a,b){this.modifyPixels(function(b,d,g){if(!(isNaN(a)||1>a)){a|=0;var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F=a+a+1,G=d-1,H=g-1,I=a+1,J=I*(I+1)/2,K=new c,L=K;for(j=1;F>j;j++)if(L=L.next=new c,j==I)var M=L;L.next=K;var N=null,O=null;n=m=0;var P=e[a],Q=f[a];for(i=0;g>i;i++){for(w=x=y=z=o=p=q=r=0,s=I*(A=b[m]),t=I*(B=b[m+1]),u=I*(C=b[m+2]),v=I*(D=b[m+3]),o+=J*A,p+=J*B,q+=J*C,r+=J*D,L=K,j=0;I>j;j++)L.r=A,L.g=B,L.b=C,L.a=D,L=L.next;for(j=1;I>j;j++)k=m+((j>G?G:j)<<2),o+=(L.r=A=b[k])*(E=I-j),p+=(L.g=B=b[k+1])*E,q+=(L.b=C=b[k+2])*E,r+=(L.a=D=b[k+3])*E,w+=A,x+=B,y+=C,z+=D,L=L.next;for(N=K,O=M,h=0;d>h;h++)b[m]=o*P>>Q,b[m+1]=p*P>>Q,b[m+2]=q*P>>Q,b[m+3]=r*P>>Q,o-=s,p-=t,q-=u,r-=v,s-=N.r,t-=N.g,u-=N.b,v-=N.a,k=n+((k=h+a+1)<G?k:G)<<2,w+=N.r=b[k],x+=N.g=b[k+1],y+=N.b=b[k+2],z+=N.a=b[k+3],o+=w,p+=x,q+=y,r+=z,N=N.next,s+=A=O.r,t+=B=O.g,u+=C=O.b,v+=D=O.a,w-=A,x-=B,y-=C,z-=D,O=O.next,m+=4;n+=d}for(h=0;d>h;h++){for(x=y=z=w=p=q=r=o=0,m=h<<2,s=I*(A=b[m]),t=I*(B=b[m+1]),u=I*(C=b[m+2]),v=I*(D=b[m+3]),o+=J*A,p+=J*B,q+=J*C,r+=J*D,L=K,j=0;I>j;j++)L.r=A,L.g=B,L.b=C,L.a=D,L=L.next;for(l=d,j=1;a>=j;j++)m=l+h<<2,o+=(L.r=A=b[m])*(E=I-j),p+=(L.g=B=b[m+1])*E,q+=(L.b=C=b[m+2])*E,r+=(L.a=D=b[m+3])*E,w+=A,x+=B,y+=C,z+=D,L=L.next,H>j&&(l+=d);for(m=h,N=K,O=M,i=0;g>i;i++)k=m<<2,b[k+3]=D=r*P>>Q,D>0?(D=255/D,b[k]=(o*P>>Q)*D,b[k+1]=(p*P>>Q)*D,b[k+2]=(q*P>>Q)*D):b[k]=b[k+1]=b[k+2]=0,o-=s,p-=t,q-=u,r-=v,s-=N.r,t-=N.g,u-=N.b,v-=N.a,k=h+((k=i+I)<H?k:H)*d<<2,o+=w+=N.r=b[k],p+=x+=N.g=b[k+1],q+=y+=N.b=b[k+2],r+=z+=N.a=b[k+3],N=N.next,s+=A=O.r,t+=B=O.g,u+=C=O.b,v+=D=O.a,w-=A,x-=B,y-=C,z-=D,O=O.next,m+=d}}},b)},b.prototype.colorTransform=function(a,b,c){this.modifyPixels(function(c,d,e){for(var f=0;e>f;++f)for(var g=0;d>g;++g){var h=4*(f*d+g);c[h]=c[h]*a[0]+b[0],c[h+1]=c[h+1]*a[1]+b[1],c[h+2]=c[h+2]*a[2]+b[2],c[h+3]=c[h+3]*a[3]+b[3]}},c)},b.prototype.colorMatrix=function(a,b){this.modifyPixels(function(b,c,d){for(var e=0;d>e;++e)for(var f=0;c>f;++f){var g=4*(e*c+f),h=b[g],i=b[g+1],j=b[g+2],k=b[g+3];b[g]=a[0]*h+a[1]*i+a[2]*j+a[3]*k+a[4],b[g+1]=a[5]*h+a[6]*i+a[7]*j+a[8]*k+a[9],b[g+2]=a[10]*h+a[11]*i+a[12]*j+a[13]*k+a[14],b[g+3]=a[15]*h+a[16]*i+a[17]*j+a[18]*k+a[19]}},b)},b.prototype._updateTransform=function(){var a=this.getTransform(!1).getMatrix();this._canvasContext.setTransform(a[0],a[1],a[2],a[3],a[4],a[5])},b.prototype._convertStyle=function(a){if(a instanceof CanvasPattern||a instanceof CanvasGradient)return a;if(a instanceof IFColor)return a.asCSSString();throw new Error("Not Supported.")},b.prototype._convertImage=function(a){if(a instanceof HTMLImageElement||a instanceof Image||a instanceof HTMLCanvasElement)return a;if(a instanceof b)return a._canvasContext.canvas;throw new Error("Not Supported.")};var d=["imageSmoothingEnabled","webkitImageSmoothingEnabled","mozImageSmoothingEnabled"];b.prototype._getImageSmoothingEnabled=function(){for(var a=0;a<d.length;++a)if(this._canvasContext.hasOwnProperty(d[a]))return this._canvasContext[d[a]]},b.prototype._setImageSmoothingEnabled=function(a){for(var b=0;b<d.length;++b)if(this._canvasContext.hasOwnProperty(d[b]))return void(this._canvasContext[d[b]]=a)},a.IFPaintCanvas=b;var e=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],f=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24]}(this),function(a){function b(){}b.prototype.toString=function(){return"[Object IFPaintConfiguration]"},a.IFPaintConfiguration=b}(this),function(a){function b(){this.outlineColors=[]}b.prototype.configuration=null,b.prototype.canvas=null,b.prototype.dirtyMatcher=null,b.prototype.outlineColors=null,b.prototype.selectionOutlineColor=IFColor.SELECTION_OUTLINE,b.prototype.highlightOutlineColor=IFColor.HIGHLIGHT_OUTLINE,b.prototype.guideOutlineColor=IFColor.GUIDE_OUTLINE,b.prototype.isOutline=function(){return this.outlineColors&&this.outlineColors.length>0},b.prototype.getOutlineColor=function(){return this.outlineColors&&this.outlineColors.length>0?this.outlineColors[this.outlineColors.length-1]:IFColor.BLACK},b.prototype.toString=function(){return"[Object IFPaintContext]"},a.IFPaintContext=b}(this),function(a){function b(){}IFObject.inherit(b,IFObject),b.MIME_TYPE="application/infinity+node",b.inherit=function(a,c,d){IFObject.inherit(c,d),b._registerNodeClass(a,c)},b.inheritAndMix=function(a,c,d,e){IFObject.inheritAndMix(c,d,e),b._registerNodeClass(a,c)},b.getName=function(a){return b._nodeClassToNameMap[IFObject.getTypeId(a)]},b.store=function(a){if(a.hasMixin(b.Store)){var c={"@":b._nodeClassToNameMap[IFObject.getTypeId(a)]};if(a.store(c))return c}return null},b.restore=function(a){if(!a||!a.hasOwnProperty("@"))return null;var c=b._nameToNodeClassMap[a["@"]];if(!c)return null;var d=new c;return d&&d.restore(a)?d:null},b.serialize=function(a,c){if(a instanceof Array){for(var d=[],e=0;e<a.length;++e){var f=b.store(a[e]);f&&d.push(f)}if(d.length>0)return JSON.stringify(d,null,c?4:null)}else{var f=b.store(a);if(f)return JSON.stringify(f,null,c?4:null)}return null},b.deserialize=function(a){if(a){var c=JSON.parse(a);if(c&&c instanceof Array){for(var d=[],e=0;e<c.length;++e){var f=b.restore(c[e]);f&&d.push(f)}return d&&d.length>0?d:null}return b.restore(c)}return null},b.order=function(a){return a.slice()},b._nodeClassToNameMap={},b._nameToNodeClassMap={},b._registerNodeClass=function(a,c){b._nodeClassToNameMap[IFObject.getTypeId(c)]=a,b._nameToNodeClassMap[a]=c},b.Flag={Shadow:1,Selected:2,Highlighted:4,Active:8,Expanded:16},b._Change={BeforeChildInsert:1,AfterChildInsert:2,BeforeChildRemove:10,AfterChildRemove:11,BeforePropertiesChange:20,AfterPropertiesChange:21,BeforeFlagChange:30,AfterFlagChange:31},b.BeforeInsertEvent=function(a){this.node=a},IFObject.inherit(b.BeforeInsertEvent,GEvent),b.BeforeInsertEvent.prototype.node=null,b.BeforeInsertEvent.prototype.toString=function(){return"[Event IFNode.BeforeInsertEvent]"},b.AfterInsertEvent=function(a){this.node=a},IFObject.inherit(b.AfterInsertEvent,GEvent),b.AfterInsertEvent.prototype.node=null,b.AfterInsertEvent.prototype.toString=function(){return"[Event IFNode.AfterInsertEvent]"},b.BeforeRemoveEvent=function(a){this.node=a},IFObject.inherit(b.BeforeRemoveEvent,GEvent),b.BeforeRemoveEvent.prototype.node=null,b.BeforeRemoveEvent.prototype.toString=function(){return"[Event IFNode.BeforeRemoveEvent]"},b.AfterRemoveEvent=function(a){this.node=a},IFObject.inherit(b.AfterRemoveEvent,GEvent),b.AfterRemoveEvent.prototype.node=null,b.AfterRemoveEvent.prototype.toString=function(){return"[Event IFNode.AfterRemoveEvent]"},b.BeforePropertiesChangeEvent=function(a,b,c){this.node=a,this.properties=b,this.values=c},IFObject.inherit(b.BeforePropertiesChangeEvent,GEvent),b.BeforePropertiesChangeEvent.prototype.node=null,b.BeforePropertiesChangeEvent.prototype.properties=null,b.BeforePropertiesChangeEvent.prototype.values=null,b.BeforePropertiesChangeEvent.prototype.toString=function(){return"[Event IFNode.BeforePropertiesChangeEvent]"},b.AfterPropertiesChangeEvent=function(a,b,c){this.node=a,this.properties=b,this.values=c},IFObject.inherit(b.AfterPropertiesChangeEvent,GEvent),b.AfterPropertiesChangeEvent.prototype.node=null,b.AfterPropertiesChangeEvent.prototype.properties=null,b.AfterPropertiesChangeEvent.prototype.values=null,b.AfterPropertiesChangeEvent.prototype.toString=function(){return"[Event IFNode.AfterPropertiesChangeEvent]"},b.BeforeFlagChangeEvent=function(a,b,c){this.node=a,this.flag=b,this.set=c},IFObject.inherit(b.BeforeFlagChangeEvent,GEvent),b.BeforeFlagChangeEvent.prototype.node=null,b.BeforeFlagChangeEvent.prototype.flag=null,b.BeforeFlagChangeEvent.prototype.set=null,b.BeforeFlagChangeEvent.prototype.toString=function(){return"[Event IFNode.BeforeFlagChangeEvent]"},b.AfterFlagChangeEvent=function(a,b,c){this.node=a,this.flag=b,this.set=c},IFObject.inherit(b.AfterFlagChangeEvent,GEvent),b.AfterFlagChangeEvent.prototype.node=null,b.AfterFlagChangeEvent.prototype.flag=null,b.AfterFlagChangeEvent.prototype.set=null,b.AfterFlagChangeEvent.prototype.toString=function(){return"[Event IFNode.AfterFlagChangeEvent]"},b.Properties=function(){},b.Properties.prototype.hasProperty=function(a,b){var c=(b?"@":"$")+a;return this.hasOwnProperty(c)},b.Properties.prototype.getProperty=function(a,b,c){var d=(b?"@":"$")+a;return this.hasOwnProperty(d)?this[d]:c},b.Properties.prototype.getProperties=function(a,b,c){for(var d=[],e=0;e<a.length;++e){var f=c&&c.length>e?c[e]:null;d.push(this.getProperty(a[e],b,f))}return d},b.Properties.prototype.setProperty=function(a,b,c){return this.setProperties([a],[b],c)},b.Properties.prototype.setProperties=function(a,c,d){if(a.length!==c.length)throw new Error("Properties length does not match values length");for(var e=[],f=[],g=0;g<a.length;++g){var h=c[g],i=(d?"@":"$")+a[g],j=this[i];ifUtil.equals(h,j,!1)||(e.push(a[g]),f.push(c[g]))}if(0===e.length)return!1;var k={properties:e,values:f};this._notifyChange(b._Change.BeforePropertiesChange,k);for(var l=[],g=0;g<e.length;++g){var i=(d?"@":"$")+e[g];l.push(this[i]),this[i]=f[g]}return this._notifyChange(b._Change.AfterPropertiesChange,k),!0},b.Properties.prototype.storeProperties=function(a,b,c){c=c||function(a,b){return b};for(var d in b){var e=b[d],f=this["$"+d];if(!ifUtil.equals(f,e,!0)){var g=c(d,f);a[d]=g}}},b.Properties.prototype.restoreProperties=function(a,b,c){c=c||function(a,b){return b};var d=[],e=[];for(var f in b)d.push(f),e.push(a.hasOwnProperty(f)?c(f,a[f]):b[f]);this.setProperties(d,e,!1)},b.Properties.prototype.transferProperties=function(a,b){for(var c=[],d=[],e=0;e<b.length;++e)for(var f in b[e])c.push(f),d.push(a.hasProperty(f)?a.getProperty(f):b[e][f]);this.setProperties(c,d,!1)},b.Properties.prototype._setDefaultProperties=function(){for(var a=0;a<arguments.length;++a){var b=arguments[a];for(var c in b)this["$"+c]=b[c]}},b.Identity=function(){},b.Identity.prototype.getId=function(){throw new Error("Not Supported.")},b.Tag=function(){},b.Tag.prototype.getTags=function(){throw new Error("Not Supported.")},b.Reference=function(){},b.Reference.prototype._referenceId=null,b.Reference.prototype.getReferenceId=function(){return this._referenceId||(this._referenceId=ifUtil.uuid()),this._referenceId},b.Container=function(){},b.Container.prototype._firstChild=null,b.Container.prototype._lastChild=null,b.Container.prototype.getChildren=function(a){for(var b=[],c=this.getFirstChild(a);null!==c;c=c.getNext(a))b.push(c);return b},b.Container.prototype.getFirstChild=function(a){if(a||!this._firstChild)return this._firstChild;for(var c=this._firstChild;null!=c;c=c._next)if(!c.hasFlag(b.Flag.Shadow))return c;return null},b.Container.prototype.getLastChild=function(a){if(a||!this._lastChild)return this._lastChild;for(var c=this._lastChild;null!=c;c=c._previous)if(!c.hasFlag(b.Flag.Shadow))return c;return null},b.Container.prototype.appendChild=function(a){this.insertChild(a,null)},b.Container.prototype.insertChild=function(a,c){if(null!=a._scene)throw new Error("Child is already appended somewhere else");if(null!=c&&c.getParent()!=this)throw new Error("Reference is not a child of this node");if(!a.validateInsertion(this,c))throw new Error("Child insertion validation failed.");if(this._notifyChange(b._Change.BeforeChildInsert,a),a._setParent(this),null!=c?(a._setNext(c),a._setPrevious(c._previous),c._setPrevious(a),null==a._previous?this._firstChild=a:a._previous._setNext(a)):(null!=this._lastChild&&(a._setPrevious(this._lastChild),this._lastChild._setNext(a),this._lastChild=a),a._setNext(null)),null==this._firstChild&&(this._firstChild=a,a._setPrevious(null),a._setNext(null)),null==a._next&&(this._lastChild=a),this.isAttached()){var d=this;a.accept&&a.accept(function(a){a._setScene(d._scene)},!0)}this._notifyChange(b._Change.AfterChildInsert,a)},b.Container.prototype.removeChild=function(a){if(a._parent!=this)throw new Error("Child is not a child of this node");if(!a.validateRemoval())throw new Error("Child removal validation failed.");this._notifyChange(b._Change.BeforeChildRemove,a),this._firstChild==a&&(this._firstChild=a._next),this._lastChild==a&&(this._lastChild=a._previous),null!=a._previous&&a._previous._setNext(a._next),null!=a._next&&a._next._setPrevious(a._previous),a._setParent(null),a._setPrevious(null),a._setNext(null),this.isAttached()&&a.accept&&a.accept(function(a){a._setScene(null)},!0),this._notifyChange(b._Change.AfterChildRemove,a)},b.Container.prototype.clearChildren=function(a){for(;this.getFirstChild(a);)this.removeChild(this.getFirstChild(a))},b.Container.prototype.getIndexOfChild=function(a,b){if(a._parent===this)for(var c=0,d=this.getFirstChild(b);null!==d;d=d.getNext(b)){if(d===a)return c;c++}return-1},b.Container.prototype.getChildByIndex=function(a,b){for(var c=0,d=this.getFirstChild(b);null!==d;d=d.getNext(b)){if(c===a)return d;c++}return null},b.Container.prototype.acceptChildren=function(a,b){for(var c=this.getFirstChild(b);null!=c;c=c.getNext(b))if(c.accept(a,b)===!1)return!1;return!0},b.Container.prototype.toString=function(){return"[Mixin IFNode.Container]"},b.Store=function(){},b.Store.prototype.store=function(a){if(this.hasMixin(b.Container))for(var c=this.getFirstChild(!0);null!==c;c=c.getNext(!0)){var d=b.store(c);d&&(a.hasOwnProperty("$")?a.$.push(d):a.$=[d])}if(this.hasMixin(b.Properties))for(var e in this)this.hasOwnProperty(e)&&e.length>1&&"@"===e.charAt(0)&&(a[e]=this[e]);return this.hasMixin(b.Reference)&&this._referenceId&&(a["#"]=this._referenceId),!0},b.Store.prototype.restore=function(a){if(a.hasOwnProperty("$")&&this.hasMixin(b.Container)){var c=a.$;if(c.length>0)for(var d=0;d<c.length;++d){var e=b.restore(c[d]);e&&this.appendChild(e)}}if(this.hasMixin(b.Properties))for(var f in a)a.hasOwnProperty(f)&&f.length>1&&"@"===f.charAt(0)&&(this[f]=a[f]);return this.hasMixin(b.Reference)&&a.hasOwnProperty("#")&&(this._referenceId=a["#"]),!0},b.Store.prototype.clone=function(){var a=b.serialize(this);if(a){var c=b.deserialize(a);return c.hasMixin(b.Reference)&&(c._referenceId=null),c}return null},b.prototype._scene=null,b.prototype._parent=null,b.prototype._previous=null,b.prototype._next=null,b.prototype._flags=0,b.prototype.getNodeName=function(){return b.getName(this)},b.prototype.getNodeNameTranslated=function(){return ifLocale.getValue(this,"name",this.getNodeName())},b.prototype.isAttached=function(){return null!=this._scene},b.prototype.getScene=function(){return this._scene},b.prototype.getParent=function(){return this._parent},b.prototype.getPrevious=function(a){if(a||!this._previous)return this._previous;for(var c=this._previous;null!=c;c=c._previous)if(!c.hasFlag(b.Flag.Shadow))return c;return null},b.prototype.getNext=function(a){if(a||!this._next)return this._next;for(var c=this._next;null!=c;c=c._next)if(!c.hasFlag(b.Flag.Shadow))return c;return null},b.prototype.getNodesByName=function(a){var b=[];return this.accept(function(c){a&&"*"!=a&&a!==c.getNodeName()||c!==this&&b.push(c)}.bind(this)),b},b.prototype.queryCount=function(a){var b=IFSelector.queryAll(a,this);return b?b.length:0},b.prototype.queryAll=function(a){return IFSelector.queryAll(a,this)},b.prototype.querySingle=function(a){var b=IFSelector.querySingle(a,this);return b?b:null},b.prototype.matches=function(a){return IFSelector.match(a,this)},b.prototype.filtered=function(a){return 1===IFSelector.filter(a,[this]).length},b.prototype.accept=function(a,c){return!c&&this.hasFlag(b.Flag.Shadow)||a.call(null,this)!==!1?this.hasMixin(b.Container)?this.acceptChildren(a,c):!0:!1},b.prototype.hasFlag=function(a){return 0!=(this._flags&a)},b.prototype.setFlag=function(a){this._canModifyFlag(a,!0)&&0==(this._flags&a)&&(this._notifyChange(b._Change.BeforeFlagChange,{flag:a,set:!0}),this._flags=this._flags|a,this._notifyChange(b._Change.AfterFlagChange,{flag:a,set:!0}))},b.prototype.removeFlag=function(a){this._canModifyFlag(a,!1)&&0!=(this._flags&a)&&(this._notifyChange(b._Change.BeforeFlagChange,{flag:a,set:!1}),this._flags=this._flags&~a,this._notifyChange(b._Change.AfterFlagChange,{flag:a,set:!1}))},b.prototype.validateInsertion=function(){return!1},b.prototype.validateRemoval=function(){return!0},b.prototype._canModifyFlag=function(){return!0},b.prototype._beginBlockChanges=function(a){this._blockedChanges||(this._blockedChanges={},this._blockedChanges._counter=0);for(var b=0;b<a.length;++b){var c=a[b];c in this._blockedChanges?this._blockedChanges[c]++:this._blockedChanges[c]=1,this._blockedChanges._counter++}},b.prototype._endBlockChanges=function(a){if(this._blockedChanges)for(var b=0;b<a.length;++b){var c=a[b];c in this._blockedChanges&&0==--this._blockedChanges[c]&&0==--this._blockedChanges._counter&&delete this._blockedChanges}},b.prototype._beginBlockEvents=function(a){this._blockedEvents||(this._blockedEvents={},this._blockedEvents._counter=0);for(var b=0;b<a.length;++b){var c=IFObject.getTypeId(a[b]);c in this._blockedEvents?this._blockedEvents[c]++:this._blockedEvents[c]=1,this._blockedEvents._counter++}},b.prototype._endBlockEvents=function(a){if(this._blockedEvents)for(var b=0;b<a.length;++b){var c=IFObject.getTypeId(a[b]);c in this._blockedEvents&&0==--this._blockedEvents[c]&&0==--this._blockedEvents._counter&&delete this._blockedEvents}},b.prototype._getCompositeEvents=function(a,c,d){var e=[];return a&&(e=e.concat([b.BeforeInsertEvent,b.AfterInsertEvent,b.BeforeRemoveEvent,b.AfterRemoveEvent])),c&&(e=e.concat([b.BeforePropertiesChangeEvent,b.AfterPropertiesChangeEvent])),d&&(e=e.concat([b.BeforeFlagChangeEvent,b.AfterFlagChangeEvent])),e},b.prototype._beginBlockCompositeEvents=function(a,b,c){this._beginBlockEvents(this._getCompositeEvents(a,b,c))},b.prototype._endBlockCompositeEvents=function(a,b,c){this._endBlockEvents(this._getCompositeEvents(a,b,c))},b.prototype._notifyChange=function(a,b){this._blockedChanges&&this._blockedChanges[a]||this._handleChange(a,b)},b.prototype._canEventBeSend=function(a){if(!this.isAttached())return!1;if(!this._scene.hasEventListeners(a))return!1;var b=IFObject.getTypeId(a);return!this._blockedEvents||!this._blockedEvents[b]},b.prototype._setScene=function(a){a!==this._scene&&(this.hasMixin(b.Reference)&&(a?a.addReference(this):this._scene.removeReference(this)),this._scene=a)},b.prototype._setParent=function(a){this._parent=a},b.prototype._setPrevious=function(a){this._previous=a},b.prototype._setNext=function(a){this._next=a},b.prototype._handleChange=function(a,c){if(a==b._Change.BeforeChildInsert){var d=c;this._canEventBeSend(b.BeforeInsertEvent)&&this._scene.trigger(new b.BeforeInsertEvent(d))}else if(a==b._Change.AfterChildInsert){var d=c;this._canEventBeSend(b.AfterInsertEvent)&&this._scene.trigger(new b.AfterInsertEvent(d))}else if(a==b._Change.BeforeChildRemove){var d=c;this._canEventBeSend(b.BeforeRemoveEvent)&&this._scene.trigger(new b.BeforeRemoveEvent(d))}else if(a==b._Change.AfterChildRemove){var d=c;this._canEventBeSend(b.AfterRemoveEvent)&&this._scene.trigger(new b.AfterRemoveEvent(d))}else if(a==b._Change.BeforePropertiesChange){var e=c;this._canEventBeSend(b.BeforePropertiesChangeEvent)&&this._scene.trigger(new b.BeforePropertiesChangeEvent(this,e.properties,e.values))}else if(a==b._Change.AfterPropertiesChange){var e=c;this._canEventBeSend(b.AfterPropertiesChangeEvent)&&this._scene.trigger(new b.AfterPropertiesChangeEvent(this,e.properties,e.values))}else if(a==b._Change.BeforeFlagChange){var f=c;this._canEventBeSend(b.BeforeFlagChangeEvent)&&this._scene.trigger(new b.BeforeFlagChangeEvent(this,f.flag,f.set))}else if(a==b._Change.AfterFlagChange){var f=c;this._canEventBeSend(b.AfterFlagChangeEvent)&&this._scene.trigger(new b.AfterFlagChangeEvent(this,f.flag,f.set))}},a.IFNode=b}(this),function(a){function b(){}IFObject.inherit(b,IFNode),b.Flag={Hidden:1<<21,Locked:1<<22,NoPaint:1<<23},b.CollisionFlag={Partial:1,GeometryBBox:1024,PaintBBox:2048},b._Change={ChildGeometryUpdate:200,PrepareGeometryUpdate:220,FinishGeometryUpdate:221,InvalidationRequest:230,InvalidationRequested:231},b.GeometryChangeEvent=function(a,b){this.element=a,this.type=b},IFObject.inherit(b.GeometryChangeEvent,GEvent),b.GeometryChangeEvent.Type={Before:0,After:1,Child:2},b.GeometryChangeEvent.prototype.element=null,b.GeometryChangeEvent.prototype.type=null,b.GeometryChangeEvent.prototype.toString=function(){return"[Event IFElement.GeometryChangeEvent]"},b.HitResult=function(a,b){this.element=a,this.data=b},b.HitResult.prototype.element=null,b.HitResult.prototype.data=null,b.Transform=function(){},b.Transform.prototype.getTransform=function(){return null
},b.Transform.prototype.setTransform=function(){throw new Error("Not Supported.")},b.Transform.prototype.transform=function(a){this._transformChildren(a)},b.Transform.prototype._transformChildren=function(a){if(this.hasMixin(IFNode.Container))for(var c=this.getFirstChild(!0);null!=c;c=c.getNext(!0))c instanceof b&&c.hasMixin(b.Transform)&&c.transform(a)},b.Transform.prototype.toString=function(){return"[Mixin IFElement.Transform]"},b.Style=function(){},b.Style._styleSet=null,b.Style.prototype.getStyleSet=function(){if(this._styleSet&&this._styleSet.getParent()!==this&&(this._styleSet=null),!this._styleSet)for(var a=this.getFirstChild(!0);null!==a;a=a.getNext(!0))if(a instanceof IFStyleSet){this._styleSet=a;break}return this._styleSet},b.Style.prototype.renderStyle=function(a,b,c){if(a.configuration.isOutline(a))this._paint(a,b,c);else{var d=!1,e=!1,f=!1,g=1,h=IFPaintCanvas.BlendMode.Normal;if(b instanceof IFAppliedStyle){var i=b.getProperty("tp");switch(i){case IFAppliedStyle.Type.Content:break;case IFAppliedStyle.Type.Mask:d=!0;break;case IFAppliedStyle.Type.Knockout:f=!0;break;case IFAppliedStyle.Type.Background:e=!0}g=b.getProperty("opc"),h=b.getProperty("blm")}for(var j=1!==g||h!==IFPaintCanvas.BlendMode.Normal||d===!0||e===!0,k=[],l=[],m=b.getActualStyle().getFirstChild();null!==m;m=m.getNext())if(m instanceof IFStyleEntry&&m.getProperty("vs")===!0)if(m instanceof IFEffectEntry)k.push(m),j=!0;else if(m instanceof IFFilterEntry)l.push(m),j=!0;else if(m instanceof IFPaintEntry&&this.hasMixin(IFVertexSource)){var n=m.getPaintCmpOrBlend();null!==n&&n!==IFPaintCanvas.CompositeOperator.SourceOver&&n!==IFPaintCanvas.BlendMode.Normal&&(j=!0)}if(j){var o=a.canvas,p=b.getBBox(this.getGeometryBBox()),q=null;if(a.configuration.paintMode===IFScenePaintConfiguration.PaintMode.Fast){q=new IFPaintCanvas,q.resize(p.getWidth(),p.getHeight()),q.prepare();var r=p.getSide(IFRect.Side.TOP_LEFT);q.setOrigin(r),q.setOffset(r)}else q=o.createCanvas(p,!1);var s=q.createCanvas(p);a.canvas=s;try{this._paint(a,b,c)}finally{a.canvas=o,s.finish()}var t=f;if(k.length>0){k.sort(function(a,b){return a.isPost()===b.isPost()?0:b.isPost()?-1:1});for(var u=q.createCanvas(p),v=0;v<k.length;++v){var w=k[v];v>0&&u.clear(),w.isPost()&&(t||(q.drawCanvas(s),t=!0)),w.render(u,s,u.getScale()),q.drawCanvas(u)}u.finish()}t||q.drawCanvas(s);for(var v=0;v<l.length;++v)l[v].apply(q,q.getScale());o.drawCanvas(q,0,0,g,h),q.finish()}else this._paint(a,b,c)}},b.Style.prototype.toString=function(){return"[Mixin IFElement.Style]"},b.prototype._geometryBBbox=null,b.prototype._paintBBox=null,b.prototype.getGeometryBBox=function(){return this.isVisible()?(null==this._geometryBBbox&&(this._geometryBBbox=this._calculateGeometryBBox()),this._geometryBBbox):null},b.prototype.getChildrenGeometryBBox=function(){if(!this.isVisible())return null;if(this.hasMixin(IFNode.Container)){for(var a=null,c=this.getFirstChild();null!=c;c=c.getNext())if(c instanceof b){var d=c.getGeometryBBox();d&&!d.isEmpty()&&(a=a?a.united(d):d)}return a?a:null}return null},b.prototype.getPaintBBox=function(){return this.isVisible()?(null==this._paintBBox&&(this._paintBBox=this._calculatePaintBBox()),this._paintBBox):null},b.prototype.getChildrenPaintBBox=function(){if(!this.isVisible())return null;if(this.hasMixin(IFNode.Container)){for(var a=null,c=this.getFirstChild();null!=c;c=c.getNext())if(c instanceof b){var d=c.getPaintBBox();d&&!d.isEmpty()&&(a=a?a.united(d):d)}return a?a:new IFRect(0,0,0,0)}return null},b.prototype.isVisible=function(){return 0==(this._flags&b.Flag.Hidden)},b.prototype.hitTest=function(a,c,d,e,f,g,h){"number"!=typeof f&&(f=-1),g=g||0;var i=this.getPaintBBox();if(!i||i.isEmpty())return null;if(c&&(i=c.mapRect(i)),!i.expanded(g,g,g,g).containsPoint(a))return null;var j=null;if(0!==f&&this.hasMixin(IFNode.Container))for(var k=this.getLastChild();null!=k;k=k.getPrevious())if(k instanceof b){var l=k.hitTest(a,c,d,e,f-1,g,h);if(l){if(!e)return l;j?Array.prototype.push.apply(j,l):j=l}}if(d&&1==d.call(null,this)||!d){var m=this._detailHitTest(a,c,g,h);m&&(e&&j?j.push(m):j=[m])}return j},b.prototype.getCollisions=function(a,c,d){var e=[],f=function(a){(d&&1==d.call(null,a)||!d)&&e.push(a)};if(0!=(c&b.CollisionFlag.GeometryBBox)||0!=(c&b.CollisionFlag.PaintBBox)){var g=this.getPaintBBox();if(g&&!g.isEmpty()){var h=ifVertexInfo.calculateBounds(a,!0);0!=(c&b.CollisionFlag.Partial)?h.intersectsRect(g)&&f(this):h.containsRect(g)&&f(this)}}if(this.hasMixin(IFNode.Container))for(var i=this.getFirstChild();null!=i;i=i.getNext())if(i instanceof b){var j=i.getCollisions(a,c);if(j&&j.length)for(var k=0;k<j.length;++k)f(j[k])}return e},b.prototype.beginUpdate=function(){this._updateCounter?this._updateCounter++:(this._updateCounter=1,this._notifyChange(b._Change.PrepareGeometryUpdate),this._blockUpdateChanges())},b.prototype.endUpdate=function(a){null!=this._updateCounter&&0==--this._updateCounter&&(this._releaseUpdateChanges(),this._notifyChange(b._Change.FinishGeometryUpdate,a?!1:!0),delete this._updateCounter)},b.prototype.isRenderable=function(a){if(!this.isVisible())return!1;if(!a)return this.isAttached()&&this.getParent()||this instanceof IFScene;var b=this.getPaintBBox();return null==b||b.isEmpty()?!1:a&&a.dirtyMatcher&&!a.dirtyMatcher.isDirty(b)?!1:!0},b.prototype.render=function(a,c){if(this._preparePaint(a)){var d=!0;if(this.hasMixin(b.Style))for(var e=this.getStyleSet(),f=0,c=e.getFirstChild();null!==c;c=c.getNext())c instanceof IFStyle&&c.getProperty("vs")===!0&&(d=!1,this.renderStyle(a,c,f),f++);d&&this._paint(a,null,null),this._finishPaint(a)}},b.prototype._paint=function(a){this._renderChildren(a)},b.prototype._preparePaint=function(a){return this.hasFlag(b.Flag.NoPaint)?!1:this.isRenderable(a)},b.prototype._finishPaint=function(){},b.prototype._renderChildren=function(a){if(this.hasMixin(IFNode.Container))for(var c=this.getFirstChild();null!=c;c=c.getNext())c instanceof b&&c.render(a)},b.prototype._calculateGeometryBBox=function(){return this.getChildrenGeometryBBox()},b.prototype._calculatePaintBBox=function(){var a=this.getChildrenPaintBBox();return a&&this.hasMixin(b.Style)&&(a=this.getStyleSet().getBBox(a)),a},b.prototype._detailHitTest=function(){return null},b.prototype._blockUpdateChanges=function(){this._beginBlockChanges([b._Change.InvalidationRequest,b._Change.PrepareGeometryUpdate,b._Change.FinishGeometryUpdate,b._Change.ChildGeometryUpdate])},b.prototype._releaseUpdateChanges=function(){this._endBlockChanges([b._Change.InvalidationRequest,b._Change.PrepareGeometryUpdate,b._Change.FinishGeometryUpdate,b._Change.ChildGeometryUpdate])},b.prototype._requestInvalidateNode=function(a){if(a.isRenderable()){var b=a.getPaintBBox();b&&this._requestInvalidationArea(b.expanded(2,2,2,2))}},b.prototype._requestInvalidationArea=function(a){this.isAttached()&&(this._scene._invalidateArea(a),this._handleChange(b._Change.InvalidationRequested,a))},b.prototype._requestInvalidation=function(){this._requestInvalidateNode(this)},b.prototype._invalidateGeometry=function(){this._geometryBBbox=null,this._paintBBox=null},b.prototype._handleChange=function(a,c){if(a==b._Change.InvalidationRequest)this.isRenderable()&&this._requestInvalidation();else if(a===b._Change.InvalidationRequested)this.getParent()&&this.getParent()._notifyChange(b._Change.InvalidationRequested,c);else if(a==b._Change.PrepareGeometryUpdate){if(this.isRenderable()){var d=this.getPaintBBox();d&&!d.isEmpty()&&(this._savedPaintBBox=d)}this.isVisible()&&this._canEventBeSend(b.GeometryChangeEvent)&&this._scene.trigger(new b.GeometryChangeEvent(this,b.GeometryChangeEvent.Type.Before))}else if(a==b._Change.FinishGeometryUpdate){if(this.isVisible()){if(!1!==c&&this._invalidateGeometry(),this.isRenderable()){var e=this.getPaintBBox();IFRect.equals(e,this._savedPaintBBox)?this._requestInvalidation():(this.getParent()&&this.getParent()._notifyChange(b._Change.ChildGeometryUpdate,this),this._savedPaintBBox&&this._requestInvalidationArea(this._savedPaintBBox),this._handleChange(b._Change.InvalidationRequest))}this._canEventBeSend(b.GeometryChangeEvent)&&this._scene.trigger(new b.GeometryChangeEvent(this,b.GeometryChangeEvent.Type.After)),this._savedPaintBBox&&delete this._savedPaintBBox}}else if(a==b._Change.ChildGeometryUpdate)this.isVisible()&&(this._invalidateGeometry(),this._canEventBeSend(b.GeometryChangeEvent)&&this._scene.trigger(new b.GeometryChangeEvent(this,b.GeometryChangeEvent.Type.Child)),this.getParent()&&this.getParent()._notifyChange(a,c));else if(a==IFNode._Change.AfterChildInsert)c instanceof b&&(this._notifyChange(b._Change.ChildGeometryUpdate,c),c._handleChange(b._Change.InvalidationRequest)),IFNode.prototype._handleChange.call(this,a,c);else if(a==IFNode._Change.BeforeChildRemove)c instanceof b&&this._requestInvalidateNode(c),IFNode.prototype._handleChange.call(this,a,c);else if(a==IFNode._Change.AfterChildRemove)c instanceof b&&this._notifyChange(b._Change.ChildGeometryUpdate,c),IFNode.prototype._handleChange.call(this,a,c);else if(a==IFNode._Change.AfterFlagChange){switch(c.flag){case b.Flag.NoPaint:this._requestInvalidation()}IFNode.prototype._handleChange.call(this,a,c)}else IFNode.prototype._handleChange.call(this,a,c)},b.prototype._handleGeometryChangeForProperties=function(a,c,d){if((a==IFNode._Change.BeforePropertiesChange||a==IFNode._Change.AfterPropertiesChange)&&ifUtil.containsObjectKey(c.properties,d)){switch(a){case IFNode._Change.BeforePropertiesChange:this._notifyChange(b._Change.PrepareGeometryUpdate);break;case IFNode._Change.AfterPropertiesChange:this._notifyChange(b._Change.FinishGeometryUpdate)}return!0}return!1},b.prototype._handleVisualChangeForProperties=function(a,c,d){return a==IFNode._Change.AfterPropertiesChange&&ifUtil.containsObjectKey(c.properties,d)?(this._notifyChange(b._Change.InvalidationRequest),!0):!1},a.IFElement=b}(this),function(a){function b(){IFElement.call(this),this._setDefaultProperties(b.VisualProperties,b.MetaProperties)}IFObject.inheritAndMix(b,IFElement,[IFNode.Properties,IFNode.Store]),b.VisualProperties={visible:!0},b.MetaProperties={name:null,locked:!1},b.prototype._ownerLayer=null,b.prototype._rootLayer=null,b.prototype._page=null,b.prototype.getLabel=function(){return this.$name&&""!==this.$name?this.$name:this.getNodeNameTranslated()},b.prototype.getOwnerLayer=function(){return this._ownerLayer},b.prototype.getRootLayer=function(){return this._rootLayer},b.prototype.getPage=function(){return this._page},b.prototype.store=function(a){return IFNode.Store.prototype.store.call(this,a)?(this.storeProperties(a,b.VisualProperties),this.storeProperties(a,b.MetaProperties),!0):!1},b.prototype.restore=function(a){return IFNode.Store.prototype.restore.call(this,a)?(this.restoreProperties(a,b.VisualProperties),this.restoreProperties(a,b.MetaProperties),!0):!1},b.prototype._setParent=function(a){IFElement.prototype._setParent.call(this,a),a?(this._ownerLayer=a instanceof IFLayer?a:a instanceof b?a.getOwnerLayer():null,this._rootLayer=a instanceof IFLayer&&!a.getOwnerLayer()?a:a instanceof b?a.getRootLayer():null,this._page=a instanceof IFPage?a:a instanceof b?a.getPage():null):(this._ownerLayer=null,this._rootLayer=null,this._page=null)},b.prototype._handleChange=function(a,b){if(a==IFNode._Change.AfterPropertiesChange){var c=b;if(c.properties.indexOf("visible")>=0){var d=this.getProperty("visible"),e=d?null:this.getPaintBBox();this.accept(function(a){a instanceof IFElement&&(d?a.removeFlag(IFElement.Flag.Hidden):a.setFlag(IFElement.Flag.Hidden),a._invalidateGeometry())}),this.getParent()&&this.getParent()._notifyChange(IFElement._Change.ChildGeometryUpdate,this),d?this._handleChange(IFElement._Change.InvalidationRequest):this._requestInvalidationArea(e)}else if(c.properties.indexOf("locked")>=0){var f=this.getProperty("locked");this.accept(function(a){a instanceof IFElement&&(f?a.setFlag(IFElement.Flag.Locked):a.removeFlag(IFElement.Flag.Locked))})}IFElement.prototype._handleChange.call(this,a,b)}else IFElement.prototype._handleChange.call(this,a,b)},a.IFBlock=b}(this),function(a){function b(){IFBlock.call(this)}IFObject.inherit(b,IFBlock),a.IFItem=b}(this),function(a){function b(){IFElement.call(this),this._scene=this,this._references={},this._links={},this._setDefaultProperties(b.MetaProperties)}IFNode.inheritAndMix("scene",b,IFElement,[IFNode.Container,IFNode.Properties,IFNode.Store,GEventTarget]),b.UnitSnap={None:"N",Full:"F",Half:"H"},b.PAGE_SPACING=10,b.VERSION=1,b.MetaProperties={version:b.VERSION,clspace:IFColorSpace.RGB,unit:IFLength.Unit.PT,unitSnap:b.UnitSnap.Full,snapDist:5,pickDist:3,crDistSmall:1,crDistBig:10,crConstraint:0,gridSizeX:10,gridSizeY:10,gridActive:!1,singlePage:!0,pathImage:"images",pathFont:"fonts",pathExport:"export"},b.InvalidationRequestEvent=function(a){this.area=a?a:null},IFObject.inherit(b.InvalidationRequestEvent,GEvent),b.InvalidationRequestEvent.prototype.area=null,b.InvalidationRequestEvent.prototype.toString=function(){return"[Event IFScene.InvalidationRequestEvent]"},b.ReferenceEvent=function(a,b,c){this.reference=a,this.target=b,this.linked=c},IFObject.inherit(b.ReferenceEvent,GEvent),b.ReferenceEvent.prototype.reference=null,b.ReferenceEvent.prototype.target=null,b.ReferenceEvent.prototype.linked=null,b.ReferenceEvent.prototype.toString=function(){return"[Event IFScene.ReferenceEvent]"},b.ResolveUrlEvent=function(a,b){this.url=a,this.resolved=b},IFObject.inherit(b.ResolveUrlEvent,GEvent),b.ResolveUrlEvent.prototype.url=null,b.ResolveUrlEvent.prototype.resolved=null,b.ResolveUrlEvent.prototype.toString=function(){return"[Event IFScene.ResolveUrlEvent]"},b.StyleCollection=function(){IFNode.call(this)},IFNode.inheritAndMix("styleCollection",b.StyleCollection,IFNode,[IFNode.Container,IFNode.Store]),b.StyleCollection.prototype.validateInsertion=function(a){return a instanceof b},b.SwatchCollection=function(){IFNode.call(this)},IFNode.inheritAndMix("swatchCollection",b.SwatchCollection,IFNode,[IFNode.Container,IFNode.Store]),b.SwatchCollection.prototype.validateInsertion=function(a){return a instanceof b},b.prototype._references=null,b.prototype._links=null,b.prototype._styleCollection=null,b.prototype._swatchCollection=null,b.prototype.getStyleCollection=function(){if(this._styleCollection&&this._styleCollection.getParent()!==this&&(this._styleCollection=null),!this._styleCollection)for(var a=this.getFirstChild(!0);null!==a;a=a.getNext(!0))if(a instanceof b.StyleCollection){this._styleCollection=a;break}return this._styleCollection||(this._styleCollection=new b.StyleCollection,this.appendChild(this._styleCollection)),this._styleCollection},b.prototype.getSwatchCollection=function(){if(this._swatchCollection&&this._swatchCollection.getParent()!==this&&(this._swatchCollection=null),!this._swatchCollection)for(var a=this.getFirstChild(!0);null!==a;a=a.getNext(!0))if(a instanceof b.SwatchCollection){this._swatchCollection=a;break}return this._swatchCollection||(this._swatchCollection=new b.SwatchCollection,this.appendChild(this._swatchCollection)),this._swatchCollection},b.prototype.store=function(a){return IFNode.Store.prototype.store.call(this,a)?(this.storeProperties(a,b.MetaProperties),!0):!1},b.prototype.restore=function(a){return IFNode.Store.prototype.restore.call(this,a)?(this.restoreProperties(a,b.MetaProperties),!0):!1},b.prototype.stringToLength=function(a){return IFLength.parseEquation(a,this.$unit)},b.prototype.stringToPoint=function(a){var b=this.stringToLength(a);return b?b.toPoint():null},b.prototype.lengthToString=function(a){return ifUtil.formatNumber(a.toUnit(this.$unit))},b.prototype.pointToString=function(a){return this.lengthToString(new IFLength(a))},b.prototype.getElementsByBBox=function(a,b){var c=[];return this.acceptChildren(function(d){if(d instanceof IFElement){var e=d.getPaintBBox();e&&!e.isEmpty()&&(b&&a.intersectsRect(e)||!b&&a.containsRect(e))&&c.push(d)}}),c},b.prototype.getActivePage=function(){return this.querySingle("page:active")},b.prototype.setActivePage=function(a){if(!a.isAttached())throw new Error("Page needs to be attached to be made active.");for(var b=this.getFirstChild();null!==b;b=b.getNext())b instanceof IFPage&&b!==a&&b.removeFlag(IFNode.Flag.Active);a.setFlag(IFNode.Flag.Active)},b.prototype.getActiveLayer=function(){return this.querySingle("page:active layer:active")},b.prototype.setActiveLayer=function(a){if(!a.isAttached())throw new Error("Layer needs to be attached to be made active.");var b=a.getPage();this.setActivePage(b),b.acceptChildren(function(b){b instanceof IFLayer&&b!==a&&b.removeFlag(IFNode.Flag.Active)}),a.setFlag(IFNode.Flag.Active)},b.prototype.getPageInsertPosition=function(){for(var a=this.getLastChild();null!==a;a=a.getPrevious())if(a instanceof IFPage)return new IFPoint(a.getProperty("x")+a.getProperty("w")+b.PAGE_SPACING,a.getProperty("y"));return new IFPoint(0,0)},b.prototype.willPageIntersectWithOthers=function(a,c){c=c.expanded(b.PAGE_SPACING,b.PAGE_SPACING,b.PAGE_SPACING,b.PAGE_SPACING);for(var d=this.getLastChild();null!==d;d=d.getPrevious())if(d instanceof IFPage&&d!==a){var e=d.getGeometryBBox();if(e&&e.intersectsRect(c))return!0}return!1},b.prototype.link=function(a,c){var d=a.getReferenceId();this._links.hasOwnProperty(d)||(this._links[d]=[]),this._links[d].push(c),this.hasEventListeners(b.ReferenceEvent)&&this.trigger(new b.ReferenceEvent(a,c,!0))},b.prototype.unlink=function(a,c){var d=a.getReferenceId();if(this._links.hasOwnProperty(d)){var e=this._links[d],f=e.indexOf(c);f>=0&&(e.splice(f,1),0===e.length&&delete this._links[d],this.hasEventListeners(b.ReferenceEvent)&&this.trigger(new b.ReferenceEvent(a,c,!1)))}},b.prototype.visitLinks=function(a,b){var c=this._links[a.getReferenceId()];if(c)for(var d=0;d<c.length;++d)b(c[d])},b.prototype.hasLinks=function(a){return this._links.hasOwnProperty(a.getReferenceId())},b.prototype.linkCount=function(a){var b=this._links[a.getReferenceId()];return b?b.length:0},b.prototype.addReference=function(a){var b=a.getReferenceId();if(this._references.hasOwnProperty(b))throw new Error("Reference already added.");this._references[b]=a},b.prototype.removeReference=function(a){var b=a.getReferenceId();if(!this._references.hasOwnProperty(b))throw new Error("Reference not yet added.");delete this._references[b]},b.prototype.getReference=function(a){return this._references.hasOwnProperty(a)?this._references[a]:null},b.prototype.resolveUrl=function(a,c){a&&0!==a.indexOf("data:")?this.hasEventListeners(b.ResolveUrlEvent)&&this.trigger(new b.ResolveUrlEvent(a,c)):c(a)},b.prototype.hitTest=function(a,b,c,d,e,f,g){if(this.$singlePage){var h=this.getActivePage();if(h)return h.hitTest(a,b,c,d,e,f,g)}return IFElement.prototype.hitTest.call(this,a,b,c,d,e,f,g)},b.prototype._invalidateArea=function(a){this.hasEventListeners(b.InvalidationRequestEvent)&&this.trigger(new b.InvalidationRequestEvent(a))},b.prototype._renderChildren=function(a){for(var b=this.getFirstChild();null!=b;b=b.getNext())b instanceof IFPage?(!this.$singlePage||b.hasFlag(IFNode.Flag.Active))&&b.render(a):b instanceof IFElement&&b.render(a)},b.prototype._calculatePaintBBox=function(){var a=IFElement.prototype._calculatePaintBBox.call(this);if(this.__editor__&&this.__editor__.isTransformBoxActive()){var b=this.__editor__.getTransformBox()._calculatePaintBBox();b&&!b.isEmpty()&&(a=a?a.united(b):b)}return a},b.prototype._calculateGeometryBBox=function(){var a=IFElement.prototype._calculateGeometryBBox.call(this);if(this.__editor__&&this.__editor__.isTransformBoxActive()){var b=this.__editor__.getTransformBox()._calculatePaintBBox();b&&!b.isEmpty()&&(a=a?a.united(b):b)}return a},b.prototype._handleChange=function(a,b){IFElement.prototype._handleChange.call(this,a,b)},a.IFScene=b}(this),function(a){function b(){}IFObject.inherit(b,IFPaintConfiguration),b.PaintMode={Full:"F",Fast:"S",Outline:"L",Output:"O"},b.PaintModeName={F:new IFLocale.Key(b,"paint.full"),S:new IFLocale.Key(b,"paint.fast"),L:new IFLocale.Key(b,"paint.outline"),O:new IFLocale.Key(b,"paint.output")},b.prototype.paintMode=b.PaintMode.Fast,b.prototype.pixelMode=!1,b.prototype.guides=!0,b.prototype.slices=!0,b.prototype.annotations=!0,b.prototype.isOutline=function(a){return this.paintMode===b.PaintMode.Outline?!0:a&&a.isOutline()?a.isOutline():!1},b.prototype.isRasterEffects=function(a){return this.isOutline(a)?!1:this.paintMode!==b.PaintMode.Fast},b.prototype.isAnnotationsVisible=function(){return this.annotations&&this.paintMode!==b.PaintMode.Output?!0:!1},b.prototype.isGuidesVisible=function(){return this.guides&&this.isAnnotationsVisible()?!0:!1},b.prototype.isSlicesVisible=function(){return this.slices&&this.isAnnotationsVisible()?!0:!1},b.prototype.toString=function(){return"[Object IFScenePaintConfiguration]"},a.IFScenePaintConfiguration=b}(this);var IFSelector=function(){function a(a,b,c,d){return a?d?function(d,e){return b(d,c,e)&&a(d,e)}:function(d,e){return a(d,e)&&b(d,c,e)}:function(a,d){return b(a,c,d)}}var b={},c=function(a,d,e,f){a="string"==typeof a?a.replace(/^\s+|\s+$/g,""):"";var g=b[a]||(b[a]=new c.initialize(a));return null==d?g:g.search(d,e,f)};c.initialize=function(a){this.text=a};var d=c.initialize.prototype=c.prototype,e=function(){return!0};d.queryAll=function(a,b,d){d=d||{};var f,g,h;if(!(a&&a instanceof IFNode))throw new Error("Missing context or invalid context");if(!(a instanceof IFNode))if("string"==typeof a)a=c.queryAll(a),f=!0;else if("[object Array]"==Object.prototype.toString.call(a)||"number"==typeof a.length&&a.item){var i=[];for(g=0;h=a[g];g++)h instanceof IFNode&&i.push(h);f=i.length>1,a=f?i:i[0]}var j,k,l,m={},n={},o=m,p=c.getUid,q=function(a){var b=p(a);return o[b]?null:o[b]=!0};if(b&&b.length)for(g=0;h=b[g];g++)q(h);var r=this.parse();if(!r.length)return[];for(var s,g=0;s=r[g];g++){var t=q;if(s.first&&(b?j=!0:t=e,f?l=a:s.combinator&&(l=[a])),s.last&&b?(o=m,k=b):(o={},k=[]),s.combinator||f)for(var u=0,v=l.length;v>u;u++)k=s.combine(k,l[u],s,n,t);else k=s.combine(k,a,s,n,t,!k.length);s.last?k.length&&(b=k):l=k}return b||[]},d.querySingle=function(a,b,c){return this.queryAll(a,b,c)[0]},d.match=function(a,b){var c=this.parse();if(1==c.length)return!!this.parse()[0].match(a,{});if(!b)for(b=a;b.getParent();)b=b.getParent();for(var d=this.queryAll(b),e=d.length;e--;)if(d[e]==a)return!0;return!1},d.filter=function(a){for(var b,c=[],d=this.parse(),e=0;b=a[e];e++)for(var f=0;f<d.length;++f){var g=d[f].match;g(b)&&c.push(b)}return c};var f;c.recompile=function(){var a,b=[","],d=["!"];for(a in p)" "!=a&&b[a.length>1?"unshift":"push"](c.escapeRegExp(a));for(a in r)d.push(a);f=new RegExp("[\\w\\u00a1-\\uFFFF][\\w\\u00a1-\\uFFFF-]*|[#.](?:[\\w\\u00a1-\\uFFFF-]|\\\\:|\\\\.)+|[ \\t\\r\\n\\f](?=[\\w\\u00a1-\\uFFFF*#.[:])|[ \\t\\r\\n\\f]*("+b.join("|")+")[ \\t\\r\\n\\f]*|\\[([\\w\\u00a1-\\uFFFF-]+)[ \\t\\r\\n\\f]*(?:(["+d.join("")+"]?=)[ \\t\\r\\n\\f]*(?:\"([^\"]*)\"|'([^']*)'|([^\\]]*)))?]|:([-\\w\\u00a1-\\uFFFF]+)(?:\\((?:\"([^\"]*)\"|'([^']*)'|([^)]*))\\))?|\\*|(.+)","g")};var g=function(a){return{ident:[],tags:[],properties:[],pseudos:[],combinator:a}},h=function(a){return a};d.parse=function(a){var b=a?"plain":"parsed";if(this[b])return this[b];var d=this.text,e=a?h:this.compute,i=[],j=g(null);j.first=!0;var k=function(a){i.push(e(j)),j=g(a)};f.lastIndex=0;for(var l,m;l=f.exec(d);){if(l[11]){if(c.verbose)throw SyntaxError('Syntax error, "'+m+'" unexpected at #'+f.lastIndex+' in "'+d+'"');return this[b]=[]}switch(m=l[0],m.charAt(0)){case".":j.tags.push(m.slice(1).replace(/\\/g,""));break;case"#":j.id=m.slice(1).replace(/\\/g,"");break;case"[":j.properties.push({name:l[2],operator:l[3]||null,value:l[4]||l[5]||l[6]||null});break;case":":j.pseudos.push({name:l[7],value:l[8]||l[9]||l[10]||null});break;case" ":case"	":case"\r":case"\n":case"\f":l[1]=l[1]||" ";default:var n=l[1];if(n){if(","==n){j.last=!0,k(null),j.first=!0;continue}j.first&&!j.ident.length?j.combinator=n:k(n)}else"*"!=m&&(j.nodeName=m)}j.ident.push(m)}return j.last=!0,i.push(e(j)),this[b]=i};var i=function(){return!0},j=function(a,b){return a.hasMixin(IFNode.Identity)?b===a.getId():!1},k=function(a,b){return a.getNodeName().toUpperCase()==b.toUpperCase()},l=function(a){return new RegExp("(?:^|[ \\t\\r\\n\\f])"+a+"(?:$|[ \\t\\r\\n\\f])")},m=function(a,b){if(a.hasMixin(IFNode.Tag)){var c=a.getTags();return c&&b.test(c)}return!1},n=function(a){if(!a.operator||!a.value)return a;var b=r[a.operator];return b&&(a.escaped=c.escapeRegExp(a.value),a.pattern=new RegExp(b(a.value,a.escaped,a))),a},o=function(a,b){var c=a.hasMixin(IFNode.Properties)?a.getProperty(b.name):null;switch(b.operator){case null:return c;case"=":return c==b.value;case"!=":return c!=b.value}return!c&&b.value?!1:b.pattern.test(c)};d.compute=function(b){var d,e,f,g,h,p,r=b.nodeName,s=b.id,t=b.tags;if(s&&(p=!0,h=a(null,j,s),g=function(a){var b=a._scene.getById(s);return!b||r&&!k(b,r)?[]:[b]}),t.length>0)if(g||1!=t.length)for(d=0;e=t[d];d++)f=a(f,m,l(e));else{p=!0;var u=l(t[0]);h=a(h,m,u),g=function(a){for(var b,c=a.getNodesByName(r||"*"),d=[],e=0;b=c[e];e++)m(b,t[0])&&d.push(b);return d}}for(r?g?p||(f=a(f,k,r)):(h=a(h,k,r),g=function(a){return a.getNodesByName(r)}):g||(g=function(a){return a.getNodesByName("*")}),d=0;e=b.pseudos[d];d++)if("not"==e.name){var v=c(e.value);f=a(f,function(a,b){return!b.match(a)},1==v.parse().length?v.parsed[0]:v)}else{var w=q[e.name];w&&(f=a(f,w,e.value))}for(d=0;e=b.properties[d];d++)f=a(f,o,n(e));return(b.simple=!f)?b.matchAux=i:(b.matchAux=f,h=a(h,f)),b.match=h||i,b.combine=c.combinators[b.combinator||" "],b.search=g,b};var p=c.combinators={" ":function(a,b,d,e,f,g){var h=d.search(b);if(g&&d.simple)return c.toArray(h);for(var i,j=0,k=d.matchAux;i=h[j];j++)f(i)&&k(i,e)&&a.push(i);return a},">":function(a,b,c,d,e){for(var f,g=c.search(b),h=0;f=g[h];h++)f.getParent()==b&&e(f)&&c.matchAux(f,d)&&a.push(f);return a},"+":function(a,b,c,d,e){for(;b=b.getNext();){e(b)&&c.match(b,d)&&a.push(b);break}return a},"~":function(a,b,c,d,e){for(;(b=b.getNext())&&e(b);)c.match(b,d)&&a.push(b);return a},"<":function(a,b,c,d,e){for(;(b=b.getParent())&&!(b instanceof IFScene);)e(b)&&c.match(b,d)&&a.push(b);return a},"^":function(a,b,d,e,f){return(b=b.getFirstChild())&&(f(b)&&d.match(b,e)?a.push(b):a=c.combinators["+"](a,b,d,b,e)),a},"++":function(a,b,c,d,e){for(;b=b.getNext();)e(b)&&this.match(b,d)&&a.push(b);return a},"--":function(a,b,c,d,e){for(;b=b.getPrevious();)e(b)&&this.match(b,d)&&a.push(b);return a}},q=c.pseudos={"first-child":function(a){return q.index(a,0)},"last-child":function(a){return null==a.getNext()},"only-child":function(a){return null==a.getPrevious()&&null==a.getNext()},"nth-child":function(a,b,d){var e=c.parseNth(b||"n");if("n"!=e.special)return q[e.special](a,e.a,d);d=d||{},d.positions=d.positions||{};var f=c.getUid(a);if(!d.positions[f]){for(var g=0;a=a.getPrevious();){g++;var h=d.positions[c.getUid(a)];if(void 0!=h){g=h+g;break}}d.positions[f]=g}return d.positions[f]%e.a==e.b},empty:function(){return!1},contains:function(){return!1},index:function(a,b){for(var c=1;a=a.getPrevious();)if(++c>b)return!1;return c==b},even:function(a,b,c){return q["nth-child"](a,"2n+1",c)},odd:function(a,b,c){return q["nth-child"](a,"2n",c)},has:function(a,b){return c.querySingle(b,a)},active:function(a){return a.hasFlag(IFNode.Flag.Active)},selected:function(a){return a.hasFlag(IFNode.Flag.Selected)},hidden:function(a){return a instanceof IFElement&&a.hasFlag(IFElement.Flag.Hidden)},visible:function(a){return a instanceof IFElement&&!a.hasFlag(IFElement.Flag.Hidden)}};q.first=q["first-child"],q.last=q["last-child"],q.nth=q["nth-child"],q.eq=q.index;var r=c.propertyOperators={"*=":function(a,b){return b},"^=":function(a,b){return"^"+b},"$=":function(a){return a+"$"},"~=":function(a,b){return"(?:^|[ \\t\\r\\n\\f])"+b+"(?:$|[ \\t\\r\\n\\f])"},"|=":function(a,b){return"(?:^|\\|)"+b+"(?:$|\\|)"},"/=":function(a){return a}},s=Array.slice||function(a){return Array.prototype.slice.call(a)};try{s(scene.sceneElement.childNodes)}catch(t){s=function(a){if(a instanceof Array)return a;for(var b=a.length,c=new Array(b);b--;)c[b]=a[b];return c}}c.toArray=s;var u=1;c.getUid=window.ActiveXObject?function(a){return(a.__slyUid||(a.__slyUid={id:u++})).id}:function(a){return a.__slyUid||(a.__slyUid=u++)};var v={};c.parseNth=function(a){if(v[a])return v[a];var b=a.match(/^([+-]?\d*)?([a-z]+)?([+-]?\d*)?$/);if(!b)return!1;var c=parseInt(b[1],10),d=(parseInt(b[3],10)||0)-1;if(c=isNaN(c)?1:c){for(;1>d;)d+=c;for(;d>=c;)d-=c}switch(b[2]){case"n":b={a:c,b:d,special:"n"};break;case"odd":b={a:2,b:0,special:"n"};break;case"even":b={a:2,b:1,special:"n"};break;case"first":b={a:0,special:"index"};break;case"last":b={special:"last-child"};break;case"only":b={special:"only-child"};break;default:b={a:c?c-1:d,special:"index"}}return v[a]=b},c.escapeRegExp=function(a){return a.replace(/[-.*+?^${}()|[\]\/\\]/g,"\\$&")},c.generise=function(a){c[a]=function(b){var d=c(b);return d[a].apply(d,Array.prototype.slice.call(arguments,1))}};for(var w=["parse","queryAll","querySingle","match","filter"],x=0;w[x];x++)c.generise(w[x]);return c.recompile(),c}();!function(a){function b(){IFNode.call(this)}var c=null;IFObject.inheritAndMix(b,IFNode,[IFNode.Store,IFNode.Properties]),b.StyleChangeEvent=function(a){this.style=a},IFObject.inherit(b.StyleChangeEvent,GEvent),b.StyleChangeEvent.prototype.style=null,b.StyleChangeEvent.prototype.toString=function(){return"[Event IFStyle.StyleChangeEvent]"},b.HitResult=function(a,b){this.entry=a,this.data=b},b.HitResult.prototype.entry=null,b.HitResult.prototype.data=null,b.prototype.getActualStyle=function(){return this},b.prototype.createPreviewImage=function(a,b){var d=new IFRectangle;d.setProperty("trf",new IFTransform(a/2,0,0,b/2,a/2,b/2));var e=new IFPaintCanvas;e.resize(a,b),e.prepare();var f=new IFPaintContext;f.canvas=e,f.configuration=new IFScenePaintConfiguration,c||(c=IFPaintCanvas.createChessboard(4,"white","rgb(185, 185, 185)")),f.canvas.fillRect(0,0,a,b,f.canvas.createTexture(c));var g=this.getBBox(new IFRect(0,0,a,b)),h=g.getSide(IFRect.Side.CENTER),i=new IFPoint(a/2,b/2),j=1/(g.getWidth()/a),k=1/(g.getHeight()/b),l=(new IFTransform).translated(-h.getX(),-h.getY()).scaled(j,k).translated(i.getX(),i.getY()).getMatrix();return e.setOrigin(new IFPoint(-l[4],-l[5])),e.setScale(j),d.renderStyle(f,this),e.asPNGImage()},b.prototype.getBBox=function(a){for(var b=[0,0,0,0],c=[0,0,0,0],d=[0,0,0,0],e=[0,0,0,0],f=this.getActualStyle().getFirstChild();null!==f;f=f.getNext())if(f instanceof IFStyleEntry&&f.getProperty("vs")===!0){var g=f.getPadding();if(g)if(f instanceof IFVEffectEntry)b=[b[0]+g[0],b[1]+g[1],b[2]+g[2],b[3]+g[3]];else if(f instanceof IFFilterEntry)c=[c[0]+Math.abs(g[0]),c[1]+Math.abs(g[1]),c[2]+Math.abs(g[2]),c[3]+Math.abs(g[3])];else if(f instanceof IFEffectEntry)d=[Math.max(d[0],g[0]),Math.max(d[1],g[1]),Math.max(d[2],g[2]),Math.max(d[3],g[3])];else{if(!(f instanceof IFPaintEntry))throw new Error("Unknown entry with padding.");e=[Math.max(e[0],g[0]),Math.max(e[1],g[1]),Math.max(e[2],g[2]),Math.max(e[3],g[3])]}}return a.expanded(b[0]+e[0]+c[0]+d[0],b[1]+e[1]+c[1]+d[1],b[2]+e[2]+c[2]+d[2],b[3]+e[3]+c[3]+d[3])},b.prototype.createVertexSource=function(a){for(var b=this.getActualStyle().getFirstChild();null!==b;b=b.getNext())b instanceof IFVEffectEntry&&b.getProperty("vs")===!0&&(a=b.createEffect(a));return a},b.prototype.hitTest=function(a,b,c,d){a=this.createVertexSource(a);for(var e=this.getActualStyle().getLastChild();null!==e;e=e.getPrevious())if(e instanceof IFPaintEntry&&e.getProperty("vs")===!0){var f=e.hitTest(a,b,c,d);if(f)return f}return null},b.prototype.prepareGeometryChange=function(){},b.prototype.finishGeometryChange=function(){this._canEventBeSend(b.StyleChangeEvent)&&this._scene.trigger(new b.StyleChangeEvent(this))},b.prototype.visualChange=function(){this._canEventBeSend(b.StyleChangeEvent)&&this._scene.trigger(new b.StyleChangeEvent(this))},b.prototype.validateInsertion=function(){return!1},b.prototype._handleChange=function(a,b){a==IFNode._Change.BeforeChildInsert||a===IFNode._Change.BeforeChildRemove?b instanceof IFStyleEntry&&this.prepareGeometryChange():(a==IFNode._Change.AfterChildInsert||a===IFNode._Change.AfterChildRemove)&&b instanceof IFStyleEntry&&this.finishGeometryChange(),IFNode.prototype._handleChange.call(this,a,b)
},b.prototype._handleGeometryChangeForProperties=function(a,b,c){if((a==IFNode._Change.BeforePropertiesChange||a==IFNode._Change.AfterPropertiesChange)&&ifUtil.containsObjectKey(b.properties,c)){switch(a){case IFNode._Change.BeforePropertiesChange:this.prepareGeometryChange();break;case IFNode._Change.AfterPropertiesChange:this.finishGeometryChange()}return!0}return!1},b.prototype._handleVisualChangeForProperties=function(a,b,c){return a==IFNode._Change.AfterPropertiesChange&&ifUtil.containsObjectKey(b.properties,c)?(this.visualChange(),!0):!1},b.prototype.toString=function(){return"[IFStyle]"},a.IFStyle=b}(this),function(a){function b(){IFStyle.call(this),this._setDefaultProperties(b.MetaProperties)}IFNode.inheritAndMix("sharedStyle",b,IFStyle,[IFNode.Container,IFNode.Reference]),b.MetaProperties={name:null},b.prototype.prepareGeometryChange=function(){var a=this.getScene();a&&a.visitLinks(this,function(a){a instanceof IFStyle&&a.prepareGeometryChange()}),IFStyle.prototype.prepareGeometryChange.call(this)},b.prototype.finishGeometryChange=function(){var a=this.getScene();a&&a.visitLinks(this,function(a){a instanceof IFStyle&&a.finishGeometryChange()}),IFStyle.prototype.finishGeometryChange.call(this)},b.prototype.visualChange=function(){var a=this.getScene();a&&a.visitLinks(this,function(a){a instanceof IFStyle&&a.visualChange()}),IFStyle.prototype.visualChange.call(this)},b.prototype.store=function(a){return IFStyle.prototype.store.call(this,a)?(this.storeProperties(a,b.MetaProperties),!0):!1},b.prototype.restore=function(a){return IFStyle.prototype.restore.call(this,a)?(this.restoreProperties(a,b.MetaProperties),!0):!1},b.prototype.validateInsertion=function(a){return a instanceof IFScene.StyleCollection},b.prototype.toString=function(){return"[IFSharedStyle]"},a.IFSharedStyle=b}(this),function(a){function b(){IFStyle.call(this),this._setDefaultProperties(b.GeometryProperties,b.VisualProperties)}IFObject.inherit(b,IFStyle),b.Type={Content:"C",Knockout:"K",Mask:"M",Background:"B"},b.GeometryProperties={vs:!0},b.VisualProperties={tp:b.Type.Content,blm:IFPaintCanvas.BlendMode.Normal,opc:1},b.prototype.getOwnerElement=function(){for(var a=this.getParent();null!==a;a=a.getParent())if(a instanceof IFElement)return a;return null},b.prototype.prepareGeometryChange=function(){var a=this.getOwnerElement();a&&a._notifyChange(IFElement._Change.PrepareGeometryUpdate),IFStyle.prototype.prepareGeometryChange.call(this)},b.prototype.finishGeometryChange=function(){var a=this.getOwnerElement();a&&a._notifyChange(IFElement._Change.FinishGeometryUpdate),IFStyle.prototype.finishGeometryChange.call(this)},b.prototype.visualChange=function(){var a=this.getOwnerElement();a&&a._notifyChange(IFElement._Change.InvalidationRequest),IFStyle.prototype.visualChange.call(this)},b.prototype.store=function(a){return IFStyle.prototype.store.call(this,a)?(this.storeProperties(a,b.GeometryProperties),this.storeProperties(a,b.VisualProperties),!0):!1},b.prototype.restore=function(a){return IFStyle.prototype.restore.call(this,a)?(this.restoreProperties(a,b.GeometryProperties),this.restoreProperties(a,b.VisualProperties),!0):!1},b.prototype.validateInsertion=function(a){return a instanceof IFStyleSet},b.prototype._handleChange=function(a,c){this._handleGeometryChangeForProperties(a,c,b.GeometryProperties),this._handleVisualChangeForProperties(a,c,b.VisualProperties),IFStyle.prototype._handleChange.call(this,a,c)},b.prototype.toString=function(){return"[IFAppliedStyle]"},a.IFAppliedStyle=b}(this),function(a){function b(){IFAppliedStyle.call(this)}IFNode.inheritAndMix("style",b,IFAppliedStyle,[IFNode.Container]),b.prototype.toString=function(){return"[IFInlineStyle]"},a.IFInlineStyle=b}(this),function(a){function b(){IFAppliedStyle.call(this),this._setDefaultProperties(b.GeometryProperties)}IFNode.inherit("lnStyle",b,IFAppliedStyle),b.GeometryProperties={ref:null},b.prototype.getActualStyle=function(){return this.$ref&&this.isAttached()?this.getScene().getReference(this.$ref):null},b.prototype.store=function(a){return IFAppliedStyle.prototype.store.call(this,a)?(this.storeProperties(a,b.GeometryProperties),!0):!1},b.prototype.restore=function(a){return IFAppliedStyle.prototype.restore.call(this,a)?(this.restoreProperties(a,b.GeometryProperties),!0):!1},b.prototype._handleChange=function(a,c){if(this._handleGeometryChangeForProperties(a,c,b.GeometryProperties)&&c.properties.indexOf("ref")>=0){var d=this.getActualStyle();if(d)switch(a){case IFNode._Change.BeforePropertiesChange:this.getScene().unlink(d,this);break;case IFNode._Change.AfterPropertiesChange:this.getScene().link(d,this)}}IFAppliedStyle.prototype._handleChange.call(this,a,c)},b.prototype._setScene=function(a){if(a!==this._scene)if(a){var b=a.getReference(this.$ref);b&&a.link(b,this)}else{var b=this._scene.getReference(this.$ref);b&&this._scene.unlink(b,this)}IFAppliedStyle.prototype._setScene.call(this,a)},b.prototype.toString=function(){return"[IFLinkedStyle]"},a.IFLinkedStyle=b}(this),function(a){function b(){IFNode.call(this)}IFObject.inheritAndMix(b,IFNode,[IFNode.Container,IFNode.Store]),b.prototype.getBBox=function(a){for(var b=a,c=this.getFirstChild();null!=c;c=c.getNext())if(c instanceof IFStyle&&c.getProperty("vs")===!0){var d=c.getBBox(a);d&&!d.isEmpty()&&(b=b.united(d))}return b},b.prototype.hitTest=function(a,b,c,d){for(var e=this.getLastChild();null!==e;e=e.getPrevious())if(e instanceof IFStyle&&e.getProperty("vs")===!0){var f=e.hitTest(a,b,c,d);if(f)return f}return null},b.prototype._handleChange=function(a,b){var c=this.getParent();c&&(a==IFNode._Change.BeforeChildInsert||a===IFNode._Change.BeforeChildRemove?b instanceof IFStyle&&c._notifyChange(IFElement._Change.PrepareGeometryUpdate):(a==IFNode._Change.AfterChildInsert||a===IFNode._Change.AfterChildRemove)&&b instanceof IFStyle&&c._notifyChange(IFElement._Change.FinishGeometryUpdate)),IFNode.prototype._handleChange.call(this,a,b)},b.prototype.toString=function(){return"[IFStyleSet]"},a.IFStyleSet=b}(this),function(a){function b(){IFNode.call(this),this._setDefaultProperties(b.GeometryProperties)}IFObject.inheritAndMix(b,IFNode,[IFNode.Store,IFNode.Properties]),b.GeometryProperties={vs:!0},b.prototype.store=function(a){return IFNode.Store.prototype.store.call(this,a)?(this.storeProperties(a,b.GeometryProperties),!0):!1},b.prototype.restore=function(a){return IFNode.Store.prototype.restore.call(this,a)?(this.restoreProperties(a,b.GeometryProperties),!0):!1},b.prototype.getPadding=function(){return null},b.prototype.validateInsertion=function(a){return a instanceof IFStyle},b.prototype._handleChange=function(a,c){this._handleGeometryChangeForProperties(a,c,b.GeometryProperties),IFNode.prototype._handleChange.call(this,a,c)},b.prototype._handleGeometryChangeForProperties=function(a,b,c){if(a==IFNode._Change.BeforePropertiesChange||a==IFNode._Change.AfterPropertiesChange){var d=this.getOwnerStyle();if(d&&ifUtil.containsObjectKey(b.properties,c)){switch(a){case IFNode._Change.BeforePropertiesChange:d.prepareGeometryChange();break;case IFNode._Change.AfterPropertiesChange:d.finishGeometryChange()}return!0}return!1}return!1},b.prototype._handleVisualChangeForProperties=function(a,b,c){if(a==IFNode._Change.AfterPropertiesChange){var d=this.getOwnerStyle();return d&&ifUtil.containsObjectKey(b.properties,c)?(d.visualChange(),!0):!1}return!1},b.prototype.getOwnerStyle=function(){var a=this.getParent();return a&&a instanceof IFStyle?a:null},b.prototype.toString=function(){return"[IFStyleEntry]"},a.IFStyleEntry=b}(this),function(a){function b(){IFStyleEntry.call(this)}IFObject.inherit(b,IFStyleEntry),b.prototype.apply=function(){throw new Error("Not Supported")},b.prototype.toString=function(){return"[IFFilterEntry]"},a.IFFilterEntry=b}(this),function(a){function b(){IFStyleEntry.call(this)}IFObject.inherit(b,IFStyleEntry),b.prototype.isPost=function(){throw new Error("Not Supported")},b.prototype.render=function(){throw new Error("Not Supported")},b.prototype.toString=function(){return"[IFEffectEntry]"},a.IFEffectEntry=b}(this),function(a){function b(){IFStyleEntry.call(this)}IFObject.inherit(b,IFStyleEntry),b.prototype.isSeparate=function(){return!1},b.prototype.getPaintCmpOrBlend=function(){return null},b.prototype.getPaintOpacity=function(){return null},b.prototype.hitTest=function(){return null},b.prototype.paint=function(){throw new Error("Not Supported")},b.prototype.toString=function(){return"[IFPaintEntry]"},a.IFPaintEntry=b}(this),function(a){function b(){IFStyleEntry.call(this)}IFObject.inherit(b,IFStyleEntry),b.prototype.createEffect=function(){throw new Error("Not Supported")},b.prototype.toString=function(){return"[IFVEffectEntry]"},a.IFVEffectEntry=b}(this),function(a){function b(){IFEffectEntry.call(this),this._setDefaultProperties(b.GeometryProperties,b.VisualProperties)}IFNode.inherit("shadowEffect",b,IFEffectEntry),b.GeometryProperties={"in":!1,r:5,x:0,y:0},b.VisualProperties={cls:IFColor.parseCSSColor("rgba(0,0,0,0.5)")},b.prototype.getPadding=function(){return[this.$r-this.$x,this.$r-this.$y,this.$r+this.$x,this.$r+this.$y]},b.prototype.isPost=function(){return this.$in?!0:!1},b.prototype.render=function(a,b,c){a.fillCanvas(this.$cls);var d=this.$x*c,e=this.$y*c,f=this.$r*c;this.$in?(a.drawCanvas(b,d,e,1,IFPaintCanvas.CompositeOperator.DestinationOut),a.blur(f),a.drawCanvas(b,0,0,1,IFPaintCanvas.CompositeOperator.DestinationIn)):(a.drawCanvas(b,d,e,1,IFPaintCanvas.CompositeOperator.DestinationIn),a.blur(f))},b.prototype.store=function(a){return IFEffectEntry.prototype.store.call(this,a)?(this.storeProperties(a,b.GeometryProperties),this.storeProperties(a,b.VisualProperties,function(a,b){return b&&"cls"===a?b.asString():b}),!0):!1},b.prototype.restore=function(a){return IFEffectEntry.prototype.restore.call(this,a)?(this.restoreProperties(a,b.GeometryProperties),this.restoreProperties(a,b.VisualProperties,function(a,b){return b&&"cls"===a?IFColor.parseColor(b):void 0}),!0):!1},b.prototype._handleChange=function(a,c){this._handleGeometryChangeForProperties(a,c,b.GeometryProperties),this._handleVisualChangeForProperties(a,c,b.VisualProperties),IFEffectEntry.prototype._handleChange.call(this,a,c)},b.prototype.toString=function(){return"[IFShadowEffect]"},a.IFShadowEffect=b}(this),function(a){function b(){IFFilterEntry.call(this),this._setDefaultProperties(b.GeometryProperties)}IFNode.inherit("blurFilter",b,IFFilterEntry),b.GeometryProperties={r:5},b.prototype.getPadding=function(){return[this.$r,this.$r,this.$r,this.$r]},b.prototype.apply=function(a,b){a.blur(this.$r*b)},b.prototype.store=function(a){return IFFilterEntry.prototype.store.call(this,a)?(this.storeProperties(a,b.GeometryProperties),!0):!1},b.prototype.restore=function(a){return IFFilterEntry.prototype.restore.call(this,a)?(this.restoreProperties(a,b.GeometryProperties),!0):!1},b.prototype._handleChange=function(a,c){this._handleGeometryChangeForProperties(a,c,b.GeometryProperties),IFFilterEntry.prototype._handleChange.call(this,a,c)},b.prototype.toString=function(){return"[IFBlurFilter]"},a.IFBlurFilter=b}(this),function(a){function b(){IFPaintEntry.call(this),this._setDefaultProperties(b.VisualProperties)}IFObject.inherit(b,IFPaintEntry),b.VisualProperties={pat:IFColor.BLACK,blm:IFPaintCanvas.BlendMode.Normal,opc:1},b.prototype.getPaintCmpOrBlend=function(){return this.$blm},b.prototype.getPaintOpacity=function(){return this.$opc},b.prototype.store=function(a){return IFPaintEntry.prototype.store.call(this,a)?(this.storeProperties(a,b.VisualProperties,function(a,b){return b&&"pat"===a?IFPattern.asString(b):b}),!0):!1},b.prototype.restore=function(a){return IFPaintEntry.prototype.restore.call(this,a)?(this.restoreProperties(a,b.VisualProperties,function(a,b){return b&&"pat"===a?IFPattern.parsePattern(b):b}),!0):!1},b.prototype._handleChange=function(a,c){this._handleVisualChangeForProperties(a,c,b.VisualProperties),IFPaintEntry.prototype._handleChange.call(this,a,c)},b.prototype.toString=function(){return"[IFPatternPaint]"},a.IFPatternPaint=b}(this),function(a){function b(){IFPatternPaint.call(this),this._setDefaultProperties(b.VisualProperties)}IFObject.inherit(b,IFPatternPaint),b.VisualProperties={tx:0,ty:0,sx:1,sy:1,rt:0},b.prototype.store=function(a){return IFPatternPaint.prototype.store.call(this,a)?(this.storeProperties(a,b.VisualProperties),!0):!1},b.prototype.restore=function(a){return IFPatternPaint.prototype.restore.call(this,a)?(this.restoreProperties(a,b.VisualProperties),!0):!1},b.prototype._handleChange=function(a,c){this._handleVisualChangeForProperties(a,c,b.VisualProperties),IFPatternPaint.prototype._handleChange.call(this,a,c)},b.prototype._createPaintPattern=function(a){if(this.$pat){if(this.$pat instanceof IFColor)return this.$pat;if(this.$pat instanceof IFGradient){if(this.$pat.getType()===IFGradient.Type.Linear)return a.createLinearGradient(-.5,0,.5,0,this.$pat);if(this.$pat.getType()===IFGradient.Type.Radial)return a.createRadialGradient(0,0,.5,this.$pat)}}return null},b.prototype._getPaintPatternTransform=function(a){if(this.$pat&&this.$pat instanceof IFGradient){var b=a.getX(),c=a.getY(),d=a.getWidth(),e=a.getHeight();return(new IFTransform).scaled(this.$sx,this.$sy).rotated(this.$rt).translated(this.$tx,this.$ty).scaled(d,e).translated(b,c)}return null},b.prototype.toString=function(){return"[IFAreaPaint]"},a.IFAreaPaint=b}(this),function(a){function b(){IFAreaPaint.call(this)}IFNode.inherit("fillPaint",b,IFAreaPaint),b.prototype.hitTest=function(a,b,c,d){var e=new IFVertexInfo.HitResult;return ifVertexInfo.hitTest(b.getX(),b.getY(),new IFVertexTransformer(a,c),d,!0,e)?new IFStyle.HitResult(this,e):null},b.prototype.paint=function(a,b){var c=this._createPaintPattern(a);if(c){var d=this._getPaintPatternTransform(b);if(d){var e=a.setTransform(a.getTransform(!0).preMultiplied(d));a.fillVertices(c,this.$opc,this.$blm),a.setTransform(e)}else a.fillVertices(c,this.$opc,this.$blm)}},b.prototype.toString=function(){return"[IFFillPaint]"},a.IFFillPaint=b}(this),function(a){function b(){IFAreaPaint.call(this),this._setDefaultProperties(b.GeometryProperties)}IFNode.inherit("strokePaint",b,IFAreaPaint),b.Alignment={Center:"C",Outside:"O",Inside:"I"},b.GeometryProperties={sw:1,sa:b.Alignment.Center,slc:IFPaintCanvas.LineCap.Square,slj:IFPaintCanvas.LineJoin.Miter,slm:10},b.prototype.isSeparate=function(){return IFAreaPaint.prototype.isSeparate.call(this)===!1?this.$sa!==b.Alignment.Center?!0:1!==this.$sx||1!==this.$sy:!1},b.prototype.hitTest=function(a,b,c,d){var e=this.$sw*c.getScaleFactor()+2*d,f=new IFVertexInfo.HitResult;return ifVertexInfo.hitTest(b.getX(),b.getY(),new IFVertexTransformer(a,c),e,!1,f)?new IFStyle.HitResult(this,f):null},b.prototype.getPadding=function(){if(this.$sa===b.Alignment.Center){var a=this.$sw/2;return[a,a,a,a]}return this.$sa===b.Alignment.Outside?[this.$sw,this.$sw,this.$sw,this.$sw]:null},b.prototype.paint=function(a,c){var d=c,e=this.getPadding();e&&(d=d.expanded(e[0],e[1],e[2],e[3]));var f=this._createPaintPattern(a);if(f){var g=this._getPaintPatternTransform(d),h=this.$sw;if(this.$sa!==b.Alignment.Center&&(h*=2),g){var i=this.$blm,j=this.$opc;if(this.isSeparate()&&(i=IFPaintCanvas.BlendMode.Normal,j=1),1!==this.$sx||1!==this.$sy){var k=a.setTransform(a.getTransform(!0).multiplied(g)),l=g.inverted().mapRect(c);a.fillRect(l.getX(),l.getY(),l.getWidth(),l.getHeight(),f),a.setTransform(k),a.strokeVertices(f,h,this.$slc,this.$slj,this.$slm,1,IFPaintCanvas.CompositeOperator.DestinationIn)}else{var k=a.setTransform(a.getTransform(!0).multiplied(g));a.strokeVertices(f,h/g.getScaleFactor(),this.$slc,this.$slj,this.$slm,j,i),a.setTransform(k)}}else a.strokeVertices(f,h,this.$slc,this.$slj,this.$slm,this.$opc,this.$blm);this.$sa===b.Alignment.Inside?a.fillVertices(IFColor.BLACK,1,IFPaintCanvas.CompositeOperator.DestinationIn):this.$sa===b.Alignment.Outside&&a.fillVertices(IFColor.BLACK,1,IFPaintCanvas.CompositeOperator.DestinationOut)}},b.prototype.store=function(a){return IFAreaPaint.prototype.store.call(this,a)?(this.storeProperties(a,b.GeometryProperties),!0):!1},b.prototype.restore=function(a){return IFAreaPaint.prototype.restore.call(this,a)?(this.restoreProperties(a,b.GeometryProperties),!0):!1},b.prototype._handleChange=function(a,c){this._handleGeometryChangeForProperties(a,c,b.GeometryProperties),IFAreaPaint.prototype._handleChange.call(this,a,c)},b.prototype.toString=function(){return"[IFStrokePaint]"},a.IFStrokePaint=b}(this),function(a){function b(){IFVEffectEntry.call(this),this._setDefaultProperties(b.GeometryProperties)}IFNode.inheritAndMix("offsetVEffect",b,IFVEffectEntry),b.OffsetType={Inset:"i",Outset:" o",Both:"b"},b.GeometryProperties={tp:b.OffsetType.Outset,r:5},b.prototype.getPadding=function(){if(this.$r>0){var a=this.$r;return[a,a,a,a]}return null},b.prototype.createEffect=function(a){return this.$r>0?new IFVertexOffsetter(a,this.$r,this.$tp===b.OffsetType.Inset||this.$tp===b.OffsetType.Both,this.$tp===b.OffsetType.Outset||this.$tp===b.OffsetType.Both):a},b.prototype.store=function(a){return IFVEffectEntry.prototype.store.call(this,a)?(this.storeProperties(a,b.GeometryProperties),!0):!1},b.prototype.restore=function(a){return IFVEffectEntry.prototype.restore.call(this,a)?(this.restoreProperties(a,b.GeometryProperties),!0):!1},b.prototype._handleChange=function(a,c){this._handleGeometryChangeForProperties(a,c,b.GeometryProperties),IFVEffectEntry.prototype._handleChange.call(this,a,c)},b.prototype.toString=function(){return"[IFOffsetVEffect]"},a.IFOffsetVEffect=b}(this),function(a){function b(){IFBlock.call(this),this._setDefaultProperties(b.GeometryProperties,b.VisualProperties)}IFNode.inheritAndMix("page",b,IFBlock,[IFNode.Container,IFNode.Reference]),b.GeometryProperties={msref:null,x:0,y:0,w:0,h:0,bl:0,ml:0,mt:0,mr:0,mb:0},b.VisualProperties={cls:null},b.prototype.isMaster=function(){return this.isAttached()?this.getScene().hasLinks(this):!1},b.prototype.getMasterPage=function(){var a=this.$msref&&this.isAttached()?this.getScene().getReference(this.$msref):null;return a===this?null:a},b.prototype.getPageClipBBox=function(){var a=this.getGeometryBBox();if(a&&!a.isEmpty()){var b=this.$bl||0;return a.expanded(b,b,b,b)}return a},b.prototype.store=function(a){return IFBlock.prototype.store.call(this,a)?(this.storeProperties(a,b.GeometryProperties),this.storeProperties(a,b.VisualProperties,function(a,b){return"cls"===a&&b?b.asString():b}),this.hasFlag(IFNode.Flag.Active)&&(a.__active=!0),!0):!1},b.prototype.restore=function(a){return IFBlock.prototype.restore.call(this,a)?(this.restoreProperties(a,b.GeometryProperties),this.restoreProperties(a,b.VisualProperties,function(a,b){return"cls"===a&&b?IFColor.parseColor(b):b}),a.__active&&this.setFlag(IFNode.Flag.Active),!0):!1},b.prototype._paint=function(a){for(var b=this.getMasterPage(),c=!1,d=!1,e=this.getFirstChild();null!==e;e=e.getNext())if(e instanceof IFElement){d=!0;break}var f=a.canvas.resetTransform(),g=new IFRect(this.$x,this.$y,this.$w,this.$h),h=f.mapRect(g).toAlignedRect(),i=h.getX(),j=h.getY(),k=h.getWidth(),l=h.getHeight();if(d&&b||a.configuration.paintMode===IFScenePaintConfiguration.PaintMode.Output){var m=this.$bl||0;a.canvas.clipRect(i-m,j-m,k+2*m,l+2*m),c=!0}if(a.canvas.setTransform(f),b){var f=a.canvas.getTransform(!0),n=b.getProperty("x"),o=b.getProperty("y"),p=this.$x-n,q=this.$y-o,r=new IFTransform(1,0,0,1,p,q);a.canvas.setTransform(f.preMultiplied(r)),a.dirtyMatcher.transform(new IFTransform(1,0,0,1,-p,-q)),b.render(a),a.dirtyMatcher.transform(r),a.canvas.setTransform(f)}d&&this._renderChildren(a),c&&a.canvas.resetClip()},b.prototype.validateInsertion=function(a){return a instanceof IFScene},b.prototype._calculateGeometryBBox=function(){return new IFRect(this.$x,this.$y,this.$w,this.$h)},b.prototype._calculatePaintBBox=function(){var a=this.getGeometryBBox();this.$bl&&this.$bl>0&&(a=a.expanded(this.$bl,this.$bl,this.$bl,this.$bl));var b=IFBlock.prototype._calculatePaintBBox.call(this);return b?b.united(a):a},b.prototype._detailHitTest=function(a,b,c,d){var e=this.getGeometryBBox();return b&&(e=b.mapRect(e)),e.expanded(c,c,c,c).containsPoint(a)?new IFBlock.HitResult(this):IFBlock.prototype._detailHitTest.call(this,a,b,c,d)},b.prototype._handleChange=function(a,c){if(this._handleGeometryChangeForProperties(a,c,b.GeometryProperties)){if(a===IFNode._Change.BeforePropertiesChange){var d=c.properties.indexOf("x"),e=c.properties.indexOf("y");if(d>=0||e>=0){var f=d>=0?c.values[d]-this.$x:0,g=e>=0?c.values[e]-this.$y:0;if(0!==f||0!==g)for(var h=new IFTransform(1,0,0,1,f,g),i=this.getFirstChild(!0);null!=i;i=i.getNext(!0))i instanceof IFElement&&i.hasMixin(IFElement.Transform)&&i.transform(h)}}if(c.properties.indexOf("msref")>=0){var j=this.getMasterPage();if(j)switch(a){case IFNode._Change.BeforePropertiesChange:this.getScene().unlink(j,this);break;case IFNode._Change.AfterPropertiesChange:this.getScene().link(j,this)}}}if(this._handleVisualChangeForProperties(a,c,b.VisualProperties),a===IFElement._Change.InvalidationRequested){var k=c;if(k&&!k.isEmpty()&&this.isMaster()&&this.getScene().getProperty("singlePage")===!1){var l=this.getPageClipBBox();l&&!l.isEmpty()&&l.intersectsRect(k)&&this.getScene().visitLinks(this,function(a){if(a instanceof b&&a.isRenderable()){var c=a.getProperty("x")-this.$x,d=a.getProperty("y")-this.$y;a._requestInvalidationArea(k.translated(c,d))}}.bind(this))}}IFBlock.prototype._handleChange.call(this,a,c)},b.prototype._setScene=function(a){if(a!==this._scene)if(a){var b=a.getReference(this.$msref);b&&a.link(b,this)}else{var b=this._scene.getReference(this.$msref);b&&this._scene.unlink(b,this)}IFBlock.prototype._setScene.call(this,a)},a.IFPage=b}(this),function(a){function b(){IFBlock.call(this),this._setDefaultProperties(b.VisualProperties,b.MetaProperties)}IFNode.inheritAndMix("layer",b,IFBlock,[IFNode.Container,IFElement.Transform]),b.GUIDE_COLOR_DEFAULT=new IFColor(IFColor.Type.RGB,[0,255,255,100]),b.Type={Output:"O",Draft:"D",Guide:"G"},b.TypeName={O:new IFLocale.Key(b,"type.output"),D:new IFLocale.Key(b,"type.draft"),G:new IFLocale.Key(b,"type.guide")},b.MetaProperties={tp:b.Type.Output},b.VisualProperties={otl:!1,cls:new IFColor(IFColor.Type.RGB,[0,168,255,100])},b.prototype.store=function(a){return IFBlock.prototype.store.call(this,a)?(this.storeProperties(a,b.VisualProperties,function(a,b){return"cls"===a&&b?b.asString():b}),this.storeProperties(a,b.MetaProperties),this.hasFlag(IFNode.Flag.Active)&&(a.__active=!0),!0):!1},b.prototype.restore=function(a){return IFBlock.prototype.restore.call(this,a)?(this.restoreProperties(a,b.VisualProperties,function(a,b){return"cls"===a&&b?IFColor.parseColor(b):b}),this.restoreProperties(a,b.MetaProperties),a.__active&&this.setFlag(IFNode.Flag.Active),!0):!1},b.prototype.validateInsertion=function(a){return a instanceof b||a instanceof IFPage},b.prototype._preparePaint=function(a){if(IFBlock.prototype._preparePaint.call(this,a)){if(this.$tp===b.Type.Guide){if(!a.configuration.isGuidesVisible(a))return!1;a.configuration.paintMode===IFScenePaintConfiguration.PaintMode.Outline||this.$otl||a.outlineColors.push(this.$cls)}else if(this.$tp===b.Type.Draft&&!a.configuration.isAnnotationsVisible(a))return!1;return a.configuration.paintMode!==IFScenePaintConfiguration.PaintMode.Outline&&this.$otl&&a.outlineColors.push(this.$cls),!0}return!1},b.prototype._finishPaint=function(a){this.$tp!==b.Type.Guide||a.configuration.paintMode===IFScenePaintConfiguration.PaintMode.Outline||this.$otl?this.$tp===b.Type.Draft:a.outlineColors.pop(),a.configuration.paintMode!==IFScenePaintConfiguration.PaintMode.Outline&&this.$otl&&a.outlineColors.pop(),IFBlock.prototype._finishPaint.call(this,a)},b.prototype._detailHitTest=function(){return new IFBlock.HitResult(this)},b.prototype._handleChange=function(a,c){if(this._handleVisualChangeForProperties(a,c,b.VisualProperties),a==IFNode._Change.AfterPropertiesChange){var d=c.properties.indexOf("tp");if(d>=0){var e=c.values[d];e===b.Type.Guide&&this.$cls===b.GUIDE_COLOR_DEFAULT?this.$cls=b.VisualProperties.cls:this.$tp===b.Type.Guide&&this.$cls===b.VisualProperties.cls&&(this.$cls=b.GUIDE_COLOR_DEFAULT),this._notifyChange(IFElement._Change.InvalidationRequest)}}IFBlock.prototype._handleChange.call(this,a,c)},a.IFLayer=b}(this),function(a){function b(){IFItem.call(this),this._setDefaultProperties(b.VisualProperties,b.GeometryProperties,b.MetaProperties)}IFNode.inheritAndMix("slice",b,IFItem,[IFElement.Transform]),b.MetaProperties={},b.GeometryProperties={trf:null},b.VisualProperties={cls:new IFColor(IFColor.Type.RGB,[0,116,217,100])},b.prototype.getTransform=function(){return this.$trf},b.prototype.setTransform=function(a){this.setProperty("trf",a)},b.prototype.transform=function(a){a&&!a.isIdentity()&&this.setProperty("trf",this.$trf?this.$trf.multiplied(a):a),IFElement.Transform.prototype._transformChildren.call(this,a)},b.prototype.store=function(a){return IFItem.prototype.store.call(this,a)?(this.storeProperties(a,b.VisualProperties,function(a,b){return"cls"===a&&b?b.asString():b}),this.storeProperties(a,b.GeometryProperties,function(a,b){return"trf"===a&&b?IFTransform.serialize(b):b}),this.storeProperties(a,b.MetaProperties),!0):!1},b.prototype.restore=function(a){return IFItem.prototype.restore.call(this,a)?(this.restoreProperties(a,b.VisualProperties,function(a,b){return"cls"===a&&b?IFColor.parseColor(b):b}),this.restoreProperties(a,b.GeometryProperties,function(a,b){return"trf"===a&&b?IFTransform.deserialize(b):b}),this.restoreProperties(a,b.MetaProperties),!0):!1},b.prototype.validateInsertion=function(a){return a instanceof IFLayer},b.prototype._paint=function(a){if(a.configuration.isSlicesVisible(a)){var b=new IFRect(-1,-1,1,1);if(a.configuration.isOutline(a)){var c=a.canvas.resetTransform(),d=c.mapRect(b);a.canvas.strokeRect(d.getX(),d.getY(),d.getWidth(),d.getHeight(),1,a.getOutlineColor()),a.canvas.setTransform(c)}else{var d=this.$trf?this.$trf.mapRect(b):b;a.canvas.fillRect(d.getX(),d.getY(),d.getWidth(),d.getHeight(),this.$cls,.5)}}},b.prototype._calculateGeometryBBox=function(){var a=new IFRect(-1,-1,1,1);return this.$trf?this.$trf.mapRect(a):a},b.prototype._calculatePaintBBox=function(){return this.getGeometryBBox()},b.prototype._handleChange=function(a,c){this._handleGeometryChangeForProperties(a,c,b.GeometryProperties),this._handleVisualChangeForProperties(a,c,b.VisualProperties),IFItem.prototype._handleChange.call(this,a,c)},b.prototype._detailHitTest=function(){return new IFItem.HitResult(this)},a.IFSlice=b}(this),function(a){function b(){IFNode.call(this),this._setDefaultProperties(b.VisualProperties,b.MetaProperties)}IFNode.inheritAndMix("swatch",b,IFNode,[IFNode.Store,IFNode.Properties]),b.VisualProperties={pat:null},b.MetaProperties={name:null},b.prototype.getPatternType=function(){return this.$pat?this.$pat.getPatternType():null},b.prototype.store=function(a){return IFNode.Store.prototype.store.call(this,a)?(this.storeProperties(a,b.VisualProperties,function(a,b){return b&&"pat"===a?IFPattern.asString(b):b}),this.storeProperties(a,b.MetaProperties),!0):!1},b.prototype.restore=function(a){return IFNode.Store.prototype.restore.call(this,a)?(this.restoreProperties(a,b.VisualProperties,function(a,b){return b&&"pat"===a?IFPattern.parsePattern(b):void 0}),this.restoreProperties(a,b.MetaProperties),!0):!1},b.prototype.validateInsertion=function(a){return a instanceof IFScene.SwatchCollection},a.IFSwatch=b}(this),function(a){function b(){IFItem.call(this),this._setDefaultProperties(b.GeometryProperties)}IFObject.inheritAndMix(b,IFItem,[IFNode.Container,IFElement.Transform,IFElement.Style,IFVertexSource]),b.GeometryProperties={trf:null},b._StyleSet=function(){this._flags|=IFNode.Flag.Shadow},IFNode.inherit("shpStylSet",b._StyleSet,IFStyleSet),b._StyleSet.prototype.validateInsertion=function(a){return a instanceof b},b.prototype.getStyleSet=function(){var a=IFElement.Style.prototype.getStyleSet.call(this);return a||(a=new b._StyleSet,this.appendChild(a)),a},b.prototype.getTransform=function(){return this.$trf},b.prototype.setTransform=function(a){this.setProperty("trf",a)},b.prototype.transform=function(a){a&&!a.isIdentity()&&this.setProperty("trf",this.$trf?this.$trf.multiplied(a):a),IFElement.Transform.prototype._transformChildren.call(this,a)},b.prototype.validateInsertion=function(a){return a instanceof IFLayer||a instanceof IFShapeSet||a instanceof b},b.prototype.store=function(a){return IFItem.prototype.store.call(this,a)?(this.storeProperties(a,b.GeometryProperties,function(a,b){return"trf"===a&&b?IFTransform.serialize(b):b}),!0):!1},b.prototype.restore=function(a){return IFItem.prototype.restore.call(this,a)?(this.restoreProperties(a,b.GeometryProperties,function(a,b){return"trf"===a&&b?IFTransform.deserialize(b):b}),!0):!1},b.prototype._paint=function(a,b,c){if(this.rewindVertices(0)){if(this._paintBackground(a,b,c),a.configuration.isOutline(a)){var d=a.canvas.resetTransform(),e=new IFVertexTransformer(b?b.createVertexSource(this):this,d);a.canvas.putVertices(e),a.canvas.strokeVertices(a.getOutlineColor()),a.canvas.setTransform(d),this._paintContents(a,b,c)}else b&&this._paintStyle(a,b,c);this._paintForeground(a,b,c)}},b.prototype._paintBackground=function(){},b.prototype._paintForeground=function(){},b.prototype._paintStyle=function(a,b){for(var c=null,d=b.getActualStyle().getFirstChild();null!==d;d=d.getNext())d instanceof IFPaintEntry&&d.getProperty("vs")===!0&&(c||(c=[]),c.push(d));if(c){var e=b.createVertexSource(this);a.canvas.putVertices(e);for(var f=b.getBBox(this.getGeometryBBox()),g=0;g<c.length;++g){var h=c[g];if(h.isSeparate()){var i=a.canvas.createCanvas(f);i.putVertices(e),h.paint(i,f),a.canvas.drawCanvas(i,0,0,h.getPaintOpacity(),h.getPaintCmpOrBlend())}else h.paint(a.canvas,f)}}},b.prototype._paintContents=function(a){for(var b=null,c=this.getFirstChild();null!==c;c=c.getNext())c instanceof IFElement&&(b||(b=a.canvas,a.canvas=b.createCanvas(this.getGeometryBBox())),c.render(a));b&&(a.canvas.putVertices(this),a.canvas.fillVertices(IFColor.BLACK,1,IFPaintCanvas.CompositeOperator.DestinationIn),b.drawCanvas(a.canvas),a.canvas.finish(),a.canvas=b)},b.prototype.renderStyle=function(a,b,c){IFElement.Style.prototype.renderStyle.call(this,a,b,c),0===c&&this._paintContents(a)},b.prototype._calculateGeometryBBox=function(){return ifVertexInfo.calculateBounds(this,!0)},b.prototype._calculatePaintBBox=function(){var a=this.getGeometryBBox();return a?this.getStyleSet().getBBox(a):null},b.prototype._handleChange=function(a,c){this._handleGeometryChangeForProperties(a,c,b.GeometryProperties),IFItem.prototype._handleChange.call(this,a,c)},b.prototype._detailHitTest=function(a,b,c,d){var e=this.getStyleSet().hitTest(this,a,b,c);if(e)return new IFElement.HitResult(this,e);if(d){var f=new IFVertexInfo.HitResult;if(ifVertexInfo.hitTest(a.getX(),a.getY(),new IFVertexTransformer(this,b),c,!0,f))return new IFElement.HitResult(this,f)}else if(c){var f=new IFVertexInfo.HitResult;if(ifVertexInfo.hitTest(a.getX(),a.getY(),new IFVertexTransformer(this,b),c,!1,f))return new IFElement.HitResult(this,f)}return null},b.prototype.getCenter=function(a){var b=new IFPoint(0,0);return a&&this.$trf&&(b=this.$trf.mapPoint(b)),b},b.prototype.getOrigHalfWidth=function(){return 1},b.prototype.getOrigHalfHeight=function(){return 1},b.prototype.toString=function(){return"[IFShape]"},a.IFShape=b}(this),function(a){function b(){IFItem.call(this)}IFNode.inheritAndMix("shapeSet",b,IFItem,[IFNode.Container,IFElement.Transform]),b.prototype.validateInsertion=function(a){return a instanceof IFLayer||a instanceof b},b.prototype._detailHitTest=function(){return new IFBlock.HitResult(this)},a.IFShapeSet=b}(this),function(a){function b(){IFShape.call(this),this._setDefaultProperties(b.VisualProperties),this._anchorPoints=new b.AnchorPoints,this.appendChild(this._anchorPoints),this._vertices=new IFVertexContainer,this._verticesDirty=!0}IFObject.inherit(b,IFShape),b.CornerType={Rounded:"R",InverseRounded:"U",Bevel:"B",Inset:"I",Fancy:"F"},b.isCornerType=function(a){for(var c in b.CornerType)if(b[c]===a)return!0;
return!1},b.VisualProperties={evenodd:!1},b.AnchorPoint=function(){this._setDefaultProperties(b.AnchorPoint.GeometryProperties),this._leadHr=!1},IFObject.inheritAndMix(b.AnchorPoint,IFNode,[IFNode.Properties]),b.AnchorPoint.Type={Asymmetric:"TA",Symmetric:"TS",Mirror:"TM",Connector:"TC"},b.AnchorPoint.GeometryProperties={tp:b.AnchorPoint.Type.Asymmetric,x:0,y:0,hlx:null,hly:null,hrx:null,hry:null,ah:!1,cu:!0,cl:0,cr:0},b.AnchorPoint.HANDLE_COEFF=.4,b.AnchorPoint.prototype.validateInsertion=function(a){return a instanceof b.AnchorPoints},b.AnchorPoint.prototype.serialize=function(){var a=[];return null!==this.$tp&&this.$tp!==b.AnchorPoint.GeometryProperties.tp&&a.push(this.$tp),this.$ah&&this.$ah!==b.AnchorPoint.GeometryProperties.ah&&a.push(this.$ah),a.push(this.$x),a.push(this.$y),this.$ah||((null!==this.$hlx||null!==this.$hly)&&(a.push("h"),a.push(this.$hlx),a.push(this.$hly)),(null!==this.$hrx||null!==this.$hry)&&(a.push("H"),a.push(this.$hrx),a.push(this.$hry))),(null!==this.$cl&&!ifMath.isEqualEps(this.$cl,b.AnchorPoint.GeometryProperties.cl)||null!==this.$cr&&!ifMath.isEqualEps(this.$cr,b.AnchorPoint.GeometryProperties.cr))&&(a.push("C"),a.push(this.$cl),a.push(this.$cr)),a},b.AnchorPoint.prototype.deserialize=function(a){var b=0;for(a.length>0&&"string"==typeof a[0]&&(this.$tp=a[0],b++),a.length>b&&"boolean"==typeof a[b]&&(this.$ah=a[b],b++),b+1<a.length&&(this.$x=a[b],this.$y=a[b+1],b+=2);b+2<a.length;)"h"===a[b]?(this.$hlx=a[b+1],this.$hly=a[b+2]):"H"===a[b]?(this.$hrx=a[b+1],this.$hry=a[b+2]):"C"===a[b]&&(this.$cl=a[b+1],this.$cr=a[b+2]),b+=3},b.AnchorPoint.prototype._getTransformedCopy=function(a){var c=new b.AnchorPoint,d=null!==this.$hlx?a.mapPoint(new IFPoint(this.$hlx,this.$hly)):null,e=null!==this.$hrx?a.mapPoint(new IFPoint(this.$hrx,this.$hry)):null,f=a.mapPoint(new IFPoint(this.$x,this.$y));return c.$x=f.getX(),c.$y=f.getY(),c.$hlx=d?d.getX():null,c.$hly=d?d.getY():null,c.$hrx=e?e.getX():null,c.$hry=e?e.getY():null,c.$cl=this.$cl,c.$cr=this.$cr,c.$ah=this.$ah,c.$tp=this.$tp,c},b.AnchorPoint.prototype.getLeftShoulderPoint=function(a){if(this.getPath()&&this.$cl&&(a||this.$cr)){var b=this._parent.getPreviousPoint(this);return this._parent._getLeftShoulderPoint(this,b)}return null},b.AnchorPoint.prototype.getLeftShoulderPointTransformed=function(a,b){var c=null;if(this.getPath()&&this.$cl&&(b||this.$cr)){var d=this._parent.getPreviousPoint(this),e=this._getTransformedCopy(a),f=d._getTransformedCopy(a);c=this._parent._getLeftShoulderPoint(e,f)}return c},b.AnchorPoint.prototype.getRightShoulderPoint=function(a){if(this.getPath()&&this.$cr&&(a||this.$cl)){var b=this._parent.getNextPoint(this);return this._parent._getRightShoulderPoint(this,b)}return null},b.AnchorPoint.prototype.getRightShoulderPointTransformed=function(a,b){var c=null;if(this.getPath()&&this.$cr&&(b||this.$cl)){var d=this._parent.getNextPoint(this),e=this._getTransformedCopy(a),f=d._getTransformedCopy(a);c=this._parent._getRightShoulderPoint(e,f)}return c},b.AnchorPoint.prototype.getLeftShoulderLimitPoint=function(){var a=null;if(this.getPath()){var b=this._parent.getPreviousPoint(this);b&&(a=this._parent._getLeftShoulderPoint(this,b,!0))}return a},b.AnchorPoint.prototype.getRightShoulderLimitPoint=function(){var a=null;if(this.getPath()){var b=this._parent.getNextPoint(this);b&&(a=this._parent._getRightShoulderPoint(this,b,!0))}return a},b.AnchorPoint.prototype._handleChange=function(a,c){var d=this.getPath();if((a==IFNode._Change.BeforePropertiesChange||a==IFNode._Change.AfterPropertiesChange)&&ifUtil.containsObjectKey(c.properties,b.AnchorPoint.GeometryProperties))if(a===IFNode._Change.BeforePropertiesChange){var e=c.properties.indexOf("cu"),f=e>=0?c.values[e]:this.$cu;if(f){var g=c.properties.indexOf("cl"),h=c.properties.indexOf("cr");if(g>=0){var i=c.values[g];this.$cr!=i&&(h>=0?c.values[h]=i:(c.properties.push("cr"),c.values.push(i)))}else if(h>=0){var i=c.values[h];this.$cl!=i&&(c.properties.push("cl"),c.values.push(i))}}d&&d._notifyChange(IFElement._Change.PrepareGeometryUpdate)}else if(a===IFNode._Change.AfterPropertiesChange&&((this.$tp==b.AnchorPoint.Type.Symmetric&&!this.$ah&&null!=this.$hlx&&null!=this.$hrx||this.$tp==b.AnchorPoint.Type.Mirror&&!this.$ah&&(null!=this.$hlx||null!=this.$hrx))&&(this._leadHr=(c.properties.indexOf("hrx")>=0||c.properties.indexOf("hry")>=0)&&c.properties.indexOf("hlx")<0&&c.properties.indexOf("hly")<0||c.properties.indexOf("tp")>=0&&c.properties.indexOf("hlx")<0&&c.properties.indexOf("hly")<0&&null!=this.$hrx?!0:!1),(d||this.$tp==b.AnchorPoint.Type.Symmetric&&!this.$ah&&null!=this.$hlx&&null!=this.$hrx||this.$tp==b.AnchorPoint.Type.Mirror&&!this.$ah&&(null!=this.$hlx||null!=this.$hrx))&&this._invalidateCalculations(),d)){if(this._parent)if(c.properties.indexOf("x")>=0||c.properties.indexOf("y")>=0)this._parent._invalidateLeft(this._parent.getPreviousPoint(this)),this._parent._invalidateRight(this._parent.getNextPoint(this));else if(c.properties.indexOf("tp")>=0){var j=this._parent.getPreviousPoint(this);j&&(j.$ah||j.$tp==b.AnchorPoint.Type.Connector)&&j._invalidateCalculations();var k=this._parent.getNextPoint(this);k&&(k.$ah||k.$tp==b.AnchorPoint.Type.Connector)&&k._invalidateCalculations()}d._verticesDirty=!0,d._notifyChange(IFElement._Change.FinishGeometryUpdate)}IFNode.prototype._handleChange.call(this,a,c)},b.AnchorPoint.prototype.getPath=function(){return this._parent?this._parent._parent:null},b.AnchorPoint.prototype._invalidateCalculations=function(){var a=this._parent;a&&this.$tp==b.AnchorPoint.Type.Connector?this._calculateConnectorPoint():this.$tp!=b.AnchorPoint.Type.Symmetric||this.$ah?this.$tp!=b.AnchorPoint.Type.Mirror||this.$ah?a&&this.$ah&&this._calculateAutoHandles():this._calculateMirrorPoint():this._calculateSmoothPoint()},b.AnchorPoint.prototype._calculateConnectorPoint=function(){var a=this._parent;if(a){var c=a.getPreviousPoint(this),d=a.getNextPoint(this),e=0,f=0;d&&(f=Math.sqrt(ifMath.ptSqrDist(this.$x,this.$y,d.$x,d.$y))),c&&(e=Math.sqrt(ifMath.ptSqrDist(this.$x,this.$y,c.$x,c.$y)));var g,h,i;this.$ah?(!d||!c||d.$tp!=b.AnchorPoint.Type.Symmetric&&d.$tp!=b.AnchorPoint.Type.Mirror||ifMath.isEqualEps(f,0)||ifMath.isEqualEps(e,0)?this.setProperties(["hrx","hry"],[null,null]):(g=f*b.AnchorPoint.HANDLE_COEFF,h=this.$x+(this.$x-c.$x)/e*g,i=this.$y+(this.$y-c.$y)/e*g,this.setProperties(["hrx","hry"],[h,i])),!c||!d||c.$tp!=b.AnchorPoint.Type.Symmetric&&c.$tp!=b.AnchorPoint.Type.Mirror||ifMath.isEqualEps(f,0)||ifMath.isEqualEps(e,0)?this.setProperties(["hlx","hly"],[null,null]):(g=e*b.AnchorPoint.HANDLE_COEFF,h=this.$x+(this.$x-d.$x)/f*g,i=this.$y+(this.$y-d.$y)/f*g,this.setProperties(["hlx","hly"],[h,i]))):(null!=this.$hlx&&d&&!ifMath.isEqualEps(f,0)&&(g=Math.sqrt(ifMath.ptSqrDist(this.$x,this.$y,this.$hlx,this.$hly)),h=this.$x+(this.$x-d.$x)/f*g,i=this.$y+(this.$y-d.$y)/f*g,this.setProperties(["hlx","hly"],[h,i])),null!=this.$hrx&&c&&!ifMath.isEqualEps(e,0)&&(g=Math.sqrt(ifMath.ptSqrDist(this.$x,this.$y,this.$hrx,this.$hry)),h=this.$x+(this.$x-c.$x)/e*g,i=this.$y+(this.$y-c.$y)/e*g,this.setProperties(["hrx","hry"],[h,i])))}},b.AnchorPoint.prototype._calculateSmoothPoint=function(){var a,b,c,d;null!=this.$hlx&&null!=this.$hrx&&(this._leadHr?(b=Math.sqrt(ifMath.ptSqrDist(this.$x,this.$y,this.$hrx,this.$hry)),ifMath.isEqualEps(b,0)||(a=Math.sqrt(ifMath.ptSqrDist(this.$x,this.$y,this.$hlx,this.$hly)),c=this.$x+(this.$x-this.$hrx)/b*a,d=this.$y+(this.$y-this.$hry)/b*a,this.setProperties(["hlx","hly"],[c,d]))):(b=Math.sqrt(ifMath.ptSqrDist(this.$x,this.$y,this.$hlx,this.$hly)),ifMath.isEqualEps(b,0)||(a=Math.sqrt(ifMath.ptSqrDist(this.$x,this.$y,this.$hrx,this.$hry)),c=this.$x+(this.$x-this.$hlx)/b*a,d=this.$y+(this.$y-this.$hly)/b*a,this.setProperties(["hrx","hry"],[c,d]))))},b.AnchorPoint.prototype._calculateMirrorPoint=function(){if(this._leadHr&&null!=this.$hrx){var a=this.$x+(this.$x-this.$hrx),b=this.$y+(this.$y-this.$hry);(this.$hlx!=a||this.$hly!=b)&&this.setProperties(["hlx","hly"],[a,b])}else if(!this._leadHr&&null!=this.$hlx){var a=this.$x+(this.$x-this.$hlx),b=this.$y+(this.$y-this.$hly);(this.$hrx!=a||this.$hry!=b)&&this.setProperties(["hrx","hry"],[a,b])}},b.AnchorPoint.prototype._calculateAutoHandles=function(){var a=this._parent;if(a){var c,d,e,f,g,h,i,j,k,l=a.getPreviousPoint(this),m=a.getNextPoint(this),n=b.AnchorPoint.HANDLE_COEFF;if(this.$tp==b.AnchorPoint.Type.Symmetric||this.$tp==b.AnchorPoint.Type.Mirror){if(!m&&!l)return;m&&!l||m&&this.$x==l.$x&&this.$y==l.$y?(c=this.$x+(m.$x-this.$x)*n,d=this.$y+(m.$y-this.$y)*n,this.setProperties(["hlx","hly","hrx","hry"],[this.$x+this.$x-c,this.$y+this.$y-d,c,d],!1,!0)):l&&!m||l&&this.$x==m.$x&&this.$y==m.$y?(c=this.$x+(l.$x-this.$x)*n,d=this.$y+(l.$y-this.$y)*n,this.setProperties(["hlx","hly","hrx","hry"],[c,d,this.$x+this.$x-c,this.$y+this.$y-d],!1,!0)):l&&m&&(g=ifMath.getCircumcircleCenter(l.$x,l.$y,this.$x,this.$y,m.$x,m.$y),null==g?(h=(this.$y-l.$y)*n,i=(l.$x-this.$x)*n,this.setProperties(["hlx","hly","hrx","hry"],[this.$x-h,this.$y-i,this.$x+h,this.$y+i],!1,!0)):(e=Math.sqrt(ifMath.ptSqrDist(this.$x,this.$y,g.getX(),g.getY())),h=(this.$y-g.getY())/e,i=(g.getX()-this.$x)/e,j=(l.$x+m.$x)/2,k=(l.$y+m.$y)/2,ifMath.segmentSide(this.$x,this.$y,j,k,l.$x,l.$y)!=ifMath.segmentSide(this.$x,this.$y,j,k,this.$x-h,this.$y-i)&&(h=-h,i=-i),f=Math.sqrt(ifMath.ptSqrDist(this.$x,this.$y,l.$x,l.$y))*n,this.setProperties(["hlx","hly"],[this.$x-h*f,this.$y-i*f]),f=Math.sqrt(ifMath.ptSqrDist(this.$x,this.$y,m.$x,m.$y))*n,this.setProperties(["hrx","hry"],[this.$x+h*f,this.$y+i*f])))}else{if(l&&(l.$x!=this.$x||l.$y!=this.$y))if(l.$tp==b.AnchorPoint.Type.Symmetric||l.$tp==b.AnchorPoint.Type.Mirror){var o=a.getPreviousPoint(l);!o||l.$x==o.$x&&l.$y==o.$y?(c=this.$x+(l.$x-this.$x)*n,d=this.$y+(l.$y-this.$y)*n,this.setProperties(["hlx","hly"],[c,d])):(g=ifMath.getCircumcircleCenter(this.$x,this.$y,l.$x,l.$y,o.$x,o.$y),null==g?(h=(this.$y-l.$y)*n,i=(l.$x-this.$x)*n,this.setProperties(["hlx","hly"],[this.$x-h,this.$y-i])):(e=Math.sqrt(ifMath.ptSqrDist(this.$x,this.$y,g.getX(),g.getY())),h=(this.$y-g.getY())/e,i=(g.getX()-this.$x)/e,j=(l.$x+o.$x)/2,k=(l.$y+o.$y)/2,ifMath.segmentSide(this.$x,this.$y,j,k,l.$x,l.$y)!=ifMath.segmentSide(this.$x,this.$y,j,k,this.$x-h,this.$y-i)&&(h=-h,i=-i),f=Math.sqrt(ifMath.ptSqrDist(this.$x,this.$y,l.$x,l.$y))*n,this.setProperties(["hlx","hly"],[this.$x-h*f,this.$y-i*f])))}else this.setProperties(["hlx","hly"],[null,null]);if(m&&(m.$x!=this.$x||m.$y!=this.$y))if(m.$tp==b.AnchorPoint.Type.Symmetric||m.$tp==b.AnchorPoint.Type.Mirror){var p=a.getNextPoint(m);!p||m.$x==p.$x&&m.$y==p.$y?(c=this.$x+(m.$x-this.$x)*n,d=this.$y+(m.$y-this.$y)*n,this.setProperties(["hrx","hry"],[c,d])):(g=ifMath.getCircumcircleCenter(this.$x,this.$y,m.$x,m.$y,p.$x,p.$y),null==g?(h=(this.$y-m.$y)*n,i=(m.$x-this.$x)*n,this.setProperties(["hrx","hry"],[this.$x-h,this.$y-i])):(e=Math.sqrt(ifMath.ptSqrDist(this.$x,this.$y,g.getX(),g.getY())),h=(this.$y-g.getY())/e,i=(g.getX()-this.$x)/e,j=(m.$x+p.$x)/2,k=(m.$y+p.$y)/2,ifMath.segmentSide(this.$x,this.$y,j,k,m.$x,m.$y)!=ifMath.segmentSide(this.$x,this.$y,j,k,this.$x+h,this.$y+i)&&(h=-h,i=-i),f=Math.sqrt(ifMath.ptSqrDist(this.$x,this.$y,m.$x,m.$y))*n,this.setProperties(["hrx","hry"],[this.$x+h*f,this.$y+i*f])))}else this.setProperties(["hrx","hry"],[null,null])}}},b.AnchorPoint.prototype.toString=function(){return"[Object IFPathBase.AnchorPoint]"},b.AnchorPoints=function(){this._flags|=IFNode.Flag.Shadow},IFObject.inheritAndMix(b.AnchorPoints,IFNode,[IFNode.Container]),b.AnchorPoints.prototype._dirtyPrev=null,b.AnchorPoints.prototype._dirtyNext=null,b.AnchorPoints.prototype.validateInsertion=function(a){return a instanceof b},b.AnchorPoints.prototype.validateRemoval=function(){return!1},b.AnchorPoints.prototype.serialize=function(){for(var a=[],b=this.getFirstChild();null!==b;b=b.getNext())a.push(b.serialize());return a},b.AnchorPoints.prototype.deserialize=function(a){for(var c=0;c<a.length;++c){var d=new b.AnchorPoint;d.deserialize(a[c]),this.appendChild(d)}},b.AnchorPoints.prototype._invalidateLeft=function(a){if(a&&((a.$ah||a.$tp==b.AnchorPoint.Type.Connector)&&a._invalidateCalculations(),a.$tp==b.AnchorPoint.Type.Symmetric||a.$tp==b.AnchorPoint.Type.Mirror)){var c=this.getPreviousPoint(a);c&&c.$ah&&c._invalidateCalculations()}},b.AnchorPoints.prototype._invalidateRight=function(a){if(a&&((a.$ah||a.$tp==b.AnchorPoint.Type.Connector)&&a._invalidateCalculations(),a.$tp==b.AnchorPoint.Type.Symmetric||a.$tp==b.AnchorPoint.Type.Mirror)){var c=this.getNextPoint(a);c&&c.$ah&&c._invalidateCalculations()}},b.AnchorPoints.prototype._generateVertices=function(a,c,d){var e,f,g,h;if(h=this.getFirstChild()){var i,j=this._parent;if(d&&h.$tp!=b.AnchorPoint.Type.Asymmetric&&h.$tp!=b.AnchorPoint.Type.Connector&&h.$tp!=b.AnchorPoint.Type.Symmetric&&h.$tp!=b.AnchorPoint.Type.Mirror&&j&&j.$closed&&h!=this.getLastChild()?(e=this._getPathStartPt(c),f=e.getX(),g=e.getY()):(i=c?h._getTransformedCopy(c):h,f=i.$x,g=i.$y),a.addVertex(IFVertex.Command.Move,f,g),h!=this.getLastChild()){var k=h;h=h.getNext();var l,m,n=h,o=!1,p=this.getNextPoint(h);for(c&&(i=h._getTransformedCopy(c),l=k._getTransformedCopy(c));p&&(h!=n||!o);)o=!0,c?(m=p._getTransformedCopy(c),this._addMiddleVertices(a,i,l,m,d),l=i,i=m):this._addMiddleVertices(a,h,k,p,d),k=h,h=p,p=this.getNextPoint(p);p?a.addVertex(IFVertex.Command.Close,0,0):this._addPathEndVertices(a,c)}}},b.AnchorPoints.prototype._getPathStartPt=function(a){var c=this.getFirstChild(),d=this.getPreviousPoint(c),e=this.getNextPoint(c);return a&&(c=c._getTransformedCopy(a),e=e._getTransformedCopy(a),d=d._getTransformedCopy(a)),c.$cl&&c.$cr&&c.$tp!=b.AnchorPoint.Type.Asymmetric&&c.$tp!=b.AnchorPoint.Type.Connector&&c.$tp!=b.AnchorPoint.Type.Symmetric&&c.$tp!=b.AnchorPoint.Type.Mirror&&d&&(d.$tp!=b.AnchorPoint.Type.Connector||d.$x!=c.$x||d.$y!=c.$y)?this._getRightShoulderPoint(c,e):new IFPoint(c.$x,c.$y)},b.AnchorPoints.prototype._getShoulderPoint=function(a,b,c,d,e,f){var g,h,i,j=ifMath.ptDist(a,b,d,e);h=null==c||0>=c?0:c,i=null==f||0>=f?0:f;var k=h+i;return 0>=k?null:(g=j>=k?h:j*h/k,ifMath.getPointAtLength(a,b,d,e,g))},b.AnchorPoints.prototype._getRightShoulderPoint=function(a,b,c){var d=null,e=null;null!=a.$hrx?(d=a.$hrx,e=a.$hry):null!=b.$hlx&&(d=b.$hlx,e=b.$hly);var f;return f=null!=d?c?new IFPoint(d,e):ifMath.getPointAtLength(a.$x,a.$y,d,e,a.$cr):c?new IFPoint(b.$x,b.$y):this._getShoulderPoint(a.$x,a.$y,a.$cr,b.$x,b.$y,b.$cl)},b.AnchorPoints.prototype._getLeftShoulderPoint=function(a,b,c){var d=null,e=null;null!=a.$hlx?(d=a.$hlx,e=a.$hly):null!=b.$hrx&&(d=b.$hrx,e=b.$hry);var f;return f=null!=d?c?new IFPoint(d,e):ifMath.getPointAtLength(a.$x,a.$y,d,e,a.$cl):c?new IFPoint(b.$x,b.$y):this._getShoulderPoint(a.$x,a.$y,a.$cl,b.$x,b.$y,b.$cr)},b.AnchorPoints.prototype._addMiddleVertices=function(a,c,d,e,f){var g,h,i=null,j=null,k=null,l=null;null!=c.$hlx&&null!=c.$hly&&null!=d.$hrx&&null!=d.$hry?(k=d.$hrx,l=d.$hry,i=c.$hlx,j=c.$hly):null!=c.$hlx&&null!=c.$hly?(k=c.$hlx,l=c.$hly):null!=d.$hrx&&null!=d.$hry&&(k=d.$hrx,l=d.$hry),f&&c.$tp!=b.AnchorPoint.Type.Asymmetric&&c.$tp!=b.AnchorPoint.Type.Connector&&c.$tp!=b.AnchorPoint.Type.Symmetric&&c.$tp!=b.AnchorPoint.Type.Mirror&&c.$cl&&c.$cr?(null==k?(g=this._getShoulderPoint(c.$x,c.$y,c.$cl,d.$x,d.$y,d.$cr),a.addVertex(IFVertex.Command.Line,g.getX(),g.getY())):null==i?(g=ifMath.getPointAtLength(c.$x,c.$y,k,l,c.$cl),a.addVertex(IFVertex.Command.Curve,g.getX(),g.getY()),a.addVertex(IFVertex.Command.Curve,k,l)):(g=ifMath.getPointAtLength(c.$x,c.$y,i,j,c.$cl),a.addVertex(IFVertex.Command.Curve2,g.getX(),g.getY()),a.addVertex(IFVertex.Command.Curve2,k,l),a.addVertex(IFVertex.Command.Curve2,i,j)),h=this._getRightShoulderPoint(c,e),this._addCornerToVertices(a,g.getX(),g.getY(),h.getX(),h.getY(),c.$x,c.$y,c.$tp)):null==k?a.addVertex(IFVertex.Command.Line,c.$x,c.$y):null==i?(a.addVertex(IFVertex.Command.Curve,c.$x,c.$y),a.addVertex(IFVertex.Command.Curve,k,l)):(a.addVertex(IFVertex.Command.Curve2,c.$x,c.$y),a.addVertex(IFVertex.Command.Curve2,k,l),a.addVertex(IFVertex.Command.Curve2,i,j))},b.AnchorPoints.prototype._addCornerToVertices=function(a,c,d,e,f,g,h,i){var j,k,l,m,n,o,p,q,r,s;return c==e&&d==f?void((g!=c||h!=d)&&(a.addVertex(IFVertex.Command.Line,g,h),a.addVertex(IFVertex.Command.Line,e,f))):c==g&&d==h||e==g&&f==h?void a.addVertex(IFVertex.Command.Line,e,f):void(i==b.CornerType.Rounded||i==b.CornerType.InverseRounded?c==e&&c==g||d==f&&d==h?(a.addVertex(IFVertex.Command.Curve,e,f),a.addVertex(IFVertex.Command.Curve,g,h)):(i==b.CornerType.Rounded?(r=g,s=h):(r=c+e-g,s=d+f-h),a.addVertex(IFVertex.Command.Curve,e,f),a.addVertex(IFVertex.Command.Curve,r,s)):i==b.CornerType.Fancy?(l=(e-g)/3,m=(f-h)/3,n=(g-c)/3,o=(h-d)/3,j=c+2*l,k=d+2*m,a.addVertex(IFVertex.Command.Line,j,k),j+=2*n,k+=2*o,a.addVertex(IFVertex.Command.Line,j,k),j-=l,k-=m,a.addVertex(IFVertex.Command.Line,j,k),j-=n,k-=o,a.addVertex(IFVertex.Command.Line,j,k),j+=2*l,k+=2*m,a.addVertex(IFVertex.Command.Line,j,k),j+=2*n,k+=2*o,a.addVertex(IFVertex.Command.Line,j,k)):i==b.CornerType.Bevel?a.addVertex(IFVertex.Command.Line,e,f):i==b.CornerType.Inset?(p=c+e-g,q=d+f-h,a.addVertex(IFVertex.Command.Line,p,q),a.addVertex(IFVertex.Command.Line,e,f)):(a.addVertex(IFVertex.Command.Line,g,h),a.addVertex(IFVertex.Command.Line,e,f)))},b.AnchorPoints.prototype._addPathEndVertices=function(a,b){var c,d,e=this.getLastChild(),f=e.getPrevious();b&&(e=e._getTransformedCopy(b),f=f._getTransformedCopy(b)),null!=e.$hlx&&null!=e.$hly&&null!=f.$hrx&&null!=f.$hry?(a.addVertex(IFVertex.Command.Curve2,e.$x,e.$y),a.addVertex(IFVertex.Command.Curve2,f.$hrx,f.$hry),a.addVertex(IFVertex.Command.Curve2,e.$hlx,e.$hly)):null!=e.$hlx&&null!=e.$hly||null!=f.$hrx&&null!=f.$hry?(null!=e.$hlx&&null!=e.$hly?(c=e.$hlx,d=e.$hly):(c=f.$hrx,d=f.$hry),a.addVertex(IFVertex.Command.Curve,e.$x,e.$y),a.addVertex(IFVertex.Command.Curve,c,d)):a.addVertex(IFVertex.Command.Line,e.$x,e.$y)},b.AnchorPoints.prototype._handleChange=function(a,c){var d=this._parent;if(d){var e,f,g,h,i=c;a==IFNode._Change.BeforeChildInsert?this.getParent()&&this.getParent().beginUpdate():a==IFNode._Change.AfterChildInsert?(e=this.getPreviousPoint(i),e&&null!=e.$hrx&&i.$tp==b.AnchorPoint.Type.Connector&&(g=i.$x+(e.$x-i.$x)*b.AnchorPoint.HANDLE_COEFF,h=i.$y+(e.$y-i.$y)*b.AnchorPoint.HANDLE_COEFF,ifMath.isEqualEps(i.$x-g,0)&&ifMath.isEqualEps(i.$y-h,0)||i.setProperties(["hlx","hly"],[g,h])),f=this.getNextPoint(i),f&&null!=f.$hlx&&i.$tp==b.AnchorPoint.Type.Connector&&(g=i.$x+(f.$x-i.$x)*b.AnchorPoint.HANDLE_COEFF,h=i.$y+(f.$y-i.$y)*b.AnchorPoint.HANDLE_COEFF,ifMath.isEqualEps(i.$x-g,0)&&ifMath.isEqualEps(i.$y-h,0)||i.setProperties(["hrx","hry"],[g,h])),(i.$ah||i.$tp==b.AnchorPoint.Type.Connector)&&i._invalidateCalculations(),this._invalidateLeft(e),this._invalidateRight(f),this.getParent()&&this.getParent().endUpdate()):a==IFNode._Change.BeforeChildRemove?(this.getParent()&&this.getParent().beginUpdate(),this._dirtyPrev=this.getPreviousPoint(i),this._dirtyNext=this.getNextPoint(i)):a==IFNode._Change.AfterChildRemove&&(this._dirtyPrev&&this._invalidateLeft(this._dirtyPrev),this._dirtyNext&&this._invalidateRight(this._dirtyNext),this.getParent()&&this.getParent().endUpdate())}!d||a!=IFNode._Change.AfterChildInsert&&a!=IFNode._Change.AfterChildRemove||(d._notifyChange(IFElement._Change.PrepareGeometryUpdate),d._verticesDirty=!0,d._notifyChange(IFElement._Change.FinishGeometryUpdate)),IFNode.prototype._handleChange.call(this,a,c)},b.AnchorPoints.prototype.getNextPoint=function(a){var b=a?a.getNext():null;return!b&&this._parent&&this._parent.$closed&&a==this.getLastChild()&&(b=this.getFirstChild()),b},b.AnchorPoints.prototype.getPreviousPoint=function(a){var b=a?a.getPrevious():null;return!b&&this._parent&&this._parent.$closed&&a==this.getFirstChild()&&(b=this.getLastChild()),b},b.AnchorPoints.prototype.getLastRelatedPoint=function(a){var c=a,d=this.getNextPoint(a);if(d&&(c=d,d.$tp==b.AnchorPoint.Type.Symmetric||d.$tp==b.AnchorPoint.Type.Mirror)){var e=this.getNextPoint(d);e&&e.$ah&&e!=a&&(c=e)}return c},b.AnchorPoints.prototype.getFirstRelatedPoint=function(a){var c=a,d=this.getPreviousPoint(a);if(d&&(c=d,d.$tp==b.AnchorPoint.Type.Symmetric||d.$tp==b.AnchorPoint.Type.Mirror)){var e=this.getPreviousPoint(d);e&&e.$ah&&e!=a&&(c=e)}return c},b.AnchorPoints.prototype.toString=function(){return"[Object IFPathBase.AnchorPoints]"},b.prototype._vertices=null,b.prototype._verticesDirty=!1,b.prototype._anchorPoints=null,b.prototype.rewindVertices=function(a){return(this._verticesDirty||null==this._vertices||0==this._vertices.getCount())&&(this._vertices.clearVertices(),this._getAnchorPoints()._generateVertices(this._vertices,this.$trf,!0),this._verticesDirty=!1),this._vertices.rewindVertices(a)},b.prototype.readVertex=function(a){return this._vertices.readVertex(a)},b.prototype.store=function(a){return IFShape.prototype.store.call(this,a)?(this.storeProperties(a,b.VisualProperties),!0):!1},b.prototype.restore=function(a){return IFShape.prototype.restore.call(this,a)?(this.restoreProperties(a,b.VisualProperties),!0):!1},b.prototype._handleChange=function(a,c){if(this._handleVisualChangeForProperties(a,c,b.VisualProperties),a===IFNode._Change.AfterPropertiesChange)if(c.properties.indexOf("closed")>=0){var d=this._getAnchorPoints();d&&(d._invalidateRight(d.getFirstChild()),d._invalidateLeft(d.getLastChild())),this._verticesDirty=!0}else c.properties.indexOf("trf")>=0&&(this._verticesDirty=!0);IFShape.prototype._handleChange.call(this,a,c)},b.prototype._getAnchorPoints=function(){return this._anchorPoints},b.prototype.toString=function(){return"[IFPathBase]"},a.IFPathBase=b}(this),function(a){function b(){IFShape.call(this),this._setDefaultProperties(b.VisualProperties),this._image=new Image,this._image.onload=this._updatedImage.bind(this),this._image.onerror=this._updatedImage.bind(this),this._image.onabort=this._updatedImage.bind(this),this._updateImage()}IFNode.inheritAndMix("image",b,IFShape),b.VisualProperties={url:null},b.ImageStatus={Loaded:0,Resolving:1,Loading:2,Delayed:3,Error:10},b.NO_IMAGE_WIDTH=100,b.NO_IMAGE_HEIGHT=100,b.NO_IMAGE_BACKGROUND=new IFColor(IFColor.Type.RGB,[240,240,240,100]),b.NO_IMAGE_ERROR_STROKE=new IFColor(IFColor.Type.RGB,[255,0,0,100]),b.StatusEvent=function(a,b){this.image=a,this.status=b},IFObject.inherit(b.StatusEvent,GEvent),b.StatusEvent.prototype.image=null,b.StatusEvent.prototype.status=null,b.StatusEvent.prototype.toString=function(){return"[Event IFImage.StatusEvent]"},b.prototype._status=null,b.prototype._image=null,b.prototype._vertexIterator=0,b.prototype.getStatus=function(){return this._status},b.prototype.getImage=function(){return this._image},b.prototype.store=function(a){return IFShape.prototype.store.call(this,a)?(this.storeProperties(a,b.VisualProperties),!0):!1},b.prototype.restore=function(a){return IFShape.prototype.restore.call(this,a)?(this.restoreProperties(a,b.VisualProperties),this._updateImage(),!0):!1},b.prototype.rewindVertices=function(a){return this._vertexIterator=a,!0},b.prototype.readVertex=function(a){switch(this._vertexIterator){case 0:a.command=IFVertex.Command.Move,a.x=0,a.y=0;break;case 1:a.command=IFVertex.Command.Line,a.x=this._getWidth(),a.y=0;break;case 2:a.command=IFVertex.Command.Line,a.x=this._getWidth(),a.y=this._getHeight();break;case 3:a.command=IFVertex.Command.Line,a.x=0,a.y=this._getHeight();break;case 4:a.command=IFVertex.Command.Close;break;default:return!1}return a.command!==IFVertex.Command.Close&&this.$trf&&this.$trf.map(a),this._vertexIterator+=1,!0},b.prototype._paintBackground=function(a,b){b||a.configuration.isOutline(a)||this._paintImage(a),IFShape.prototype._paintBackground.call(this,a)},b.prototype._paintStyle=function(a,c,d){if(this._status===b.ImageStatus.Loaded){var e=a.canvas;a.canvas=e.createCanvas(c.getBBox(this.getGeometryBBox())),0===d&&this._paintImage(a);try{IFShape.prototype._paintStyle.call(this,a,c,d)}finally{this._paintImage(a,IFPaintCanvas.CompositeOperator.DestinationIn),e.drawCanvas(a.canvas),a.canvas=e}}else this._paintImage(a),IFShape.prototype._paintStyle.call(this,a,c,d)},b.prototype._detailHitTest=function(){return new IFElement.HitResult(this)},b.prototype._handleChange=function(a,b){a==IFNode._Change.AfterPropertiesChange&&b.properties.indexOf("url")>=0&&this._updateImage(),IFShape.prototype._handleChange.call(this,a,b)},b.prototype._setScene=function(a){IFShape.prototype._setScene.call(this,a),this._scene&&this._status===b.ImageStatus.Delayed&&this._updateImage()},b.prototype._paintImage=function(a,c){var d=a.canvas.getTransform(!0);if(this.$trf){var e=d.preMultiplied(this.$trf);a.canvas.setTransform(e)}switch(this._status){case b.ImageStatus.Loaded:a.canvas.drawImage(this._image,0,0,!1,1,c);break;default:var f=this._getWidth(),g=this._getHeight();a.canvas.fillRect(0,0,f,g,b.NO_IMAGE_BACKGROUND),this._status===b.ImageStatus.Error&&(a.canvas.strokeLine(0,0,f,g,2,b.NO_IMAGE_ERROR_STROKE),a.canvas.strokeLine(f,0,0,g,2,b.NO_IMAGE_ERROR_STROKE))}a.canvas.setTransform(d)},b.prototype._getWidth=function(){return this._image.naturalWidth?this._image.naturalWidth:b.NO_IMAGE_WIDTH},b.prototype._getHeight=function(){return this._image.naturalHeight?this._image.naturalHeight:b.NO_IMAGE_HEIGHT},b.prototype._updateImage=function(){this.isAttached()?(this._setStatus(b.ImageStatus.Resolving),this._scene.resolveUrl(this.$url,this._resolvedImage.bind(this))):this._setStatus(b.ImageStatus.Delayed)},b.prototype._resolvedImage=function(a){this._setStatus(b.ImageStatus.Loading),this._notifyChange(IFElement._Change.InvalidationRequest),this._notifyChange(IFElement._Change.PrepareGeometryUpdate),this._image.src=a},b.prototype._updatedImage=function(){this._notifyChange(IFElement._Change.FinishGeometryUpdate),this._setStatus(0!==this._image.naturalWidth&&0!==this._image.naturalHeight?b.ImageStatus.Loaded:b.ImageStatus.Error)},b.prototype._setStatus=function(a){a!==this._status&&(this._status=a,this.isAttached()&&this._scene.hasEventListeners(b.StatusEvent)&&this._scene.trigger(new b.StatusEvent(this,this._status)))},b.prototype.toString=function(){return"[IFImage]"},a.IFImage=b}(this),function(a){function b(){IFPathBase.call(this),this.$closed=!0,this._setDefaultProperties(b.GeometryProperties)}IFNode.inherit("polygon",b,IFPathBase),b.GeometryProperties={pts:6,cx:0,cy:0,or:0,ir:0,oa:0,ia:ifMath.PI2-Math.PI/3,oct:IFPathBase.CornerType.Rounded,ict:IFPathBase.CornerType.Rounded,ocr:0,icr:0},b.prototype.iterateSegments=function(a,b){for(var c=1e-6,d=this.$oa+ifMath.PI2,e=ifMath.PI2/this.$pts,f=this.$ia-this.$oa,g=b?this.$trf:null,h=this.$oa;d-c>h;h+=e){var i=new IFPoint(this.$or*Math.cos(h)+this.$cx,this.$or*Math.sin(h)+this.$cy);if(g&&(i=g.mapPoint(i)),a(i,!1,h)===!0)break;if(i=new IFPoint(this.$ir*Math.cos(h+f)+this.$cx,this.$ir*Math.sin(h+f)+this.$cy),g&&(i=g.mapPoint(i)),a(i,!0,h+f)===!0)break}},b.prototype.store=function(a){return IFPathBase.prototype.store.call(this,a)?(this.storeProperties(a,b.GeometryProperties),!0):!1},b.prototype.restore=function(a){return IFPathBase.prototype.restore.call(this,a)?(this.restoreProperties(a,b.GeometryProperties),this._invalidatePath(),!0):!1},b.prototype._handleChange=function(a,c){this._handleGeometryChangeForProperties(a,c,b.GeometryProperties)&&a==IFNode._Change.AfterPropertiesChange&&this._invalidatePath(),IFPathBase.prototype._handleChange.call(this,a,c)},b.prototype._invalidatePath=function(){var a=this._getAnchorPoints();this.beginUpdate(),a._beginBlockCompositeEvents(!0,!0,!0);try{a.clearChildren(),this.iterateSegments(function(b,c){var d=new IFPathBase.AnchorPoint;d.setProperties(["tp","x","y","cl","cr"],[c?this.$ict:this.$oct,b.getX(),b.getY(),c?this.$icr:this.$ocr,c?this.$icr:this.$ocr]),a.appendChild(d)}.bind(this))}finally{this.endUpdate(),a._endBlockCompositeEvents(!0,!0,!0)}},b.prototype.getCenter=function(a){var b=new IFPoint(this.$cx,this.$cy);return a&&this.$trf&&(b=this.$trf.mapPoint(b)),b},b.prototype.getOrigHalfWidth=function(){return this.$or>=this.$ir?this.$or:this.$ir},b.prototype.getOrigHalfHeight=function(){return this.$or>=this.$ir?this.$or:this.$ir},b.prototype.toString=function(){return"[IFPolygon]"},a.IFPolygon=b}(this),function(a){function b(){IFPathBase.call(this),this.$closed=!0,this._setDefaultProperties(b.GeometryProperties),this._invalidatePath()}IFNode.inherit("rectangle",b,IFPathBase),b.GeometryProperties={uf:!0,tl_uf:!0,tl_ct:IFPathBase.CornerType.Rounded,tl_sx:0,tl_sy:0,tr_uf:!0,tr_ct:IFPathBase.CornerType.Rounded,tr_sx:0,tr_sy:0,br_uf:!0,br_ct:IFPathBase.CornerType.Rounded,br_sx:0,br_sy:0,bl_uf:!0,bl_ct:IFPathBase.CornerType.Rounded,bl_sx:0,bl_sy:0},b.getGeometryPropertiesSidePrefix=function(a){switch(a){case IFRect.Side.TOP_LEFT:return"tl";case IFRect.Side.TOP_RIGHT:return"tr";case IFRect.Side.BOTTOM_RIGHT:return"br";case IFRect.Side.BOTTOM_LEFT:return"bl";default:throw new Error("Invalid side")}},b.SIDES=[IFRect.Side.TOP_LEFT,IFRect.Side.TOP_RIGHT,IFRect.Side.BOTTOM_RIGHT,IFRect.Side.BOTTOM_LEFT],b.prototype.iterateSegments=function(a,c){for(var d=c?this.$trf:null,e=0;e<b.SIDES.length;++e){var f=b.SIDES[e],g=b.getGeometryPropertiesSidePrefix(f),h=null;switch(f){case IFRect.Side.TOP_LEFT:h=new IFPoint(-1,-1);break;case IFRect.Side.TOP_RIGHT:h=new IFPoint(1,-1);break;case IFRect.Side.BOTTOM_RIGHT:h=new IFPoint(1,1);break;case IFRect.Side.BOTTOM_LEFT:h=new IFPoint(-1,1)}if(d&&(h=d.mapPoint(h)),a(h,f,this["$"+g+"_ct"],this["$"+g+"_sx"],this["$"+g+"_sy"],e)===!0)break}},b.prototype.store=function(a){if(IFPathBase.prototype.store.call(this,a)){if(this.uf)a.uf=!0,a.ct=this.$tl_ct,a.sl=this.$tl_sx;else for(var c=0;c<b.SIDES.length;++c){var d=b.SIDES[c],e=b.getGeometryPropertiesSidePrefix(d);a[e+"uf"]=this["$"+e+"_uf"],a[e+"ct"]=this["$"+e+"_ct"],a[e+"sl"]=[this["$"+e+"_sx"],this["$"+e+"_sy"]]}return!0}return!1},b.prototype.restore=function(a){if(IFPathBase.prototype.restore.call(this,a)){for(var c=0;c<b.SIDES.length;++c){var d=b.SIDES[c],e=b.getGeometryPropertiesSidePrefix(d);this["$"+e+"_uf"]=a.uf?a.uf:a[e+"uf"],this["$"+e+"_ct"]=a.uf?a.ct:a[e+"ct"],this["$"+e+"_sx"]=a.uf?a.sl:a[e+"sl"][0],this["$"+e+"_sy"]=a.uf?a.sl:a[e+"sl"][1]}return this._invalidatePath(),!0}return!1},b.prototype.getAnchorPoints=function(){return this._getAnchorPoints()},b.prototype._handleChange=function(a,c){if(this._handleGeometryChangeForProperties(a,c,b.GeometryProperties)&&a==IFNode._Change.AfterPropertiesChange){var d=[],e=[],f=c.properties,g=c.values;if(this.$uf){for(var h=null,i=null,j=!1,k=!1,l=0;l<b.SIDES.length&&(!j||!k);++l){var m=b.SIDES[l],n=b.getGeometryPropertiesSidePrefix(m);if(!j){var o=n+"_sx",p=f.indexOf(o);if(p>=0)h=g[p],j=!0;else{var o=n+"_sy",p=f.indexOf(o);p>=0&&(h=g[p],j=!0)}}if(!k){var o=n+"_ct",p=f.indexOf(o);p>=0&&(i=g[p],k=!0)}}j||(h=this.getProperty("tl_sx")),k||(i=this.getProperty("tl_ct")),d.push("tl_uf","tr_uf","br_uf","bl_uf"),e.push(!0,!0,!0,!0),d.push("tl_sx","tl_sy","tr_sx","tr_sy","br_sx","br_sy","bl_sx","bl_sy"),e.push(h,h,h,h,h,h,h,h),d.push("tl_ct","tr_ct","br_ct","bl_ct"),e.push(i,i,i,i)}else for(var l=0;l<b.SIDES.length;++l){var m=b.SIDES[l],n=b.getGeometryPropertiesSidePrefix(m),h=null,j=!1;if(this["$"+n+"_uf"]){var o=n+"_sx",p=f.indexOf(o);if(p>=0)h=g[p],j=!0;else{var o=n+"_sy",p=f.indexOf(o);p>=0&&(h=g[p],j=!0)}j||(h=this.getProperty(n+"_sx")),d.push(n+"_sx"),e.push(h),d.push(n+"_sy"),e.push(h)}}this.setProperties(d,e)||this._invalidatePath()}IFPathBase.prototype._handleChange.call(this,a,c)},b.prototype._invalidatePath=function(){var a=this._getAnchorPoints();this.beginUpdate(),a._beginBlockCompositeEvents(!0,!0,!0);try{a.clearChildren(),this.iterateSegments(function(b,c,d,e,f){var g=new IFPathBase.AnchorPoint;g.setProperties(["tp","x","y","cl","cr","cu"],[d,b.getX(),b.getY(),e,f,!1]),a.appendChild(g)}.bind(this))}finally{this.endUpdate(),a._endBlockCompositeEvents(!0,!0,!0)}},b.prototype.toString=function(){return"[IFRectangle]"},a.IFRectangle=b}(this),function(a){function b(){IFPathBase.call(this),this._setDefaultProperties(b.GeometryProperties),this._invalidatePath()}IFNode.inherit("ellipse",b,IFPathBase),b.Type={Pie:0,Chord:1,Arc:2},b.GeometryProperties={sa:Math.PI,ea:Math.PI,etp:b.Type.Pie},b.prototype.store=function(a){return IFPathBase.prototype.store.call(this,a)?(this.storeProperties(a,b.GeometryProperties),!0):!1
},b.prototype.restore=function(a){return IFPathBase.prototype.restore.call(this,a)?(this.restoreProperties(a,b.GeometryProperties),this._invalidatePath(),!0):!1},b.prototype._handleChange=function(a,c){this._handleGeometryChangeForProperties(a,c,b.GeometryProperties)&&a==IFNode._Change.AfterPropertiesChange&&this._invalidatePath(),IFPathBase.prototype._handleChange.call(this,a,c)},b.prototype._invalidatePath=function(){var a=this._getAnchorPoints();this.beginUpdate(),a._beginBlockCompositeEvents(!0,!0,!0);try{a.clearChildren();var c;for(c=Math.PI/2;c<=this.$sa||ifMath.isEqualEps(c,this.$sa);c+=Math.PI/2);var d=new IFPathBase.AnchorPoint;d.setProperties(["x","y","tp","ah"],[Math.cos(this.$sa),Math.sin(this.$sa),IFPathBase.AnchorPoint.Type.Symmetric,!0]),a.appendChild(d);var e=ifMath.isEqualEps(this.$sa,this.$ea)?this.$sa+ifMath.PI2:this.$ea;for(e<this.$sa&&(e+=ifMath.PI2),c;e>c&&!ifMath.isEqualEps(c,e);c+=Math.PI/2)d=new IFPathBase.AnchorPoint,d.setProperties(["x","y","tp","ah"],[Math.cos(c),Math.sin(c),IFPathBase.AnchorPoint.Type.Symmetric,!0]),a.appendChild(d);ifMath.isEqualEps(this.$sa+ifMath.PI2,e)||(d=new IFPathBase.AnchorPoint,d.setProperties(["x","y","tp","ah"],[Math.cos(e),Math.sin(e),IFPathBase.AnchorPoint.Type.Symmetric,!0]),a.appendChild(d));var f=null;a.getFirstChild().getNext()==a.getLastChild()&&(d=new IFPathBase.AnchorPoint,ifMath.isEqualEps(c,e)&&(c+=Math.PI/2),d.setProperties(["x","y","tp","ah"],[Math.cos(c),Math.sin(c),IFPathBase.AnchorPoint.Type.Symmetric,!0]),a.appendChild(d),f=d),this.setProperty("closed",!0);for(var g=a.getFirstChild();null!=g;g=g.getNext())g.setProperty("ah",!1);f&&a.removeChild(f),ifMath.isEqualEps(this.$sa+ifMath.PI2,e)||(a.getFirstChild().setProperties(["tp","hlx","hly"],[IFPathBase.AnchorPoint.Type.Asymmetric,null,null]),a.getLastChild().setProperties(["tp","hrx","hry"],[IFPathBase.AnchorPoint.Type.Asymmetric,null,null]),this.$etp==b.Type.Pie?(d=new IFPathBase.AnchorPoint,a.appendChild(d)):this.$etp==b.Type.Arc&&this.setProperty("closed",!1))}finally{this.endUpdate(),a._endBlockCompositeEvents(!0,!0,!0)}},b.prototype.toString=function(){return"[IFEllipse]"},a.IFEllipse=b}(this),function(a){function b(a,c,d){IFPathBase.call(this,a,c,d),this._setDefaultProperties(b.GeometryProperties)}IFNode.inherit("path",b,IFPathBase),b.GeometryProperties={closed:!1},b.prototype.getAnchorPoints=function(){return this._getAnchorPoints()},b.prototype.store=function(a){return IFPathBase.prototype.store.call(this,a)?(this.storeProperties(a,b.GeometryProperties),a.pts=this.getAnchorPoints().serialize(),!0):!1},b.prototype.restore=function(a){return IFPathBase.prototype.restore.call(this,a)?(this.restoreProperties(a,b.GeometryProperties),a.hasOwnProperty("pts")&&this.getAnchorPoints().deserialize(a.pts),!0):!1},b.prototype.clone=function(){for(var a=IFPathBase.prototype.clone.call(this),b=this.getAnchorPoints().queryAll(":selected"),c=0;c<b.length;++c){var d=this.getAnchorPoints().getIndexOfChild(b[c]),e=a.getAnchorPoints().getChildByIndex(d);e&&e.setFlag(IFNode.Flag.Selected)}return a},b.prototype.pathHitTest=function(a,b,c,d){d=d||0;var e=a,f=1;if(b){var g=b.inverted();e=g.mapPoint(a),f*=g.getScaleFactor()}var h=null;if(this.$trf){h=this.$trf,this.$trf=null;var g=h.inverted();e=g.mapPoint(e),f*=g.getScaleFactor()}var i=new IFVertexContainer;this._getAnchorPoints()._generateVertices(i,this.$trf,!1);var j=new IFVertexInfo.HitResult,k=null,l=f+2*d;return ifVertexInfo.hitTest(e.getX(),e.getY(),i,l,this.$closed?c:!1,j)&&(k=new IFElement.HitResult(this,j)),h&&(this.$trf=h),k},b.prototype.insertHitPoint=function(a){if(!a||!a.slope||ifMath.isEqualEps(a.slope,0)||ifMath.isEqualEps(a.slope,1))return null;for(var c=a.slope,d=1,e=this.getAnchorPoints().getFirstChild();null!=e&&d<a.segment;)e=e.getNext(),d++;var f=e,g=f?this.getAnchorPoints().getNextPoint(f):null;if(f&&g){this.beginUpdate(),f.setProperty("ah",!1),g.setProperty("ah",!1);var h,i=f.getProperty("tp"),j=g.getProperty("tp");h=i==IFPathBase.AnchorPoint.Type.Connector||i==IFPathBase.AnchorPoint.Type.Symmetric||i==IFPathBase.AnchorPoint.Type.Mirror||j==IFPathBase.AnchorPoint.Type.Connector||j==IFPathBase.AnchorPoint.Type.Symmetric||j==IFPathBase.AnchorPoint.Type.Mirror||i==IFPathBase.AnchorPoint.Type.Asymmetric&&j==IFPathBase.AnchorPoint.Type.Asymmetric?IFPathBase.AnchorPoint.Type.Asymmetric:i!=IFPathBase.AnchorPoint.Type.Symmetric&&i!=IFPathBase.AnchorPoint.Type.Mirror&&i!=IFPathBase.AnchorPoint.Type.Connector&&i!=IFPathBase.AnchorPoint.Type.Asymmetric?i:j;var k,l,m,n,o,p,q,r,s=null;k=f.getProperty("x"),o=f.getProperty("y"),l=f.getProperty("hrx"),p=f.getProperty("hry"),n=g.getProperty("x"),r=g.getProperty("y"),m=g.getProperty("hlx"),q=g.getProperty("hly");var t=null==l||null==p||ifMath.isEqualEps(l,k)&&ifMath.isEqualEps(p,o),u=null==m||null==q||ifMath.isEqualEps(m,n)&&ifMath.isEqualEps(q,r);if(t&&u)s=new b.AnchorPoint,s.setProperties(["x","y","tp"],[k+c*(n-k),o+c*(r-o),h]),this.getAnchorPoints().insertChild(s,g);else if(t||u){var v=t?m:l,w=t?q:p,x=new Float64Array(3),y=new Float64Array(3),z=new Float64Array(3),A=new Float64Array(3);ifMath.divideQuadraticCurve(k,v,n,c,x,z),ifMath.divideQuadraticCurve(o,w,r,c,y,A),s=new b.AnchorPoint,s.setProperties(["x","y","tp"],[x[2],y[2],h]),this.getAnchorPoints().insertChild(s,g),t?(ifMath.isEqualEps(x[1],x[2])&&ifMath.isEqualEps(y[1],y[2])?s.setProperties(["hlx","hly"],[null,null]):s.setProperties(["hlx","hly"],[x[1],y[1]]),l=z[0]+2/3*(z[1]-z[0]),p=A[0]+2/3*(A[1]-A[0]),m=z[2]+2/3*(z[1]-z[2]),q=A[2]+2/3*(A[1]-A[2]),ifMath.isEqualEps(l,z[0])&&ifMath.isEqualEps(p,A[0])?s.setProperties(["hrx","hry"],[null,null]):s.setProperties(["hrx","hry"],[l,p]),ifMath.isEqualEps(m,z[2])&&ifMath.isEqualEps(q,A[2])?g.setProperties(["hlx","hly"],[null,null]):g.setProperties(["hlx","hly"],[m,q])):(ifMath.isEqualEps(z[0],z[1])&&ifMath.isEqualEps(A[0],A[1])?s.setProperties(["hrx","hry"],[null,null]):s.setProperties(["hrx","hry"],[z[1],A[1]]),l=x[0]+2/3*(x[1]-x[0]),p=y[0]+2/3*(y[1]-y[0]),m=x[2]+2/3*(x[1]-x[2]),q=y[2]+2/3*(y[1]-y[2]),ifMath.isEqualEps(m,x[2])&&ifMath.isEqualEps(q,y[2])?s.setProperties(["hlx","hly"],[null,null]):s.setProperties(["hlx","hly"],[m,q]),ifMath.isEqualEps(l,x[0])&&ifMath.isEqualEps(p,y[0])?f.setProperties(["hrx","hry"],[null,null]):f.setProperties(["hrx","hry"],[l,p]))}else{var x=new Float64Array(4),y=new Float64Array(4),z=new Float64Array(4),A=new Float64Array(4);ifMath.getCtrlPtsCasteljau(k,l,m,n,c,1,x),ifMath.getCtrlPtsCasteljau(o,p,q,r,c,1,y),ifMath.getCtrlPtsCasteljau(k,l,m,n,c,2,z),ifMath.getCtrlPtsCasteljau(o,p,q,r,c,2,A),ifMath.isEqualEps(x[1],k)&&ifMath.isEqualEps(y[1],o)?f.setProperties(["hrx","hry"],[null,null]):f.setProperties(["hrx","hry"],[x[1],y[1]]),s=new b.AnchorPoint,s.setProperties(["x","y","tp"],[x[3],y[3],h]),this.getAnchorPoints().insertChild(s,g),ifMath.isEqualEps(x[2],x[3])&&ifMath.isEqualEps(y[2],y[3])?s.setProperties(["hlx","hly"],[null,null]):s.setProperties(["hlx","hly"],[x[2],y[2]]),ifMath.isEqualEps(z[0],z[1])&&ifMath.isEqualEps(A[0],A[1])?s.setProperties(["hrx","hry"],[null,null]):s.setProperties(["hrx","hry"],[z[1],A[1]]),ifMath.isEqualEps(z[2],z[3])&&ifMath.isEqualEps(A[2],A[3])?g.setProperties(["hlx","hly"],[null,null]):g.setProperties(["hlx","hly"],[z[2],A[2]])}return this.endUpdate(),s}return null},b.prototype._handleChange=function(a,c){IFPathBase.prototype._handleChange.call(this,a,c),this._handleGeometryChangeForProperties(a,c,b.GeometryProperties),this._handleGeometryChangeForProperties(a,c,IFPathBase.GeometryProperties)},b.prototype.toString=function(){return"[IFPath]"},a.IFPath=b}(this),function(a){function b(){IFShape.call(this),this._setDefaultProperties(b.GeometryProperties),this._runs=[],this._runsDirty=!1}IFNode.inherit("text",b,IFShape),b.VerticalBox={Auto:"a",Fixed:"f",Center:"c",Bottom:"b"},b.GeometryProperties={aw:!0,vb:b.VerticalBox.Auto},b.Chunk=function(a){IFNode.call(this),this._content=a},IFNode.inheritAndMix("txChk",b.Chunk,IFNode,[IFNode.Store]),b.Chunk.prototype._content=null,b.Chunk.prototype.getContent=function(){return this._content},b.Chunk.prototype.store=function(a){return IFNode.Store.prototype.store.call(this,a)?(a.cnt=this._content,!0):!1},b.Chunk.prototype.restore=function(a){return IFNode.Store.prototype.restore.call(this,a)?(this._content=a.cnt,!0):!1},b.Chunk.prototype.validateInsertion=function(a){return a instanceof b.Block},b.Break=function(){IFNode.call(this)},IFNode.inheritAndMix("txBrk",b.Break,IFNode,[IFNode.Store]),b.Break.prototype.validateInsertion=function(a){return a instanceof b.Block},b.Block=function(){this._setDefaultProperties(b.Block.Properties)},IFObject.inheritAndMix(b.Block,IFNode,[IFNode.Properties,IFNode.Store]),b.Block.Properties={ff:null,fi:null,fw:null,fs:null,fc:null,cs:null,ws:null},b.Block.propertyToCss=function(a,b,c){if("ff"===a)c["font-family"]=null!==b?b:"";else if("fi"===a)c["font-size"]=null!==b?b+"px":"";else if("fw"===a)c["font-weight"]=null!==b?b.toString():"";else if("fs"===a)if(null===b)c["font-style"]="";else switch(b){case IFFont.Style.Normal:c["font-style"]="normal";break;case IFFont.Style.Italic:c["font-style"]="italic"}else if("fc"===a)c.color=null!==b?b.asCSSString():"";else if("cs"===a)c["letter-spacing"]=null!==b?b+"px":"";else{if("ws"!==a)throw new Error("Unimplemented property (propertyToCss): "+a);c["word-spacing"]=null!==b?b+"px":""}},b.Block.cssToProperty=function(a,b){if("ff"===a){if(b["font-family"]){var c=b["font-family"];if(c.length>0)return('"'===c.charAt(0)||"'"===c.charAt(0))&&(c=c.substr(1)),('"'===c.charAt(c.length-1)||"'"===c.charAt(c.length-1))&&(c=c.substr(0,c.length-1)),c}}else if("fi"===a){var d=parseFloat(b["font-size"]);if(!isNaN(d))return d}else if("fw"===a){var d=parseInt(b["font-weight"]);if(!isNaN(d))return d;if(d=b["font-weight"],"normal"===d)return IFFont.Weight.Regular;if("bold"===d)return IFFont.Weight.Bold}else if("fs"===a){if("normal"===b["font-style"])return IFFont.Style.Normal;if("italic"===b["font-style"])return IFFont.Style.Italic}else if("fc"===a){var d=IFColor.parseCSSColor(b.color);if(d)return d}else if("cs"===a){var d=parseFloat(b["letter-spacing"]);if(!isNaN(d))return d}else{if("ws"!==a)throw new Error("Unimplemented property (cssToProperty): "+a);var d=parseFloat(b["word-spacing"]);if(!isNaN(d))return d}return null},b.Block.prototype.getText=function(){for(var a=this.getParent();null!==a;a=a.getParent())if(a instanceof b)return a;return null},b.Block.prototype.validateInsertion=function(a){return a instanceof b.Block},b.Block.prototype.store=function(a){return IFNode.Store.prototype.store.call(this,a)?(this.storeProperties(a,b.Block.Properties),!0):!1},b.Block.prototype.restore=function(a){return IFNode.Store.prototype.restore.call(this,a)?(this.restoreProperties(a,b.Block.Properties),!0):!1},b.Block.prototype._handleChange=function(a,c){var d=this.getText();d&&(d._handleGeometryChangeForProperties(a,c,b.Block.Properties)&&a==IFNode._Change.BeforePropertiesChange?d._runsDirty=!0:a==IFNode._Change.BeforeChildInsert||a==IFNode._Change.BeforeChildRemove?d.beginUpdate():(a==IFNode._Change.AfterChildInsert||a==IFNode._Change.AfterChildRemove)&&(d._runsDirty=!0,d.endUpdate())),IFNode.prototype._handleChange.call(this,a,c)},b.Block.prototype.propertiesToCss=function(a){return this._propertiesToCss(a,b.Block.Properties,b.Block.propertyToCss)},b.Block.prototype.cssToProperties=function(a){this._cssToProperties(a,b.Block.Properties,b.Block.cssToProperty)},b.Block.prototype._propertiesToCss=function(a,b,c){for(var d in b){var e=this.getProperty(d);null!==e&&c(d,e,a)}return a},b.Block.prototype._cssToProperties=function(a,b,c){var d=[],e=[];for(var f in b){var g=c(f,a);d.push(f),e.push(g)}d.length>0&&this.setProperties(d,e)},b.Span=function(){b.Block.call(this),this._setDefaultProperties(b.Span.Properties)},IFNode.inheritAndMix("txSpan",b.Span,b.Block,[IFNode.Container]),b.Span.prototype.validateInsertion=function(a){return a instanceof b.Paragraph||a instanceof b.Span},b.Paragraph=function(){b.Block.call(this),this._setDefaultProperties(b.Paragraph.Properties)},IFNode.inheritAndMix("txPara",b.Paragraph,b.Block,[IFNode.Container]),b.Paragraph.Alignment={Left:"l",Center:"c",Right:"r",Justify:"j"},b.Paragraph.WrapMode={None:"n",Words:"w",All:"a"},b.Paragraph.Properties={cc:null,cg:null,wm:null,al:null,"in":null,lh:null},b.Paragraph.propertyToCss=function(a,c,d){if("cc"===a)c=null!==c?c:"",d["column-count"]=c,d["-webkit-column-count"]=c,d["-moz-column-count"]=c;else if("cg"===a)c=null!==c?c:"",d["column-gap"]=c,d["-webkit-column-gap"]=c,d["-moz-column-gap"]=c;else if("wm"===a)if(null===c)d["white-space"]="",d["word-break"]="";else switch(c){case b.Paragraph.WrapMode.None:d["white-space"]="nowrap";break;case b.Paragraph.WrapMode.Words:d["white-space"]="pre-wrap";break;case b.Paragraph.WrapMode.All:d["white-space"]="pre-wrap",d["word-break"]="break-all"}else if("al"===a)if(null===c)d["text-align"]="";else switch(c){case b.Paragraph.Alignment.Left:d["text-align"]="left";break;case b.Paragraph.Alignment.Center:d["text-align"]="center";break;case b.Paragraph.Alignment.Right:d["text-align"]="right";break;case b.Paragraph.Alignment.Justify:d["text-align"]="justify"}else if("in"===a)d["text-indent"]=null!==c?c+"px":"";else{if("lh"!==a)throw new Error("Unimplemented property (propertyToCss): "+a);d["line-height"]=null!==c?c:""}},b.Paragraph.cssToProperty=function(a,c){if("cc"===a){var d=c["column-count"]||c["-webkit-column-count"]||c["-moz-column-count"],e=parseInt(d);if(!isNaN(e))return e}else if("cg"===a){var d=c["column-gap"]||c["-webkit-column-gap"]||c["-moz-column-gap"],e=parseFloat(d);if(!isNaN(e))return e}else if("wm"===a){var f=c["white-space"],g=c["word-break"];if("pre-wrap"===f)return"break-all"===g?b.Paragraph.WrapMode.All:b.Paragraph.WrapMode.Words;if("nowrap"===f)return b.Paragraph.WrapMode.None}else if("al"===a){if("left"===e)return b.Paragraph.Alignment.Left;if("center"===e)return b.Paragraph.Alignment.Center;if("right"===e)return b.Paragraph.Alignment.Right;if("justify"===e)return b.Paragraph.Alignment.Justify}else if("in"===a){var e=parseFloat(c["text-indent"]);if(!isNaN(e))return e}else{if("lh"!==a)throw new Error("Unimplemented property (cssToProperty): "+a);var h=parseFloat(c["line-height"]);if(!isNaN(h))return h}return null},b.Paragraph.prototype._handleChange=function(a,c){var d=this.getText();d&&d._handleGeometryChangeForProperties(a,c,b.Paragraph.Properties)&&a==IFNode._Change.BeforePropertiesChange&&(d._runsDirty=!0),b.Block.prototype._handleChange.call(this,a,c)},b.Paragraph.prototype.validateInsertion=function(a){return a instanceof b.Content},b.Paragraph.prototype.store=function(a){return b.Block.prototype.store.call(this,a)?(this.storeProperties(a,b.Paragraph.Properties),!0):!1},b.Paragraph.prototype.restore=function(a){return b.Block.prototype.restore.call(this,a)?(this.restoreProperties(a,b.Paragraph.Properties),!0):!1},b.Paragraph.prototype.propertiesToCss=function(a){return this._propertiesToCss(a,b.Paragraph.Properties,b.Paragraph.propertyToCss),b.Block.prototype.propertiesToCss.call(this,a)},b.Paragraph.prototype.cssToProperties=function(a){this._cssToProperties(a,b.Paragraph.Properties,b.Paragraph.cssToProperty),b.Block.prototype.cssToProperties.call(this,a)},b.Content=function(){b.Paragraph.call(this),this._flags|=IFNode.Flag.Shadow,this.$ff="Open Sans",this.$fi=20,this.$fw=IFFont.Weight.Regular,this.$fs=IFFont.Style.Normal,this.$lh=1,this.$wm=b.Paragraph.WrapMode.All},IFNode.inherit("txContent",b.Content,b.Paragraph),b.Content.prototype.validateInsertion=function(a){return a instanceof b},b.Content.prototype.propertiesToCss=function(a){{var c="black";this._parent}return a.color=c,b.Paragraph.prototype.propertiesToCss.call(this,a)},b.prototype._content=null,b.prototype._size=null,b.prototype._runs=null,b.prototype._runsDirty=!1,b.prototype._runItIndex=null,b.prototype._runItOutline=null,b.prototype.getContent=function(){if(this._content&&this._content.getParent()!==this&&(this._content=null),!this._content){for(var a=this.getFirstChild(!0);null!==a;a=a.getNext(!0))if(a instanceof b.Content){this._content=a;break}this._content||(this._content=new b.Content,this.appendChild(this._content))}return this._content},b.prototype.getContentBBox=function(){return this._size?new IFRect(0,0,this._size.getX(),this._size.getY()):null},b.prototype.asHtml=function(a){var b=$("<div></div>");return this._asHtml(b,this.getContent(),a),b.html()},b.prototype.fromHtml=function(a){this.beginUpdate();try{var b=this.getContent();if(b.clearChildren(!0),a&&""!==a){var c=document.createElement("div");c.innerHTML=a;for(var d=c.firstChild;null!==d;d=d.nextSibling)this._fromHtml(d,b)}}finally{this.endUpdate()}},b.prototype.store=function(a){return IFShape.prototype.store.call(this,a)?(this.storeProperties(a,b.GeometryProperties),!0):!1},b.prototype.restore=function(a){return IFShape.prototype.restore.call(this,a)?(this.restoreProperties(a,b.GeometryProperties),this._runsDirty=!0,!0):!1},b.prototype.rewindVertices=function(){if(this._runsDirty||null==this._runs){this._runs=[];var a=IFRect.fromPoints(new IFPoint(0,0),new IFPoint(1,1));this.$trf&&(a=this.$trf.mapRect(a));var c=$("<div></div>").css(this.getContent().propertiesToCss({})).css({position:"absolute",top:"0px",left:"0px",visibility:"hidden",width:a.getWidth()>1&&!this.$aw?a.getWidth()+"px":"",height:a.getHeight()>1&&this.$vb!=b.VerticalBox.Auto?a.getHeight()+"px":""}).html(this.asHtml(!0)).appendTo($("body")),d=null,e=null;c.find("p,span").each(function(a,b){var c=$(b),f=c.offset(),g=c.outerWidth(),h=c.outerHeight();(null===d||f.left+g>d)&&(d=f.left+g),(null===e||f.top+h>e)&&(e=f.top+h)}.bind(this)),this._size=null!==d&&null!==e?new IFPoint(d,e):null;var f=0;if(this.$vb!=b.VerticalBox.Auto&&this._size&&this._size.getY()<a.getHeight())switch(this.$vb){case b.VerticalBox.Center:f=(a.getHeight()-this._size.getY())/2;break;case b.VerticalBox.Bottom:f=a.getHeight()-this._size.getY()}c.find("span:not(:has(span))").each(function(c,d){var e=$(d),g=d.getBoundingClientRect(),h=e.text();if(0!==h.length){var i=h[0];if(!(g.height<=0||g.width<=0||" "===i||i>="\x00"&&"">=i)){var j={"font-family":e.css("font-family"),"font-size":e.css("font-size"),"font-style":e.css("font-style"),"font-weight":e.css("font-weight")},k=b.Block.cssToProperty("ff",j),l=b.Block.cssToProperty("fi",j),m=b.Block.cssToProperty("fs",j),n=b.Block.cssToProperty("fw",j),o=ifFont.getVariant(k,m,n),p=ifFont.getGlyphBaseline(k,o,l,i);this._runs.push({x:a.getX()+g.left,y:a.getY()+g.top+f+p,"char":i,family:k,variant:o,size:l})}}}.bind(this)),c.remove(),this._runsDirty=!1}return this._runs&&this._runs.length>0?(this._runItIndex=0,this._runItOutline=null,!0):!1},b.prototype.readVertex=function(a){if(this._runItOutline){if(this._runItOutline.readVertex(a))return!0;if(this._runItOutline=null,++this._runItIndex>=this._runs.length)return!1}if(!this._runItOutline){var b=this._runs[this._runItIndex];if(!b)return!1;if(this._runItOutline=ifFont.getGlyphOutline(b.family,b.variant,b.size,b.x,b.y,b.char),!this._runItOutline.rewindVertices(0))throw new Error("Unexpected end of outline");return this._runItOutline.readVertex(a)}},b.prototype._calculateGeometryBBox=function(){if(this.rewindVertices(0),!this._size)return null;var a=IFRect.fromPoints(new IFPoint(0,0),new IFPoint(1,1));this.$trf&&(a=this.$trf.mapRect(a));var c=this.$aw?this._size.getX():a.getWidth(),d=this.$vb!=b.VerticalBox.Auto?a.getHeight():this._size.getY();return new IFRect(a.getX(),a.getY(),c,d)},b.prototype._preparePaint=function(a){if(IFShape.prototype._preparePaint.call(this,a)){var b=this._getClipBox(a);return b&&a.canvas.clipRect(b.getX(),b.getY(),b.getWidth(),b.getHeight()),!0}return!1},b.prototype._finishPaint=function(a){null!==this._getClipBox(a)&&a.canvas.resetClip(),IFShape.prototype._finishPaint.call(this,a)},b.prototype._detailHitTest=function(){return new IFElement.HitResult(this)},b.prototype._handleChange=function(a,c){if(IFShape.prototype._handleChange.call(this,a,c),this._handleGeometryChangeForProperties(a,c,b.GeometryProperties)&&a==IFNode._Change.BeforePropertiesChange&&(this._runsDirty=!0),a===IFNode._Change.BeforePropertiesChange){var d=c.properties.indexOf("trf");d>=0&&!this._runsDirty&&(this._runsDirty=!0)}},b.prototype._getClipBox=function(a){var c=this.getGeometryBBox();return this._size&&(!this.$aw&&this._size.getX()>=c.getWidth()||this.$vb!=b.VerticalBox.Auto&&this._size.getY()>=c.getHeight())?new IFRect(c.getX(),c.getY(),this.$aw?a.canvas.getWidth():c.getWidth(),this.$vb!=b.VerticalBox.Auto?c.getHeight():a.canvas.getHeight()):null},b.prototype._asHtml=function(a,c,d){if(c instanceof b.Break)$("<br>").appendTo(a);else if(c instanceof b.Chunk){var e=c.getContent();if(e&&""!==e)if(d)for(var f=0;f<e.length;++f)$("<span></span>").text(e[f]).appendTo(a);else a.append(document.createTextNode(e))}else c instanceof b.Content||(c instanceof b.Paragraph?a=$("<p></p>").css(c.propertiesToCss({})).appendTo(a):c instanceof b.Span&&(a=$("<span></span>").css(c.propertiesToCss({})).appendTo(a)));if(c.hasMixin(IFNode.Container))for(var g=c.getFirstChild();null!==g;g=g.getNext())this._asHtml(a,g,d)},b.prototype._fromHtml=function(a,c){if(1===a.nodeType){var d=a.nodeName.toLowerCase();if("p"===d||"div"===d){var e=new b.Paragraph;e.cssToProperties(a.style),c.appendChild(e),c=e}else{if("span"!==d&&"b"!==d&&"strong"!==d&&"i"!==d)return"br"===d?void c.appendChild(new b.Break):void 0;var f=new b.Span;f.cssToProperties(a.style),c.appendChild(f),c=f,"b"===d||"strong"===d?f.setProperty("fw",IFFont.Weight.Bold):"i"===d&&f.setProperty("fs",IFFont.Style.Italic)}for(var g=a.firstChild;null!==g;g=g.nextSibling)this._fromHtml(g,c)}else 3===a.nodeType&&""!==a.textContent&&c.appendChild(new b.Chunk(a.textContent))},b.prototype.toString=function(){return"[IFText]"},a.IFText=b}(this),function(a){function b(a){this._view=a,this._canvas=new IFPaintCanvas,this._paintContext=new IFPaintContext,this._paintContext.configuration=a.getViewConfiguration()?a.getViewConfiguration():new IFPaintConfiguration,this._paintContext.canvas=this._canvas,this._dirtyList=new IFDirtyList}b.prototype._view=null,b.prototype._canvas=null,b.prototype._paintContext=null,b.prototype._dirtyList=null,b.prototype._repaintRequestFrameId=null,b.prototype.show=function(){this._canvas._canvasContext.canvas.style.visibility=""},b.prototype.hide=function(){this._canvas._canvasContext.canvas.style.visibility="hidden"},b.prototype.release=function(){},b.prototype.invalidate=function(a){return(!a||a.isEmpty())&&(this._dirtyList.reset(),a=this._dirtyList.getArea()),a&&this._dirtyList.dirty(a.getX(),a.getY(),a.getWidth(),a.getHeight())?(null==this._repaintRequestFrameId&&(this._repaintRequestFrameId=ifPlatform.scheduleFrame(this._repaint.bind(this))),!0):!1},b.prototype.paint=function(){},b.prototype.resize=function(a,b){this._canvas.resize(a,b),this.updateViewArea()},b.prototype.updateViewArea=function(){var a=new IFRect(0,0,this._view.getWidth(),this._view.getHeight());IFRect.equals(this._dirtyList.getArea(),a)||(this._dirtyList.setArea(a),this.invalidate())},b.prototype._repaint=function(){var a=this._dirtyList.flush();null!=a&&(this._canvas.prepare(a.getDirtyRectangles()),this._paintContext.dirtyMatcher=a,this.paint&&this.paint.call(this,this._paintContext),this._canvas.finish()),this._repaintRequestFrameId=null},b.prototype.toString=function(){return"[Object IFStage]"},a.IFStage=b}(this),function(a){function b(a){IFStage.call(this,a),a.getScene().addEventListener(IFScene.InvalidationRequestEvent,this._sceneInvalidationRequest,this)}IFObject.inherit(b,IFStage),b.prototype._pixelContentCanvas=null,b.prototype.release=function(){this._view.getScene().removeEventListener(IFScene.InvalidationRequestEvent,this._sceneInvalidationRequest,this)},b.prototype.resize=function(a,b){IFStage.prototype.resize.call(this,a,b),this._pixelContentCanvas&&this._pixelContentCanvas.resize(a,b)},b.prototype.paint=function(a){if(a.dirtyMatcher&&a.dirtyMatcher.transform(this._view.getViewTransform()),this._view.getViewConfiguration().pixelMode&&!ifMath.isEqualEps(this._view.getZoom(),1)){this._pixelContentCanvas||(this._pixelContentCanvas=new IFPaintCanvas,this._pixelContentCanvas.resize(a.canvas.getWidth(),a.canvas.getHeight()));var b=this._view.getScene().getChildrenPaintBBox();this._pixelContentCanvas.prepare([b]);var c=b.getSide(IFRect.Side.TOP_LEFT),d=b.getWidth(),e=b.getHeight();this._pixelContentCanvas.setTransform(new IFTransform(1,0,0,1,-c.getX(),-c.getY())),this._pixelContentCanvas.resize(d,e);var f=a.canvas;a.canvas=this._pixelContentCanvas,this._view.getScene().render(a),f.setTransform(this._view.getWorldTransform()),f.drawImage(this._pixelContentCanvas,c.getX(),c.getY(),!0),this._pixelContentCanvas.finish(),a.canvas=f}else this._pixelContentCanvas=null,a.canvas.setOrigin(new IFPoint(this._view._scrollX,this._view._scrollY)),a.canvas.setScale(this._view._zoom),this._view.getScene().render(a)},b.prototype._sceneInvalidationRequest=function(a){var b=a.area;b&&(b=this._view.getWorldTransform().mapRect(b)),this.invalidate(b)},b.prototype.toString=function(){return"[Object IFSceneStage]"},a.IFSceneStage=b}(this),function(a){function b(a){this._htmlElement=this._createHTMLElement(),null!=a&&(this._htmlElement.style.position="relative",a.appendChild(this._htmlElement))}IFObject.inheritAndMix(b,IFObject,[GEventTarget]),b.convertClientPositionFromMousePosition=function(a,b){var c=null,d=null;if(b.target==a&&("absolute"===a.style.position?b.hasOwnProperty("offsetX")&&(c=b.offsetX,d=b.offsetY):(c=b.clientX,d=b.clientY)),null==c||null==d){var e=a.getBoundingClientRect();c=b.pageX-(e.left+window.pageXOffset-document.documentElement.clientLeft),d=b.pageY-(e.top+window.pageYOffset-document.documentElement.clientTop)}return new IFPoint(c,d)},b.prototype._htmlElement=null,b.prototype._inputEventCache=null,b.prototype._dragEventCounter=0,b.prototype._id=null,b.prototype._parent=null,b.prototype._x=0,b.prototype._y=0,b.prototype._width=0,b.prototype._height=0,b.prototype._cursor=null,b.prototype.getX=function(){return this._x},b.prototype.getY=function(){return this._y},b.prototype.getWidth=function(){return this._htmlElement.offsetWidth?this._htmlElement.offsetWidth:this._width},b.prototype.getHeight=function(){return this._htmlElement.offsetHeight?this._htmlElement.offsetHeight:this._height},b.prototype.move=function(a,b){this._htmlElement.style.left="number"==typeof a?a.toString()+"px":"",this._htmlElement.style.top="number"==typeof b?b.toString()+"px":"",this._htmlElement.style.position="number"==typeof a||"number"==typeof b?"absolute":"",this._x=a,this._y=b},b.prototype.resize=function(a,b){this._htmlElement.style.width=a?a.toString()+"px":"",this._htmlElement.style.height=b?b.toString()+"px":"",this._htmlElement.style.overflowX=a?"hidden":"",this._htmlElement.style.overflowY=b?"hidden":"",this._width=a,this._height=b},b.prototype.getCursor=function(){return this._cursor},b.prototype.setCursor=function(a){this._cursor!=a&&(this._cursor&&this._removeCSSClass("g-cursor-"+this._cursor,!0),this._cursor=a,this._cursor&&this._addCSSClass("g-cursor-"+this._cursor,!0))},b.prototype.isEnabled=function(){return null==this._htmlElement.className||this._htmlElement.className.indexOf("g-disabled")<0},b.prototype.setEnabled=function(a){a!=this.isEnabled()&&(a?this._removeCSSClass("g-disabled",!0):this._addCSSClass("g-disabled",!0))},b.prototype.isDisplayed=function(){return"none"!=this._htmlElement.style.display},b.prototype.setDisplayed=function(a){this._htmlElement.style.display=a?"":"none"},b.prototype.trigger=function(a){this._dragEventCounter>0&&a instanceof GUIMouseEvent.Release&&this._dragMouseRelease(a),GEventTarget.prototype.trigger.call(this,a),this._dragEventCounter>0&&(a instanceof GUIMouseEvent.Down?this._dragMouseDown(a):a instanceof GUIMouseEvent.Move&&this._dragStartPosition&&this._dragMouseMove(a))},b.prototype.addEventListener=function(a,b,c,d){GEventTarget.prototype.addEventListener.call(this,a,b,c,d),GUIInputEvent.prototype.isPrototypeOf(a.prototype)&&(this._registerInputEventListener(a),GUIMouseEvent.isDragEvent(a)&&(0==this._dragEventCounter&&(this._registerInputEventListener(GUIMouseEvent.Down),this._registerInputEventListener(GUIMouseEvent.Move),this._registerInputEventListener(GUIMouseEvent.Release)),this._dragEventCounter++))},b.prototype.removeEventListener=function(a,b){GEventTarget.prototype.removeEventListener.call(this,a,b),GUIInputEvent.prototype.isPrototypeOf(a.prototype)&&(this._unregisterInputEventListener(a),GUIMouseEvent.isDragEvent(a)&&0==--this._dragEventCounter&&(this._unregisterInputEventListener(GUIMouseEvent.Down),this._unregisterInputEventListener(GUIMouseEvent.Move),this._unregisterInputEventListener(GUIMouseEvent.Release)))},b.prototype.focus=function(){if(this.isDisplayed())try{return this._htmlElement.focus(),!0}catch(a){return!1}return!1},b.prototype._registerInputEventListener=function(a){var b=GUIMouseEvent.isDragEvent(a),c=IFObject.getTypeId(a);this._inputEventCache&&c in this._inputEventCache?this._inputEventCache&&c in this._inputEventCache&&this._inputEventCache[c].counter++:(this._inputEventCache||(this._inputEventCache={}),this._inputEventCache[c]={counter:0,event:new a},b||this._startListeningInputEvent(a))},b.prototype._unregisterInputEventListener=function(a){var b=GUIMouseEvent.isDragEvent(a),c=IFObject.getTypeId(a);this._inputEventCache&&c in this._inputEventCache&&0==--this._inputEventCache[c].counter&&(b||this._stopListeningInputEvent(a),delete this._inputEventCache[c],0==Object.keys(this._inputEventCache).length&&(this._inputEventCache=null))},b.prototype._startListeningInputEvent=function(a){var b=IFObject.getTypeId(a),c=function(b){this._updateAndTriggerInputEvent(b,a)}.bind(this);if(c){this._inputEventCache[b].domListener=c;var d=this._getDomEventNameForEventClass(a);this._htmlElement.addEventListener(d,c)}},b.prototype._stopListeningInputEvent=function(a){var b=IFObject.getTypeId(a),c=this._getDomEventNameForEventClass(a);this._htmlElement.removeEventListener(c,this._inputEventCache[b].domListener),delete this._inputEventCache[b].domListener},b.prototype._dragMouseDown=function(a){a.button==GUIMouseEvent.BUTTON_LEFT&&(this._dragStartPosition=a.client,this._dragIsDragging=!1)},b.prototype._dragMouseMove=function(a){if(this._dragStartPosition&&!this._dragIsDragging){var b=this._dragStartPosition;if((Math.abs(b.getX()-a.client.getX())>=1||Math.abs(b.getY()-a.client.getY())>=1)&&(this._dragIsDragging=!0,this._dragPreviousPosition=this._dragStartPosition,this.hasEventListeners(GUIMouseEvent.DragStart))){var c=this._inputEventCache[IFObject.getTypeId(GUIMouseEvent.DragStart)].event;this._dragAssignMouseEvent(a,c),c.client=this._dragStartPosition,this.trigger(c)}}if(this._dragIsDragging&&this.hasEventListeners(GUIMouseEvent.Drag)){var c=this._inputEventCache[IFObject.getTypeId(GUIMouseEvent.Drag)].event;this._dragAssignMouseEvent(a,c),this._dragAssignDragEvent(c,a),this.trigger(c),this._dragPreviousPosition=a.client}},b.prototype._dragMouseRelease=function(a){if(a.button==GUIMouseEvent.BUTTON_LEFT){if(this._dragIsDragging){var b=this._inputEventCache[IFObject.getTypeId(GUIMouseEvent.DragEnd)].event;this._dragAssignMouseEvent(a,b),this._dragAssignDragEvent(b,a),this.trigger(b)}delete this._dragStartPosition,delete this._dragPreviousPosition,delete this._dragIsDragging}},b.prototype._dragAssignMouseEvent=function(a,b){b.client=a.client,b.button=a.button},b.prototype._dragAssignDragEvent=function(a,b){a.clientStart=this._dragStartPosition,a.clientDelta=b.client.subtract(this._dragPreviousPosition)},b.prototype._setParent=function(a){this._parent=a},b.prototype._updateLocale=function(){var a=null;this._hint&&(a=this._hint.asHtml()),a&&0!=a.length?this._htmlElement.setAttribute("data-qhint",qUtil.escape(a)):this._htmlElement.removeAttribute("data-qhint")},b.prototype._triggerWidgetEventFromDom=function(a,b){b instanceof GUIMouseEvent.Down&&b.button===GUIMouseEvent.BUTTON_LEFT?this._setCapture():b instanceof GUIMouseEvent.Release&&this._releaseCapture(),this.trigger(b)
},b.prototype._updateAndTriggerInputEvent=function(a,b){if(this.isEnabled()){if("keydown"===a.type){var c=ifKey.translateKey(a.which||a.keyCode);switch(c){case IFKey.Constant.TAB:a.preventDefault()}}else"mousedown"===a.type&&a.preventDefault();GUIMouseEvent.prototype.isPrototypeOf(b.prototype)?this._updateAndTriggerMouseEvent(a,IFObject.getTypeId(b)):GUIKeyEvent.prototype.isPrototypeOf(b.prototype)&&this._updateAndTriggerKeyEvent(a,IFObject.getTypeId(b))}},b.prototype._updateAndTriggerMouseEvent=function(a,c){var d=this._inputEventCache[c].event;d.client=b.convertClientPositionFromMousePosition(this._htmlElement,a),d.button=a.button,this._triggerWidgetEventFromDom(a,d)},b.prototype._updateAndTriggerKeyEvent=function(a,b){var c=this._inputEventCache[b].event;c.key=ifKey.translateKey(a.which||a.keyCode),this._triggerWidgetEventFromDom(a,c)},b.prototype._getDomEventNameForEventClass=function(a){switch(a){case GUIMouseEvent.Move:return"mousemove";case GUIMouseEvent.Enter:return"mouseover";case GUIMouseEvent.Leave:return"mouseout";case GUIMouseEvent.Down:return"mousedown";case GUIMouseEvent.Release:return"mouseup";case GUIMouseEvent.Click:return"click";case GUIMouseEvent.DblClick:return"dblclick";case GUIKeyEvent.Down:return"keydown";case GUIKeyEvent.Release:return"keyup";case GUIKeyEvent.Press:return"keypress"}throw new Error("Unknown DOMEvent name")};var c=[GUIMouseEvent.Move,GUIMouseEvent.Release,GUIKeyEvent.Down,GUIKeyEvent.Release,GUIKeyEvent.Press];b.prototype._setCapture=function(){function a(a){var c=b._getDomEventNameForEventClass(a);b._savedDocumentListeners||(b._savedDocumentListeners={}),b._savedDocumentListeners[c]=function(c){c.target!=this._htmlElement&&(b._updateAndTriggerInputEvent(c,a),c.stopImmediatePropagation())}.bind(b),document.addEventListener(c,b._savedDocumentListeners[c],!0)}for(var b=this,d=0;d<c.length;++d){var e=c[d];this._inputEventCache[IFObject.getTypeId(e)]&&a(e)}},b.prototype._releaseCapture=function(){if(this._savedDocumentListeners){for(var a in this._savedDocumentListeners)document.removeEventListener(a,this._savedDocumentListeners[a],!0);delete this._savedDocumentListeners}},b.prototype._addCSSClass=function(a,b){!b&&this._BASE_CSS_CLASS&&(a=this._BASE_CSS_CLASS+"-"+a);var c=this._htmlElement.className;if(c&&0!=c.trim().length){for(var d=!0,e=c.trim().split(" "),f=0;f<e.length;++f){var g=e[f].trim();if(g==a){d=!1;break}}d&&(c+=" "+a)}else c=a;this._htmlElement.className=c},b.prototype._removeCSSClass=function(a,b){!b&&this._BASE_CSS_CLASS&&(a=this._BASE_CSS_CLASS+"-"+a);var c=this._htmlElement.className;if(c&&c.indexOf(a)>=0){for(var d="",e=c.trim().split(" "),f=0;f<e.length;++f){var g=e[f].trim();g!=a&&(d.length>0&&(d+=" "),d+=g)}this._htmlElement.className=d}},b.prototype._createHTMLElement=function(){var a=document.createElement("div");return a.setAttribute("tabindex","0"),a},b.prototype.toString=function(){return"[Object GUIWidget]"},a.GUIWidget=b}(this),function(a){function b(a){this._updateViewTransforms(!0),GUIWidget.apply(this,arguments.length>1?Array.prototype.slice.call(arguments,1):null),this._scene=a,this._viewOffset=[0,0,0,0],this._viewMargin=[0,0,0,0],this._pageConfigurations=[],this._viewConfiguration||(this._viewConfiguration=new IFScenePaintConfiguration),this._initStages(),a.addEventListener(IFNode.AfterFlagChangeEvent,this._afterFlagChange,this),a.addEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),a.addEventListener(IFNode.AfterRemoveEvent,this._afterRemove,this)}IFObject.inherit(b,GUIWidget),b.options={minZoomFactor:.05,maxZoomFactor:512,defaultFitActivePage:!1},b.TransformEvent=function(){},IFObject.inherit(b.TransformEvent,GEvent),b.TransformEvent.prototype.toString=function(){return"[Object IFView.TransformEvent]"},b.TRANSFORMEVENT=new b.TransformEvent,b.prototype._scene=null,b.prototype._stages=null,b.prototype._viewOffset=null,b.prototype._viewMargin=null,b.prototype._scrollX=0,b.prototype._scrollY=0,b.prototype._zoom=1,b.prototype._worldToViewTransform=null,b.prototype._viewToWorldTransform=null,b.prototype._viewConfiguration=null,b.prototype._pageConfigurations=null,b.prototype.resize=function(a,b){if(GUIWidget.prototype.resize.call(this,a,b),this._stages)for(var c=0;c<this._stages.length;++c)this._stages[c].resize(this.getWidth(),this.getHeight())},b.prototype.getScene=function(){return this._scene},b.prototype.getViewConfiguration=function(){return this._viewConfiguration},b.prototype.getViewOffset=function(){return this._viewOffset},b.prototype.setViewOffset=function(a){if(this._viewOffset=[0,0,0,0],a&&a.length>0){for(var b=0;b<Math.min(4,a.length);++b)this._viewOffset[b]=a[b];if(this._stages)for(var b=0;b<this._stages.length;++b)this._stages[b].updateViewArea()}},b.prototype.getViewMargin=function(){return this._viewMargin},b.prototype.setViewMargin=function(a){if(this._viewMargin=[0,0,0,0],a&&a.length>0)for(var b=0;b<Math.min(4,a.length);++b)this._viewMargin[b]=a[b],this.invalidate()},b.prototype.getScrollX=function(){return this._scrollX},b.prototype.getScrollY=function(){return this._scrollY},b.prototype.getZoom=function(){return this._zoom},b.prototype.getWorldTransform=function(){return this._worldToViewTransform},b.prototype.getViewTransform=function(){return this._viewToWorldTransform},b.prototype.getViewBox=function(a){var b=this._viewOffset[0]+(a?0:this._viewMargin[0]),c=this._viewOffset[1]+(a?0:this._viewMargin[1]);return new IFRect(b,c,this.getWidth()-(this._viewOffset[2]+(a?0:this._viewMargin[2])+b),this.getHeight()-(this._viewOffset[3]+(a?0:this._viewMargin[3])+c))},b.prototype.transform=function(a,b,c){this._scrollX=a,this._scrollY=b,this._zoom=c,this._updateViewTransforms()},b.prototype.zoomAtCenter=function(a,c){c=c||this._zoom;var d=this.getViewBox().getSide(IFRect.Side.CENTER),e=this._worldToViewTransform.mapPoint(a),f=Math.min(b.options.maxZoomFactor,Math.max(c,b.options.minZoomFactor));if(f!=this._zoom||!IFPoint.equals(e,d)){var g=(new IFTransform).translated(-a.getX(),-a.getY()).scaled(f,f).translated(d.getX(),d.getY()),h=g.getMatrix();this._scrollX=-h[4],this._scrollY=-h[5],this._zoom=f,this._updateViewTransforms()}},b.prototype.zoomAt=function(a,b){var c=this.getViewBox().getSide(IFRect.Side.CENTER),d=this._viewToWorldTransform.mapPoint(c),e=d.subtract(a),f=b/this._zoom;this.zoomAtCenter(new IFPoint(a.getX()+e.getX()/f,a.getY()+e.getY()/f),b)},b.prototype.zoomAll=function(a,b){var c=a.getSide(IFRect.Side.CENTER),d=a.getWidth(),e=a.getHeight(),f=this.getViewBox();if(b){var g=this._worldToViewTransform.mapRect(new IFRect(c.getX()-d/2,c.getY()-e/2,d,e)),h=this._zoom*Math.min(1,Math.max(g.getWidth()/f.getWidth(),g.getHeight()/f.getHeight()));this.zoomAtCenter(c,h)}else this.zoomAtCenter(c,1/Math.max(d/f.getWidth(),e/f.getHeight()))},b.prototype.zoomActivePage=function(){var a=this._scene.getActivePage();if(a){var c=this._getOrCreatePageConfig(a,!1);if(c)this.transform(c.scrollX,c.scrollY,c.zoom);else{var d=a.getPaintBBox();d&&!d.isEmpty()&&(b.options.defaultFitActivePage?this.zoomAll(d,!1):this.zoomAtCenter(d.getSide(IFRect.Side.CENTER),1))}}},b.prototype.scrollBy=function(a,b){(0!=a||0!=b)&&(this._scrollX=this._scrollX+a,this._scrollY=this._scrollY+b,this._updateViewTransforms())},b.prototype.invalidate=function(a){var b=!1;if(this._stages)for(var c=0;c<this._stages.length;++c)b=this._stages[c].invalidate(a)||b;return b},b.prototype.addStage=function(a){null==this._stages&&(this._stages=[]),this._stages.push(a);var b=a._canvas._canvasContext.canvas;return b.style.position="absolute",b.style.cursor="inherit",a.resize(this.getWidth(),this.getHeight()),this._htmlElement.appendChild(b),a},b.prototype.getStage=function(a){if(this._stages)for(var b=0;b<this._stages.length;++b)if(a.prototype.isPrototypeOf(this._stages[b]))return this._stages[b];return null},b.prototype.release=function(){if(this._scene.removeEventListener(IFNode.AfterFlagChangeEvent,this._afterFlagChange,this),this._scene.removeEventListener(IFNode.AfterPropertiesChangeEvent,this._afterPropertiesChange,this),this._scene.removeEventListener(IFNode.AfterRemoveEvent,this._afterRemove,this),this._stages)for(var a=0;a<this._stages.length;++a)this._stages[a].release()},b.prototype._updateViewTransforms=function(a){this._scrollX=Math.round(this._scrollX),this._scrollY=Math.round(this._scrollY);var c=(new IFTransform).scaled(this._zoom,this._zoom).translated(-this._scrollX,-this._scrollY);IFTransform.equals(c,this._worldToViewTransform)||(this._worldToViewTransform=c,this._viewToWorldTransform=c.inverted(),this.invalidate(),!a&&this.hasEventListeners(b.TransformEvent)&&this.trigger(b.TRANSFORMEVENT))},b.prototype._initStages=function(){this.addStage(new IFSceneStage(this))},b.prototype._getOrCreatePageConfig=function(a,b){for(var c=null,d=0;d<this._pageConfigurations.length;++d)if(this._pageConfigurations[d].page===a){c=this._pageConfigurations[d];break}return!c&&b&&(c={page:a},this._pageConfigurations.push(c)),c},b.prototype._afterFlagChange=function(a){if(this._scene.getProperty("singlePage")&&a.node instanceof IFPage&&a.flag===IFNode.Flag.Active)if(this.invalidate(),a.set)this.zoomActivePage();else{var b=this._getOrCreatePageConfig(a.node,!0);b.scrollX=this._scrollX,b.scrollY=this._scrollY,b.zoom=this._zoom}},b.prototype._afterPropertiesChange=function(a){a.node===this._scene&&a.properties.indexOf("singlePage")>=0&&(this.zoomActivePage(),this.invalidate())},b.prototype._afterRemove=function(a){if(a.node instanceof IFPage)for(var b=0;b<this._pageConfigurations.length;++b)if(this._pageConfigurations[b].page===a.node){this._pageConfigurations.splice(b,1);break}},b.prototype.toString=function(){return"[Object IFView]"},a.IFView=b}(this),function(a){function b(){document.addEventListener("keydown",function(a){document.activeElement&&($(document.activeElement).is(":input")||document.activeElement.isContentEditable)||this._updateModifiers(a)}.bind(this),!0),document.addEventListener("keyup",function(a){this._updateModifiers(a)}.bind(this),!0)}IFObject.inheritAndMix(b,IFObject,[GEventTarget]),b.Modifiers=function(){},b.Modifiers.metaKey=!1,b.Modifiers.shiftKey=!1,b.Modifiers.optionKey=!1,b.Modifiers.spaceKey=!1,b.Modifiers.prototype.toString=function(){return"[Object GUIPlatform.Modifiers]"},b.ModifiersChangedEvent=function(){this.changed=new b.Modifiers},IFObject.inherit(b.ModifiersChangedEvent,GEvent),b.ModifiersChangedEvent.prototype.changed=null,b.ModifiersChangedEvent.prototype.toString=function(){return"[Object GUIPlatform.ModifiersChangedEvent]"},b.prototype.modifiers=new b.Modifiers,b.prototype._modifiersChangedEventCache=new b.ModifiersChangedEvent,b.prototype.scheduleFrame=function(a){return window.requestAnimationFrame(a)},b.prototype.cancelFrame=function(a){window.cancelRequestAnimationFrame(a)},b.prototype._updateModifiers=function(a){var c=!1,d=!1,e=!1,f=!1,g=ifSystem.operatingSystem!==IFSystem.OperatingSystem.OSX_IOS||ifSystem.hardware!==IFSystem.Hardware.Desktop?a.ctrlKey:a.metaKey;g!=this.modifiers.metaKey&&(e=!0,this.modifiers.metaKey=g),a.altKey!=this.modifiers.optionKey&&(c=!0,this.modifiers.optionKey=a.altKey),a.shiftKey!=this.modifiers.shiftKey&&(d=!0,this.modifiers.shiftKey=a.shiftKey);var h="keydown"===a.type&&32===a.keyCode?!0:"keyup"===a.type&&32===a.keyCode?!1:this.modifiers.spaceKey;h!=this.modifiers.spaceKey&&(f=!0,this.modifiers.spaceKey=h),(e||c||d||e||f)&&this.hasEventListeners(b.ModifiersChangedEvent)&&(this._modifiersChangedEventCache.changed.metaKey=e,this._modifiersChangedEventCache.changed.optionKey=c,this._modifiersChangedEventCache.changed.shiftKey=d,this._modifiersChangedEventCache.changed.spaceKey=f,this.trigger(this._modifiersChangedEventCache))},a.GUIPlatform=b,a.ifPlatform=new b;for(var c=0,d=["ms","moz","webkit","o"],e=0;e<d.length&&!window.requestAnimationFrame;++e)window.requestAnimationFrame=window[d[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[d[e]+"CancelAnimationFrame"]||window[d[e]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var b=(new Date).getTime(),d=Math.max(0,16-(b-c)),e=window.setTimeout(function(){a(b+d)},d);return c=b+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}(this),ifLocale.setValues(IFLocale,IFLocale.Language.English,["create","add","edit","remove","delete","open","save","cancel","ok","close","loading","loading_of","saving","saving_of","success","failure","waiting"],["Create","Add","Edit","Remove","Delete","Open","Save","Cancel","OK","Close","Loading","Loading of","Saving","Saving of","Success","Failure","Waiting"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.1"],["Space"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.2"],["Enter"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.3"],["Tab"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.4"],["Backspace"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.5","key.5.short"],["Control","Ctrl"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.6"],["Shift"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.7"],["Alt"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.8"],["Left"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.9"],["Up"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.10"],["Right"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.11"],["Down"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.12"],["Page Up"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.13"],["Page Down"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.14"],["Home"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.15"],["End"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.16","key.16.short"],["Insert","Ins"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.17","key.17.short"],["Delete","Del"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.18","key.18.short"],["Escape","Esc"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.19","key.19.short"],["Command","Cmd"]),ifLocale.setValues(IFKey,IFLocale.Language.English,["key.30","key.31","key.32","key.33","key.34","key.35","key.36","key.37","key.38","key.39","key.40","key.41"],["F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12"]),ifLocale.setValues(IFFont,IFLocale.Language.English,["weight.thin","weight.extra-light","weight.light","weight.regular","weight.medium","weight.semi-bold","weight.bold","weight.extra-bold","weight.heavy","category.other","category.serif","category.monospace","category.iconic"],["Thin","Extra-Light","Light","Regular","Medium","Semi-Bold","Bold","Extra-Bold","Heavy","Other","Serif","Monospace","Iconic"]),ifLocale.setValues(IFEllipse,IFLocale.Language.English,["name"],["Ellipse"]),ifLocale.setValues(IFRectangle,IFLocale.Language.English,["name"],["Rectangle"]),ifLocale.setValues(IFLayer,IFLocale.Language.English,["name","type.output","type.draft","type.guide"],["Layer","Output","Draft","Guide"]),ifLocale.setValues(IFShapeSet,IFLocale.Language.English,["name"],["Group"]),ifLocale.setValues(IFScene,IFLocale.Language.English,["name"],["Scene"]),ifLocale.setValues(IFPolygon,IFLocale.Language.English,["name"],["Polygon"]),ifLocale.setValues(IFPage,IFLocale.Language.English,["name"],["Page"]),ifLocale.setValues(IFPath,IFLocale.Language.English,["name"],["Path"]),ifLocale.setValues(IFText,IFLocale.Language.English,["name"],["Text"]),ifLocale.setValues(IFScenePaintConfiguration,IFLocale.Language.English,["paint.full","paint.fast","paint.outline","paint.output"],["Full","Fast","Outline","Output"]),ifLocale.setValues(IFSlice,IFLocale.Language.English,["name"],["Slice"]);